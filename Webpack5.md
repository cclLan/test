<div align="center">
  <img width="200" src="http://xxpromise.gitee.io/webpack5-docs/imgs/logo.svg">
  <h1>Webpack5 æ•™ç¨‹æ–‡æ¡£</h1>
</div>

---

## ğŸ‰ å†…å®¹

- ğŸ‘ åŸºç¡€é…ç½®
- ğŸ’… é«˜çº§ä¼˜åŒ–
- ğŸš€ é¡¹ç›®é…ç½®
- ğŸ’ª æ·±å…¥åŸç†

## ğŸŒ åœ°å€

- [http://xxpromise.gitee.io/webpack5-docs](http://xxpromise.gitee.io/webpack5-docs)

## ğŸ“¦ï¸ å¯åŠ¨æ–¹å¼

### 1. ä¸‹è½½ä¾èµ–

```
npm i
```

### 2. è¿è¡ŒæŒ‡ä»¤

- å¼€å‘ç¯å¢ƒå¯åŠ¨é¡¹ç›®ï¼š`npm start` æˆ– `npm run dev`
- ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…é¡¹ç›®ï¼š`npm run build`

** ç‰¹åˆ«æ³¨æ„ï¼šå¯åŠ¨æ–‡æ¡£æ‰€æœ‰ç›®å½•ä¸èƒ½æœ‰ä»»ä½•ä¸­æ–‡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼**



# ä¾èµ–ç¯å¢ƒ

- Nodejs 16+

# å‰ç½®çŸ¥è¯†

- å¯¹ `Nodejs` å„ä¸ªæ ¸å¿ƒæ¨¡å—æ“ä½œæœ‰ä¸€å®šè®¤è¯†ã€‚
  - æ¯”å¦‚ï¼š`fs`ã€`path`ã€`os` ç­‰ã€‚

- å¯¹ `React` å’Œ `Vue` æœ‰ä¸€å®šè®¤è¯†ï¼Œå¹¶ä¸”å¼€å‘è¿‡é¡¹ç›®ã€‚
  - è¿™å¯¹äºå­¦ä¹ é¡¹ç›®éƒ¨åˆ†å†…å®¹éå¸¸æœ‰å¸®åŠ©ã€‚

# é€‚åˆç¾¤ä½“

- `Webpack` é›¶åŸºç¡€ï¼Œæƒ³ä»äº‹é¡¹ç›®è„šæ‰‹æ¶ç ”å‘çš„äººã€‚
- å…·å¤‡ `Webpack` å¼€å‘ç»éªŒï¼Œæƒ³è¦æå‡æ›´å¤šçš„äººã€‚
- ä¸æ˜¯å¾ˆäº†è§£ `Webpack`ï¼Œä½†æ˜¯æƒ³æå‡å·¥èµ„çš„äººã€‚

# æˆ‘èƒ½å­¦åˆ°ä»€ä¹ˆ

- é’é“œï¼šæˆ‘ä»¬ä¼šå­¦ä¹  `Webpack` åŸºç¡€ï¼ŒåŒ…å«æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Œå¦‚ä½•ä½¿ç”¨ï¼ˆè¿™æ˜¯æœ€é‡è¦çš„ï¼‰ã€‚
- é»„é‡‘ï¼šæˆ‘ä»¬ä¼šå­¦ä¹  `Webpack` é«˜çº§ä¼˜åŒ–é…ç½®ï¼Œæå‡é¡¹ç›®æ‰“åŒ…å’Œè¿è¡Œæ—¶æ€§èƒ½ï¼ˆè¿™ä¹Ÿæ˜¯é¢è¯•ä¸­æœ€å¸¸é—®çš„ç‚¹ï¼‰ã€‚
- é’»çŸ³ï¼šæˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªé¡¹ç›®è„šæ‰‹æ¶ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ï¼ˆåŒ…å« `React` å’Œ `Vue`ï¼‰ã€‚
- ç‹è€…ï¼šæˆ‘ä»¬å¯ä»¥å­¦ä¹  `Webpack` çš„åŸç†ï¼Œè¿™ä¹Ÿæ˜¯è¿ˆå‘å¤§ç¥å¿…å¤‡ä¸€æ¡è·¯ã€‚

# å­¦ä¹ èµ„æ–™

- æ‰“å¼€ [å“”å“©å“”å“©open in new window](http://www.bilibili.com/) è§†é¢‘ç½‘ç«™ï¼Œæœç´¢å°šç¡…è°·ã€‚

# å‰è¨€

## ä¸ºä»€ä¹ˆéœ€è¦æ‰“åŒ…å·¥å…·ï¼Ÿ

å¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æ¡†æ¶ï¼ˆReactã€Vueï¼‰ï¼ŒES6 æ¨¡å—åŒ–è¯­æ³•ï¼ŒLess/Sass ç­‰ css é¢„å¤„ç†å™¨ç­‰è¯­æ³•è¿›è¡Œå¼€å‘ã€‚

è¿™æ ·çš„ä»£ç è¦æƒ³åœ¨æµè§ˆå™¨è¿è¡Œå¿…é¡»ç»è¿‡ç¼–è¯‘æˆæµè§ˆå™¨èƒ½è¯†åˆ«çš„ JSã€Css ç­‰è¯­æ³•ï¼Œæ‰èƒ½è¿è¡Œã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰“åŒ…å·¥å…·å¸®æˆ‘ä»¬åšå®Œè¿™äº›äº‹ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæ‰“åŒ…å·¥å…·è¿˜èƒ½å‹ç¼©ä»£ç ã€åšå…¼å®¹æ€§å¤„ç†ã€æå‡ä»£ç æ€§èƒ½ç­‰ã€‚

## æœ‰å“ªäº›æ‰“åŒ…å·¥å…·ï¼Ÿ

- Grunt
- Gulp
- Parcel
- Webpack
- Rollup
- Vite
- ...

ç›®å‰å¸‚é¢ä¸Šæœ€æµé‡çš„æ˜¯ Webpackï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸»è¦ä»¥ Webpack æ¥ä»‹ç»ä½¿ç”¨æ‰“åŒ…å·¥å…·

# åŸºæœ¬ä½¿ç”¨

**`Webpack` æ˜¯ä¸€ä¸ªé™æ€èµ„æºæ‰“åŒ…å·¥å…·ã€‚**

å®ƒä¼šä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä½œä¸ºæ‰“åŒ…çš„å…¥å£ï¼Œå°†æˆ‘ä»¬æ•´ä¸ªé¡¹ç›®æ‰€æœ‰æ–‡ä»¶ç¼–è¯‘ç»„åˆæˆä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶è¾“å‡ºå‡ºå»ã€‚

è¾“å‡ºçš„æ–‡ä»¶å°±æ˜¯ç¼–è¯‘å¥½çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨æ®µè¿è¡Œäº†ã€‚

æˆ‘ä»¬å°† `Webpack` è¾“å‡ºçš„æ–‡ä»¶å«åš `bundle`ã€‚

## åŠŸèƒ½ä»‹ç»

Webpack æœ¬èº«åŠŸèƒ½æ˜¯æœ‰é™çš„:

- å¼€å‘æ¨¡å¼ï¼šä»…èƒ½ç¼–è¯‘ JS ä¸­çš„ `ES Module` è¯­æ³•
- ç”Ÿäº§æ¨¡å¼ï¼šèƒ½ç¼–è¯‘ JS ä¸­çš„ `ES Module` è¯­æ³•ï¼Œè¿˜èƒ½å‹ç¼© JS ä»£ç 

## å¼€å§‹ä½¿ç”¨

### 1. èµ„æºç›®å½•

```
webpack_code # é¡¹ç›®æ ¹ç›®å½•ï¼ˆæ‰€æœ‰æŒ‡ä»¤å¿…é¡»åœ¨è¿™ä¸ªç›®å½•è¿è¡Œï¼‰
    â””â”€â”€ src # é¡¹ç›®æºç ç›®å½•
        â”œâ”€â”€ js # jsæ–‡ä»¶ç›®å½•
        â”‚   â”œâ”€â”€ count.js
        â”‚   â””â”€â”€ sum.js
        â””â”€â”€ main.js # é¡¹ç›®ä¸»æ–‡ä»¶
```

### 2. åˆ›å»ºæ–‡ä»¶

- count.js

```js
export default function count(x, y) {
  return x - y;
}
```

- sum.js

```js
export default function sum(...args) {
  return args.reduce((p, c) => p + c, 0);
}
```

- main.js

```js
import count from "./js/count";
import sum from "./js/sum";

console.log(count(2, 1));
console.log(sum(1, 2, 3, 4));
```

### 3. ä¸‹è½½ä¾èµ–

æ‰“å¼€ç»ˆç«¯ï¼Œæ¥åˆ°é¡¹ç›®æ ¹ç›®å½•ã€‚è¿è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

- åˆå§‹åŒ–`package.json`,åˆå§‹åŒ–åŒ…ç®¡ç†é…ç½®æ–‡ä»¶

```
npm init -y
```

æ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªåŸºç¡€çš„ `package.json` æ–‡ä»¶ã€‚

**éœ€è¦æ³¨æ„çš„æ˜¯ `package.json` ä¸­ `name` å­—æ®µä¸èƒ½å«åš `webpack`, å¦åˆ™ä¸‹ä¸€æ­¥ä¼šæŠ¥é”™**

- ä¸‹è½½ä¾èµ–

```
npm i webpack webpack-cli -D
```

### 4. å¯ç”¨ Webpack

- å¼€å‘æ¨¡å¼

```
npx webpack ./src/main.js --mode=development
```

- ç”Ÿäº§æ¨¡å¼

```
npx webpack ./src/main.js --mode=production
```

`npx webpack`: æ˜¯ç”¨æ¥è¿è¡Œæœ¬åœ°å®‰è£… `Webpack` åŒ…çš„ã€‚

`./src/main.js`: æŒ‡å®š `Webpack` ä» `main.js` æ–‡ä»¶å¼€å§‹æ‰“åŒ…ï¼Œä¸ä½†ä¼šæ‰“åŒ… `main.js`ï¼Œè¿˜ä¼šå°†å…¶ä¾èµ–ä¹Ÿä¸€èµ·æ‰“åŒ…è¿›æ¥ã€‚

`--mode=xxx`ï¼šæŒ‡å®šæ¨¡å¼ï¼ˆç¯å¢ƒï¼‰ã€‚

### 5. è§‚å¯Ÿè¾“å‡ºæ–‡ä»¶

é»˜è®¤ `Webpack` ä¼šå°†æ–‡ä»¶æ‰“åŒ…è¾“å‡ºåˆ° `dist` ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬æŸ¥çœ‹ `dist` ç›®å½•ä¸‹æ–‡ä»¶æƒ…å†µå°±å¥½äº†

## å°ç»“

`Webpack` æœ¬èº«åŠŸèƒ½æ¯”è¾ƒå°‘ï¼Œåªèƒ½å¤„ç† `js` èµ„æºï¼Œä¸€æ—¦é‡åˆ° `css` ç­‰å…¶ä»–èµ„æºå°±ä¼šæŠ¥é”™ã€‚

æ‰€ä»¥æˆ‘ä»¬å­¦ä¹  `Webpack`ï¼Œå°±æ˜¯ä¸»è¦å­¦ä¹ å¦‚ä½•å¤„ç†å…¶ä»–èµ„æºã€‚

# åŸºæœ¬é…ç½®

åœ¨å¼€å§‹ä½¿ç”¨ `Webpack` ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ `Webpack` çš„é…ç½®æœ‰ä¸€å®šçš„è®¤è¯†ã€‚

## 5 å¤§æ ¸å¿ƒæ¦‚å¿µ

1. entryï¼ˆå…¥å£ï¼‰

æŒ‡ç¤º Webpack ä»å“ªä¸ªæ–‡ä»¶å¼€å§‹æ‰“åŒ…

2. outputï¼ˆè¾“å‡ºï¼‰

æŒ‡ç¤º Webpack æ‰“åŒ…å®Œçš„æ–‡ä»¶è¾“å‡ºåˆ°å“ªé‡Œå»ï¼Œå¦‚ä½•å‘½åç­‰

3. loaderï¼ˆåŠ è½½å™¨ï¼‰

webpack æœ¬èº«åªèƒ½å¤„ç† jsã€json ç­‰èµ„æºï¼Œå…¶ä»–èµ„æºéœ€è¦å€ŸåŠ© loaderï¼ŒWebpack æ‰èƒ½è§£æ

4. pluginsï¼ˆæ’ä»¶ï¼‰

æ‰©å±• Webpack çš„åŠŸèƒ½

5. modeï¼ˆæ¨¡å¼ï¼‰

ä¸»è¦ç”±ä¸¤ç§æ¨¡å¼ï¼š

- å¼€å‘æ¨¡å¼ï¼šdevelopment
- ç”Ÿäº§æ¨¡å¼ï¼šproduction

## å‡†å¤‡ Webpack é…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ï¼š`webpack.config.js`

```js
module.exports = {
  // å…¥å£
  entry: "",
  // è¾“å‡º
  output: {},
  // åŠ è½½å™¨
  module: {
    rules: [],
  },
  // æ’ä»¶
  plugins: [],
  // æ¨¡å¼
  mode: "",     //å¼€å‘æ¨¡å¼ï¼šdevelopment       //ç”Ÿäº§æ¨¡å¼ï¼šproduction
};
```

Webpack æ˜¯åŸºäº Node.js è¿è¡Œçš„ï¼Œæ‰€ä»¥é‡‡ç”¨ Common.js æ¨¡å—åŒ–è§„èŒƒ

## ä¿®æ”¹é…ç½®æ–‡ä»¶

1. é…ç½®æ–‡ä»¶

```js
// Node.jsçš„æ ¸å¿ƒæ¨¡å—ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†æ–‡ä»¶è·¯å¾„
const path = require("path");

module.exports = {
  // å…¥å£
  // ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„éƒ½è¡Œ
  entry: "./src/main.js",
  // è¾“å‡º
  output: {
        // path: æ–‡ä»¶è¾“å‡ºç›®å½•ï¼Œå¿…é¡»æ˜¯ç»å¯¹è·¯å¾„
        // path.resolve()æ–¹æ³•è¿”å›ä¸€ä¸ªç»å¯¹è·¯å¾„
        // __dirname ä»£è¡¨å½“å‰æ–‡ä»¶çš„æ–‡ä»¶å¤¹ç›®å½•
        //dist å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„åä¸ºdistçš„ç›®å½•
   path: path.resolve(__dirname, "dist"),
        // filename: è¾“å‡ºæ–‡ä»¶å
   filename: "main.js",
  },
  // åŠ è½½å™¨
  module: {
    rules: [],
  },
  // æ’ä»¶
  plugins: [],
  // æ¨¡å¼
  mode: "development", // å¼€å‘æ¨¡å¼
};
```

2. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ­¤æ—¶åŠŸèƒ½å’Œä¹‹å‰ä¸€æ ·ï¼Œä¹Ÿä¸èƒ½å¤„ç†æ ·å¼èµ„æº

## å°ç»“

Webpack å°†æ¥éƒ½é€šè¿‡ `webpack.config.js` æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œæ¥å¢å¼º Webpack çš„åŠŸèƒ½

æˆ‘ä»¬åé¢ä¼šä»¥ä¸¤ä¸ªæ¨¡å¼æ¥åˆ†åˆ«æ­å»º Webpack çš„é…ç½®ï¼Œå…ˆè¿›è¡Œå¼€å‘æ¨¡å¼ï¼Œå†å®Œæˆç”Ÿäº§æ¨¡å¼

# å¼€å‘æ¨¡å¼ä»‹ç»

å¼€å‘æ¨¡å¼é¡¾åæ€ä¹‰å°±æ˜¯æˆ‘ä»¬å¼€å‘ä»£ç æ—¶ä½¿ç”¨çš„æ¨¡å¼ã€‚

è¿™ä¸ªæ¨¡å¼ä¸‹æˆ‘ä»¬ä¸»è¦åšä¸¤ä»¶äº‹ï¼š

1. ç¼–è¯‘ä»£ç ï¼Œä½¿æµè§ˆå™¨èƒ½è¯†åˆ«è¿è¡Œ

å¼€å‘æ—¶æˆ‘ä»¬æœ‰æ ·å¼èµ„æºã€å­—ä½“å›¾æ ‡ã€å›¾ç‰‡èµ„æºã€html èµ„æºç­‰ï¼Œwebpack é»˜è®¤éƒ½ä¸èƒ½å¤„ç†è¿™äº›èµ„æºï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŠ è½½é…ç½®æ¥ç¼–è¯‘è¿™äº›èµ„æº

2. ä»£ç è´¨é‡æ£€æŸ¥ï¼Œæ ‘ç«‹ä»£ç è§„èŒƒ

æå‰æ£€æŸ¥ä»£ç çš„ä¸€äº›éšæ‚£ï¼Œè®©ä»£ç è¿è¡Œæ—¶èƒ½æ›´åŠ å¥å£®ã€‚

æå‰æ£€æŸ¥ä»£ç è§„èŒƒå’Œæ ¼å¼ï¼Œç»Ÿä¸€å›¢é˜Ÿç¼–ç é£æ ¼ï¼Œè®©ä»£ç æ›´ä¼˜é›…ç¾è§‚ã€‚

# å¤„ç†æ ·å¼èµ„æº

æœ¬ç« èŠ‚æˆ‘ä»¬å­¦ä¹ ä½¿ç”¨ Webpack å¦‚ä½•å¤„ç† Cssã€Lessã€Sassã€Scssã€Styl æ ·å¼èµ„æº

## ä»‹ç»

Webpack æœ¬èº«æ˜¯ä¸èƒ½è¯†åˆ«æ ·å¼èµ„æºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ© Loader æ¥å¸®åŠ© Webpack è§£ææ ·å¼èµ„æº

æˆ‘ä»¬æ‰¾ Loader éƒ½åº”è¯¥å»å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°å¯¹åº”çš„ Loaderï¼Œç„¶åä½¿ç”¨

å®˜æ–¹æ–‡æ¡£æ‰¾ä¸åˆ°çš„è¯ï¼Œå¯ä»¥ä»ç¤¾åŒº Github ä¸­æœç´¢æŸ¥è¯¢

[Webpack å®˜æ–¹ Loader æ–‡æ¡£](https://webpack.docschina.org/loaders/)

## å¤„ç† Css èµ„æº

### 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i css-loader style-loader -D  //ä¸‹è½½ä¾èµ–
```

æ³¨æ„ï¼šéœ€è¦ä¸‹è½½ä¸¤ä¸ª loader

```js
npm i style-loader -D
```

### 2. åŠŸèƒ½ä»‹ç»

- `css-loader`ï¼šè´Ÿè´£å°† Css æ–‡ä»¶ç¼–è¯‘æˆ Webpack èƒ½è¯†åˆ«çš„æ¨¡å—
- `style-loader`ï¼šä¼šåŠ¨æ€åˆ›å»ºä¸€ä¸ª Style æ ‡ç­¾ï¼Œé‡Œé¢æ”¾ç½® Webpack ä¸­ Css æ¨¡å—å†…å®¹

æ­¤æ—¶æ ·å¼å°±ä¼šä»¥ Style æ ‡ç­¾çš„å½¢å¼åœ¨é¡µé¢ä¸Šç”Ÿæ•ˆ

### 3. é…ç½®

```js
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "main.js",
  },
  module: {
    rules: [
      {--------------------------------------------------------------------------------------------
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,-----------------------------------------------------------------------------
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],//å‰åä½ç½®ä¸èƒ½å†™å
      },--------------------------------------------------------------------------------------------
    ],
  },
  plugins: [],
  mode: "development",
};
```

### 4. æ·»åŠ  Css èµ„æº

- åœ¨scræ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–‡ä»¶ï¼Œsrc/css/index.css

```css
.box1 {
  width: 100px;
  height: 100px;
  background-color: pink;
}
```

- src/main.js

```js{3-4}
import count from "./js/count";
import sum from "./js/sum";

import "./css/index.css";  // å¼•å…¥ Css èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…

console.log(count(2, 1));
console.log(sum(1, 2, 3, 4));
```

- public/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webpack5</title>
  </head>
  <body>
    <h1>Hello Webpack5</h1>
    <!-- å‡†å¤‡ä¸€ä¸ªä½¿ç”¨æ ·å¼çš„ DOM å®¹å™¨ -->
    <div class="box1"></div>
    <!-- å¼•å…¥æ‰“åŒ…åçš„jsæ–‡ä»¶ï¼Œæ‰èƒ½çœ‹åˆ°æ•ˆæœ -->
    <script src="../dist/main.js"></script> //è¿™è¡Œä»£ç è¦æ³¨æ„
  </body>
</html>
```

### 5. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€ index.html é¡µé¢æŸ¥çœ‹æ•ˆæœ

##### æ³¨æ„ï¼Œä¸ç®¡åœ¨é‚£ç§æ¨¡å¼ä¸‹åˆ›å»ºçš„jsæ–‡ä»¶æˆ–cssæ–‡ä»¶ï¼Œéƒ½è¦åœ¨å…¥å£æ–‡ä»¶main.jsä¸­å»å¼•å…¥ï¼Œç„¶åå†åˆ°publicçš„htmlæ–‡ä»¶ä¸­å¼•å…¥æ‰“åŒ…å¥½çš„jsæ–‡ä»¶<script src="../dist/main.js"></script> //è¿™è¡Œä»£ç è¦æ³¨æ„ï¼Œæ‰èƒ½çœ‹å¾—åˆ°æ•ˆæœ

## å¤„ç† Less èµ„æº

### 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i less-loader -D
```

### 2. åŠŸèƒ½ä»‹ç»

- `less-loader`ï¼šè´Ÿè´£å°† Less æ–‡ä»¶ç¼–è¯‘æˆ Css æ–‡ä»¶

### 3. é…ç½®

```js
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "main.js",
  },
  module: {//åŠ è½½å™¨
    rules: [
      {
        test: /\.css$/,  // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶ï¼ˆåªæ£€æµ‹ä»¥cssç»“å°¾çš„æ–‡ä»¶ï¼‰
       
        use: [   // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼ˆä»ä¸‹åˆ°ä¸Šï¼‰
        "style-loader", //å°†jsä¸­çš„CSSé€šè¿‡åˆ›å»ºstyleæ ‡ç­¾æ·»åŠ htmlæ–‡ä»¶ä¸­ç”Ÿæ•ˆ
        "css-loader" //å°†cssèµ„æºç¼–è¯‘æˆcommentjsçš„æ¨¡å—åˆ°jsä¸­
        ], 
      }
      {----------------------------------------------------------------------------------------
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },---------------------------------------------------------------------------------------
    ],
  },
  plugins: [],
  mode: "development",
};
```

### 4. æ·»åŠ  Less èµ„æº

- src/less/index.less

```css
.box2 {
  width: 100px;
  height: 100px;
  background-color: deeppink;
}
```

- src/main.js

```js{5}
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/index.css";
import "./less/index.less";

console.log(count(2, 1));
console.log(sum(1, 2, 3, 4));
```

- public/index.html

```html{12}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webpack5</title>
  </head>
  <body>
    <h1>Hello Webpack5</h1>
    <div class="box1"></div>
    <div class="box2"></div>
    <script src="../dist/main.js"></script>
  </body>
</html>
```

### 5. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€ index.html é¡µé¢æŸ¥çœ‹æ•ˆæœ

## å¤„ç† Sass å’Œ Scss èµ„æº

### 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i sass-loader sass -D
```

æ³¨æ„ï¼šéœ€è¦ä¸‹è½½ä¸¤ä¸ª

### 2. åŠŸèƒ½ä»‹ç»

- `sass-loader`ï¼šè´Ÿè´£å°† Sass æ–‡ä»¶ç¼–è¯‘æˆ css æ–‡ä»¶
- `sass`ï¼š`sass-loader` ä¾èµ– `sass` è¿›è¡Œç¼–è¯‘

### 3. é…ç½®

```js{21-24}
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "main.js",
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
    ],
  },
  plugins: [],
  mode: "development",
};
```

### 4. æ·»åŠ  Sass èµ„æº

- src/sass/index.sass

```css
/* å¯ä»¥çœç•¥å¤§æ‹¬å·å’Œåˆ†å· */
.box3
  width: 100px
  height: 100px
  background-color: hotpink
```

- src/sass/index.scss

```css
.box4 {
  width: 100px;
  height: 100px;
  background-color: lightpink;
}
```

- src/main.js

```js{6-7}
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";

console.log(count(2, 1));
console.log(sum(1, 2, 3, 4));
```

- public/index.html

```html{13-14}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webpack5</title>
  </head>
  <body>
    <h1>Hello Webpack5</h1>
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
    <div class="box4"></div>
    <script src="../dist/main.js"></script>
  </body>
</html>
```

### 5. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€ index.html é¡µé¢æŸ¥çœ‹æ•ˆæœ

## å¤„ç† Styl èµ„æº

### 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i stylus-loader -D
```

### 2. åŠŸèƒ½ä»‹ç»

- `stylus-loader`ï¼šè´Ÿè´£å°† Styl æ–‡ä»¶ç¼–è¯‘æˆ Css æ–‡ä»¶

### 3. é…ç½®

```js{25-28}
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "main.js",
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
    ],
  },
  plugins: [],
  mode: "development",
};
```

### 4. æ·»åŠ  Styl èµ„æº

- src/styl/index.styl

```css
/* å¯ä»¥çœç•¥å¤§æ‹¬å·ã€åˆ†å·ã€å†’å· */
.box 
  width 100px 
  height 100px 
  background-color pink
```

- src/main.js

```js{9}
import { add } from "./math";
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

console.log(count(2, 1));
console.log(sum(1, 2, 3, 4));
```

- public/index.html

```html{16}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webpack5</title>
  </head>
  <body>
    <h1>Hello Webpack5</h1>
    <!-- å‡†å¤‡ä¸€ä¸ªä½¿ç”¨æ ·å¼çš„ DOM å®¹å™¨ -->
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
    <div class="box4"></div>
    <div class="box5"></div>
    <script src="../dist/main.js"></script>
  </body>
</html>
```

### 5. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€ index.html é¡µé¢æŸ¥çœ‹æ•ˆæœ

# å¤„ç†å›¾ç‰‡èµ„æº

è¿‡å»åœ¨ Webpack4 æ—¶ï¼Œæˆ‘ä»¬å¤„ç†å›¾ç‰‡èµ„æºé€šè¿‡ `file-loader` å’Œ `url-loader` è¿›è¡Œå¤„ç†

ç°åœ¨ Webpack5 å·²ç»å°†ä¸¤ä¸ª Loader åŠŸèƒ½å†…ç½®åˆ° Webpack é‡Œäº†ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•é…ç½®å³å¯å¤„ç†å›¾ç‰‡èµ„æº

## 1. é…ç½®

```js
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "main.js",
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {--------------------------------------------------------------------
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
      },------------------------------------------------------------------
    ],
  },
  plugins: [],
  mode: "development",
};
```

## 2. æ·»åŠ å›¾ç‰‡èµ„æº

- src/images/1.jpeg
- src/images/2.png
- src/images/3.gif

## 3. ä½¿ç”¨å›¾ç‰‡èµ„æº

- src/less/index.less

```css
.box2 {
  width: 100px;
  height: 100px;
  background-image: url("../images/1.jpeg");
  background-size: cover;
}
```

- src/sass/index.sass

```css
.box3
  width: 100px
  height: 100px
  background-image: url("../images/2.png")
  background-size: cover
```

- src/styl/index.styl

```css
.box5
  width 100px
  height 100px
  background-image url("../images/3.gif")
  background-size cover
```

## 4. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€ index.html é¡µé¢æŸ¥çœ‹æ•ˆæœ

## 5. è¾“å‡ºèµ„æºæƒ…å†µ

æ­¤æ—¶å¦‚æœæŸ¥çœ‹ dist ç›®å½•çš„è¯ï¼Œä¼šå‘ç°å¤šäº†ä¸‰å¼ å›¾ç‰‡èµ„æº

å› ä¸º Webpack ä¼šå°†æ‰€æœ‰æ‰“åŒ…å¥½çš„èµ„æºè¾“å‡ºåˆ° dist ç›®å½•ä¸‹

- ä¸ºä»€ä¹ˆæ ·å¼èµ„æºæ²¡æœ‰å‘¢ï¼Ÿ

å› ä¸ºç»è¿‡ `style-loader` çš„å¤„ç†ï¼Œæ ·å¼èµ„æºæ‰“åŒ…åˆ° main.js é‡Œé¢å»äº†ï¼Œæ‰€ä»¥æ²¡æœ‰é¢å¤–è¾“å‡ºå‡ºæ¥

## 6. å¯¹å›¾ç‰‡èµ„æºè¿›è¡Œä¼˜åŒ–

å°†å°äºæŸä¸ªå¤§å°çš„å›¾ç‰‡è½¬åŒ–æˆ data URI å½¢å¼ï¼ˆBase64 æ ¼å¼ï¼‰

```js
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "main.js",
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      
      
      
      //ä¼˜åŒ–å›¾ç‰‡é…ç½®ä»£ç 
      {--------------------------------------------------------
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024 // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†,å¯ä»¥å‡å°‘è¯·æ±‚æ•°é‡ï¼Œç¼ºç‚¹æ˜¯ä½“ç§¯ä¼šå˜å¤§
          }
        }
      },------------------------------------------------------------------
    ],
  },
  plugins: [],
  mode: "development",
};
```

- ä¼˜ç‚¹ï¼šå‡å°‘è¯·æ±‚æ•°é‡
- ç¼ºç‚¹ï¼šä½“ç§¯å˜å¾—æ›´å¤§

æ­¤æ—¶è¾“å‡ºçš„å›¾ç‰‡æ–‡ä»¶å°±åªæœ‰ä¸¤å¼ ï¼Œæœ‰ä¸€å¼ å›¾ç‰‡ä»¥ data URI å½¢å¼å†…ç½®åˆ° js ä¸­äº†
ï¼ˆæ³¨æ„ï¼šéœ€è¦å°†ä¸Šæ¬¡æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶æ¸…ç©ºï¼Œå†é‡æ–°æ‰“åŒ…æ‰æœ‰æ•ˆæœï¼‰

# ä¿®æ”¹è¾“å‡ºèµ„æºçš„åç§°å’Œè·¯å¾„

## 1. é…ç½® generatorï¼Œå¯ä»¥ä¿®æ”¹å›¾ç‰‡è·¯å¾„

```js
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­ï¼Œæ³¨æ„è¿™æ®µä»£ç æ˜¯ä¿®æ”¹å…¥å£æ–‡ä»¶è·¯å¾„çš„
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
          
         // ä¿®æ”¹å›¾ç‰‡è·¯å¾„ä»£ç  generator--------------------------------------------------------------------
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
    ],
  },
  plugins: [],
  mode: "development",
};
```

## 2. ä¿®æ”¹ index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webpack5</title>
  </head>
  <body>
    <h1>Hello Webpack5</h1>
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
    <div class="box4"></div>
    <div class="box5"></div>
    <!-- ä¿®æ”¹ js èµ„æºè·¯å¾„ -->
    <script src="../dist/static/js/main.js"></script>//è¿™æ®µä»£ç ï¼Œé‡æ–°ä¿®æ”¹è·¯å¾„
  </body>
</html>
```

## 3. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

- æ­¤æ—¶è¾“å‡ºæ–‡ä»¶ç›®å½•ï¼š

ï¼ˆæ³¨æ„ï¼šéœ€è¦å°†ä¸Šæ¬¡æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶æ¸…ç©ºï¼Œå†é‡æ–°æ‰“åŒ…æ‰æœ‰æ•ˆæœï¼‰

```
â”œâ”€â”€ dist
    â””â”€â”€ static
         â”œâ”€â”€ imgs
         â”‚    â””â”€â”€ 7003350e.png
         â””â”€â”€ js
              â””â”€â”€ main.js
```

# è‡ªåŠ¨æ¸…ç©ºä¸Šæ¬¡æ‰“åŒ…èµ„æº

## 1. é…ç½® clean: true, // è‡ªåŠ¨å°†ä¸Šæ¬¡æ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©º

```js{8}
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js",
    clean: true, // åœ¨æ‰“åŒ…ä¹‹å‰ï¼Œè‡ªåŠ¨å°†pathæ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©ºï¼Œåœ¨é‡æ–°æ‰“åŒ…
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 40 * 1024, // å°äº40kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
    ],
  },
  plugins: [],
  mode: "development",
};
```

## 2. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

è§‚å¯Ÿ dist ç›®å½•èµ„æºæƒ…å†µ

# å¤„ç†å­—ä½“å›¾æ ‡èµ„æº

## 1. ä¸‹è½½å­—ä½“å›¾æ ‡æ–‡ä»¶

1. æ‰“å¼€[é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“](https://www.iconfont.cn/)

2. é€‰æ‹©æƒ³è¦çš„å›¾æ ‡æ·»åŠ åˆ°è´­ç‰©è½¦ï¼Œç»Ÿä¸€ä¸‹è½½åˆ°æœ¬åœ°

## 2. æ·»åŠ å­—ä½“å›¾æ ‡èµ„æº

- src/fonts/iconfont.ttf
- src/fonts/iconfont.woff
- src/fonts/iconfont.woff2

- src/css/iconfont.css

  - æ³¨æ„å­—ä½“æ–‡ä»¶è·¯å¾„éœ€è¦ä¿®æ”¹

- src/main.js

```js{5}
import { add } from "./math";
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

console.log(count(2, 1));
console.log(sum(1, 2, 3, 4));
```

- public/index.html

```html{16-19}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webpack5</title>
  </head>
  <body>
    <h1>Hello Webpack5</h1>
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
    <div class="box4"></div>
    <div class="box5"></div>
    <!-- ä½¿ç”¨å­—ä½“å›¾æ ‡ -->
    <i class="iconfont icon-arrow-down"></i>
    <i class="iconfont icon-ashbin"></i>
    <i class="iconfont icon-browse"></i>
    <script src="../dist/static/js/main.js"></script>
  </body>
</html>
```

## 3. é…ç½®generatorï¼Œä¿®æ”¹å­—ä½“å›¾æ ‡è·¯å¾„

```js
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true, // è‡ªåŠ¨å°†ä¸Šæ¬¡æ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©º
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
        
        
       // ä¿®æ”¹å­—ä½“å›¾æ ‡è·¯å¾„
      {
        test: /\.(ttf|woff2?)$/,//å­—ä½“å›¾æ ‡æ ¼å¼
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]", //è¾“å‡ºæ–‡ä»¶è·¯å¾„
        },
      },
    ],
  },
  plugins: [],
  mode: "development",
};
```

`type: "asset/resource"`å’Œ`type: "asset"`çš„åŒºåˆ«ï¼š

1. `type: "asset/resource"` ç›¸å½“äº`file-loader`, å°†æ–‡ä»¶è½¬åŒ–æˆ Webpack èƒ½è¯†åˆ«çš„èµ„æºï¼Œå…¶ä»–ä¸åšå¤„ç†
2. `type: "asset"` ç›¸å½“äº`url-loader`, å°†æ–‡ä»¶è½¬åŒ–æˆ Webpack èƒ½è¯†åˆ«çš„èµ„æºï¼ŒåŒæ—¶å°äºæŸä¸ªå¤§å°çš„èµ„æºä¼šå¤„ç†æˆ data URI å½¢å¼

## 4. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€ index.html é¡µé¢æŸ¥çœ‹æ•ˆæœ

# å¤„ç†å…¶ä»–èµ„æº

å¼€å‘ä¸­å¯èƒ½è¿˜å­˜åœ¨ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚éŸ³è§†é¢‘ç­‰ï¼Œæˆ‘ä»¬ä¹Ÿä¸€èµ·å¤„ç†äº†

## 1. é…ç½®

```js
const path = require("path");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true, // è‡ªåŠ¨å°†ä¸Šæ¬¡æ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©º
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      
      //å¤„ç†å…¶ä»–èµ„æºï¼ŒéŸ³é¢‘
      {
        test: /\.(ttf|woff2?|map4|map3|avi)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
    ],
  },
  plugins: [],
  mode: "development",
};
```

å°±æ˜¯åœ¨å¤„ç†å­—ä½“å›¾æ ‡èµ„æºåŸºç¡€ä¸Šå¢åŠ å…¶ä»–æ–‡ä»¶ç±»å‹ï¼Œç»Ÿä¸€å¤„ç†å³å¯

## 2. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€ index.html é¡µé¢æŸ¥çœ‹æ•ˆæœ

# å¤„ç† js èµ„æº

æœ‰äººå¯èƒ½ä¼šé—®ï¼Œjs èµ„æº Webpack ä¸èƒ½å·²ç»å¤„ç†äº†å—ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦å¤„ç†å‘¢ï¼Ÿ

åŸå› æ˜¯ Webpack å¯¹ js å¤„ç†æ˜¯æœ‰é™çš„ï¼Œåªèƒ½ç¼–è¯‘ js ä¸­ ES æ¨¡å—åŒ–è¯­æ³•ï¼Œä¸èƒ½ç¼–è¯‘å…¶ä»–è¯­æ³•ï¼Œå¯¼è‡´ js ä¸èƒ½åœ¨ IE ç­‰æµè§ˆå™¨è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›åšä¸€äº›å…¼å®¹æ€§å¤„ç†ã€‚

å…¶æ¬¡å¼€å‘ä¸­ï¼Œå›¢é˜Ÿå¯¹ä»£ç æ ¼å¼æ˜¯æœ‰ä¸¥æ ¼è¦æ±‚çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ç”±è‚‰çœ¼å»æ£€æµ‹ä»£ç æ ¼å¼ï¼Œéœ€è¦ä½¿ç”¨ä¸“ä¸šçš„å·¥å…·æ¥æ£€æµ‹ã€‚

- é’ˆå¯¹ js å…¼å®¹æ€§å¤„ç†ï¼Œæˆ‘ä»¬ä½¿ç”¨ Babel æ¥å®Œæˆ
- é’ˆå¯¹ä»£ç æ ¼å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ Eslint æ¥å®Œæˆ

æˆ‘ä»¬å…ˆå®Œæˆ Eslintï¼Œæ£€æµ‹ä»£ç æ ¼å¼æ— è¯¯åï¼Œåœ¨ç”± Babel åšä»£ç å…¼å®¹æ€§å¤„ç†

## Eslint

å¯ç»„è£…çš„ JavaScript å’Œ JSX æ£€æŸ¥å·¥å…·ã€‚

è¿™å¥è¯æ„æ€å°±æ˜¯ï¼šå®ƒæ˜¯ç”¨æ¥æ£€æµ‹ js å’Œ jsx è¯­æ³•çš„å·¥å…·ï¼Œå¯ä»¥é…ç½®å„é¡¹åŠŸèƒ½

æˆ‘ä»¬ä½¿ç”¨ Eslintï¼Œå…³é”®æ˜¯å†™ Eslint é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Šå„ç§ rules è§„åˆ™ï¼Œå°†æ¥è¿è¡Œ Eslint æ—¶å°±ä¼šä»¥å†™çš„è§„åˆ™å¯¹ä»£ç è¿›è¡Œæ£€æŸ¥

### 1. é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ç”±å¾ˆå¤šç§å†™æ³•ï¼š

- `.eslintrc.*`ï¼šæ–°å»ºæ–‡ä»¶ï¼Œä½äºé¡¹ç›®æ ¹ç›®å½•
  - `.eslintrc`
  - `.eslintrc.js`
  - `.eslintrc.json`
  - åŒºåˆ«åœ¨äºé…ç½®æ ¼å¼ä¸ä¸€æ ·
- `package.json` ä¸­ `eslintConfig`ï¼šä¸éœ€è¦åˆ›å»ºæ–‡ä»¶ï¼Œåœ¨åŸæœ‰æ–‡ä»¶åŸºç¡€ä¸Šå†™

ESLint ä¼šæŸ¥æ‰¾å’Œè‡ªåŠ¨è¯»å–å®ƒä»¬ï¼Œæ‰€ä»¥ä»¥ä¸Šé…ç½®æ–‡ä»¶åªéœ€è¦å­˜åœ¨ä¸€ä¸ªå³å¯

### 2. å…·ä½“é…ç½®

æˆ‘ä»¬ä»¥ `.eslintrc.js` é…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼š

```js
module.exports = {
  // è§£æé€‰é¡¹
  parserOptions: {},
  // å…·ä½“æ£€æŸ¥è§„åˆ™
  rules: {},
  // ç»§æ‰¿å…¶ä»–è§„åˆ™
  extends: [],
  // ...
  // å…¶ä»–è§„åˆ™è¯¦è§ï¼šhttps://eslint.bootcss.com/docs/user-guide/configuring
};
```

1. parserOptions è§£æé€‰é¡¹

```js
parserOptions: {
  ecmaVersion: 6, // ES è¯­æ³•ç‰ˆæœ¬
  sourceType: "module", // ES æ¨¡å—åŒ–
  ecmaFeatures: { // ES å…¶ä»–ç‰¹æ€§
    jsx: true // å¦‚æœæ˜¯ React é¡¹ç›®ï¼Œå°±éœ€è¦å¼€å¯ jsx è¯­æ³•
  }
}
```

2. rules å…·ä½“è§„åˆ™

- `"off"` æˆ– `0` - å…³é—­è§„åˆ™
- xxxxxxxxxxÂ npm run build:no-line-numbers
- `"error"` æˆ– `2` - å¼€å¯è§„åˆ™ï¼Œä½¿ç”¨é”™è¯¯çº§åˆ«çš„é”™è¯¯ï¼š`error` (å½“è¢«è§¦å‘çš„æ—¶å€™ï¼Œç¨‹åºä¼šé€€å‡º)

```js
rules: {
  semi: "error", // ç¦æ­¢ä½¿ç”¨åˆ†å·
  'array-callback-return': 'warn', // å¼ºåˆ¶æ•°ç»„æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸­æœ‰ return è¯­å¥ï¼Œå¦åˆ™è­¦å‘Š
  'default-case': [
    'warn', // è¦æ±‚ switch è¯­å¥ä¸­æœ‰ default åˆ†æ”¯ï¼Œå¦åˆ™è­¦å‘Š
    { commentPattern: '^no default$' } // å…è®¸åœ¨æœ€åæ³¨é‡Š no default, å°±ä¸ä¼šæœ‰è­¦å‘Šäº†
  ],
  eqeqeq: [
    'warn', // å¼ºåˆ¶ä½¿ç”¨ === å’Œ !==ï¼Œå¦åˆ™è­¦å‘Š
    'smart' // https://eslint.bootcss.com/docs/rules/eqeqeq#smart é™¤äº†å°‘æ•°æƒ…å†µä¸‹ä¸ä¼šæœ‰è­¦å‘Š
  ],
}
```

æ›´å¤šè§„åˆ™è¯¦è§ï¼š[è§„åˆ™æ–‡æ¡£](https://eslint.bootcss.com/docs/rules/)

3. extends ç»§æ‰¿

å¼€å‘ä¸­ä¸€ç‚¹ç‚¹å†™ rules è§„åˆ™å¤ªè´¹åŠ²äº†ï¼Œæ‰€ä»¥æœ‰æ›´å¥½çš„åŠæ³•ï¼Œç»§æ‰¿ç°æœ‰çš„è§„åˆ™ã€‚

ç°æœ‰ä»¥ä¸‹è¾ƒä¸ºæœ‰åçš„è§„åˆ™ï¼š

- [Eslint å®˜æ–¹çš„è§„åˆ™](https://eslint.bootcss.com/docs/rules/)ï¼š`eslint:recommended`
- [Vue Cli å®˜æ–¹çš„è§„åˆ™](https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-plugin-eslint)ï¼š`plugin:vue/essential`
- [React Cli å®˜æ–¹çš„è§„åˆ™](https://github.com/facebook/create-react-app/tree/main/packages/eslint-config-react-app)ï¼š`react-app`

```js
// ä¾‹å¦‚åœ¨Reacté¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™é…ç½®
module.exports = {
  extends: ["react-app"],
  rules: {
    // æˆ‘ä»¬çš„è§„åˆ™ä¼šè¦†ç›–æ‰react-appçš„è§„åˆ™
    // æ‰€ä»¥æƒ³è¦ä¿®æ”¹è§„åˆ™ç›´æ¥æ”¹å°±æ˜¯äº†
    eqeqeq: ["warn", "smart"],
  },
};
```

### 3. åœ¨ Webpack ä¸­ä½¿ç”¨

1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i eslint-webpack-plugin eslint -D
```

2. å®šä¹‰ Eslint é…ç½®æ–‡ä»¶

- .eslintrc.js

```js
module.exports = {
  // ç»§æ‰¿ Eslint è§„åˆ™
  extends: ["eslint:recommended"],
  env: {
    node: true, // å¯ç”¨nodeä¸­å…¨å±€å˜é‡
    browser: true, // å¯ç”¨æµè§ˆå™¨ä¸­å…¨å±€å˜é‡
  },
  parserOptions: {
    ecmaVersion: 6,
    sourceType: "module",
  },
  rules: {
    "no-var": 2, // ä¸èƒ½ä½¿ç”¨ var å®šä¹‰å˜é‡
  },
};
```

3. ä¿®æ”¹ js æ–‡ä»¶ä»£ç 

- main.js

```js{11-14}
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

var result1 = count(2, 1);
console.log(result1);
var result2 = sum(1, 2, 3, 4);
console.log(result2);
```

1. é…ç½®

- webpack.config.js

```js{2,58-61}
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true, // è‡ªåŠ¨å°†ä¸Šæ¬¡æ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©º
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "src"),
    }),
  ],
  mode: "development",
};
```

5. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

åœ¨æ§åˆ¶å°æŸ¥çœ‹ Eslint æ£€æŸ¥æ•ˆæœ

### 4. VSCode Eslint æ’ä»¶

æ‰“å¼€ VSCodeï¼Œä¸‹è½½ Eslint æ’ä»¶ï¼Œå³å¯ä¸ç”¨ç¼–è¯‘å°±èƒ½çœ‹åˆ°é”™è¯¯ï¼Œå¯ä»¥æå‰è§£å†³

ä½†æ˜¯æ­¤æ—¶å°±ä¼šå¯¹é¡¹ç›®æ‰€æœ‰æ–‡ä»¶é»˜è®¤è¿›è¡Œ Eslint æ£€æŸ¥äº†ï¼Œæˆ‘ä»¬ dist ç›®å½•ä¸‹çš„æ‰“åŒ…åæ–‡ä»¶å°±ä¼šæŠ¥é”™ã€‚ä½†æ˜¯æˆ‘ä»¬åªéœ€è¦æ£€æŸ¥ src ä¸‹é¢çš„æ–‡ä»¶ï¼Œä¸éœ€è¦æ£€æŸ¥ dist ä¸‹é¢çš„æ–‡ä»¶ã€‚

æ‰€ä»¥å¯ä»¥ä½¿ç”¨ Eslint å¿½ç•¥æ–‡ä»¶è§£å†³ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºä¸‹é¢æ–‡ä»¶:

- `.eslintignore`

```
# å¿½ç•¥distç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
dist
```

## Babel

JavaScript ç¼–è¯‘å™¨ã€‚

ä¸»è¦ç”¨äºå°† ES6 è¯­æ³•ç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­

### 1. é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ç”±å¾ˆå¤šç§å†™æ³•ï¼š

- `babel.config.*`ï¼šæ–°å»ºæ–‡ä»¶ï¼Œä½äºé¡¹ç›®æ ¹ç›®å½•
  - `babel.config.js`
  - `babel.config.json`
- `.babelrc.*`ï¼šæ–°å»ºæ–‡ä»¶ï¼Œä½äºé¡¹ç›®æ ¹ç›®å½•
  - `.babelrc`
  - `.babelrc.js`
  - `.babelrc.json`
- `package.json` ä¸­ `babel`ï¼šä¸éœ€è¦åˆ›å»ºæ–‡ä»¶ï¼Œåœ¨åŸæœ‰æ–‡ä»¶åŸºç¡€ä¸Šå†™

Babel ä¼šæŸ¥æ‰¾å’Œè‡ªåŠ¨è¯»å–å®ƒä»¬ï¼Œæ‰€ä»¥ä»¥ä¸Šé…ç½®æ–‡ä»¶åªéœ€è¦å­˜åœ¨ä¸€ä¸ªå³å¯

### 2. å…·ä½“é…ç½®

æˆ‘ä»¬ä»¥ `babel.config.js` é…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼š

```js
module.exports = {
  // é¢„è®¾
  presets: [],
};
```

1. presets é¢„è®¾

ç®€å•ç†è§£ï¼šå°±æ˜¯ä¸€ç»„ Babel æ’ä»¶, æ‰©å±• Babel åŠŸèƒ½

- `@babel/preset-env`: ä¸€ä¸ªæ™ºèƒ½é¢„è®¾ï¼Œå…è®¸æ‚¨ä½¿ç”¨æœ€æ–°çš„ JavaScriptã€‚
- `@babel/preset-react`ï¼šä¸€ä¸ªç”¨æ¥ç¼–è¯‘ React jsx è¯­æ³•çš„é¢„è®¾
- `@babel/preset-typescript`ï¼šä¸€ä¸ªç”¨æ¥ç¼–è¯‘ TypeScript è¯­æ³•çš„é¢„è®¾

### 3. åœ¨ Webpack ä¸­ä½¿ç”¨

1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i babel-loader @babel/core @babel/preset-env -D
```

2. å®šä¹‰ Babel é…ç½®æ–‡ä»¶

- babel.config.js

```js
module.exports = {
  presets: ["@babel/preset-env"],
};
```

3. ä¿®æ”¹ js æ–‡ä»¶ä»£ç 

- main.js

```js
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

const result1 = count(2, 1);
console.log(result1);
const result2 = sum(1, 2, 3, 4);
console.log(result2);
```

4. é…ç½®

- webpack.config.js

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true, // è‡ªåŠ¨å°†ä¸Šæ¬¡æ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©º
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {----------------------------------------------------------------------------------------------------
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘ï¼Œé‡Œé¢æ˜¯ç¬¬ä¸‰æ–¹åŒ…ï¼Œä¸éœ€è¦å…³å¿ƒç¬¬ä¸‰æ–¹åŒ…çš„å…¼å®¹æ€§
        loader: "babel-loader",
      },--------------------------------------------------------------------------------------------------
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "src"),
    }),
  ],
  mode: "development",
};
```

5. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ‰“å¼€æ‰“åŒ…åçš„ `dist/static/js/main.js` æ–‡ä»¶æŸ¥çœ‹ï¼Œä¼šå‘ç°ç®­å¤´å‡½æ•°ç­‰ ES6 è¯­æ³•å·²ç»è½¬æ¢äº†

# å¤„ç† Html èµ„æº

## 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i html-webpack-plugin -D
```

## 2. é…ç½®   HtmlWebpackPlugin   , è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº

- webpack.config.js

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");

const HtmlWebpackPlugin = require("html-webpack-plugin"); //å¼•å…¥æ–‡ä»¶-------------------------------------

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true, // è‡ªåŠ¨å°†ä¸Šæ¬¡æ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©º
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "src"),
    }),
      
     // è°ƒç”¨è¯¥æ’ä»¶----------------------------------------------------------------------------------
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "public/index.html"),
    }),
  ],
  mode: "development",
};
```

## 3. ä¿®æ”¹ index.html

å»æ‰å¼•å…¥çš„ js æ–‡ä»¶ï¼Œå› ä¸º HtmlWebpackPlugin ä¼šè‡ªåŠ¨å¼•å…¥

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webpack5</title>
  </head>
  <body>
    <h1>Hello Webpack5</h1>
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
    <div class="box4"></div>
    <div class="box5"></div>
    <i class="iconfont icon-arrow-down"></i>
    <i class="iconfont icon-ashbin"></i>
    <i class="iconfont icon-browse"></i>
  </body>
</html>
```

## 4. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack
```

æ­¤æ—¶ dist ç›®å½•å°±ä¼šè¾“å‡ºä¸€ä¸ª index.html æ–‡ä»¶

# å¼€å‘æœåŠ¡å™¨&è‡ªåŠ¨åŒ–

æ¯æ¬¡å†™å®Œä»£ç éƒ½éœ€è¦æ‰‹åŠ¨è¾“å…¥æŒ‡ä»¤æ‰èƒ½ç¼–è¯‘ä»£ç ï¼Œå¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€åˆ‡è‡ªåŠ¨åŒ–

## 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i webpack-dev-server -D   //-Dè¡¨ç¤ºåªåœ¨å¼€å‘é˜¶æ®µä¼šç”¨åˆ°------------------------------------------------

```

## 2. é…ç½®

- webpack.config.js

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true, // è‡ªåŠ¨å°†ä¸Šæ¬¡æ‰“åŒ…ç›®å½•èµ„æºæ¸…ç©º
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "src"),
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "public/index.html"),
    }),
  ],
    
    
  // å¼€å‘æœåŠ¡å™¨,æ¯æ¬¡ä¿®æ”¹æºä»£ç è‡ªåŠ¨è¿›è¡Œæ‰“åŒ…ï¼ˆé»˜è®¤è¿›è¡Œï¼Œä¸éœ€è¦ä¿®æ”¹é…ç½®ï¼‰-----------------------------------------
  devServer: {
    host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
    port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
    open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },--------------------------------------------------------------------------------------------------
    
    
  mode: "development",
};
```

## 3. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npx webpack serve
```

**æ³¨æ„è¿è¡ŒæŒ‡ä»¤å‘ç”Ÿäº†å˜åŒ–**

å¹¶ä¸”å½“ä½ ä½¿ç”¨å¼€å‘æœåŠ¡å™¨æ—¶ï¼Œæ‰€æœ‰ä»£ç éƒ½ä¼šåœ¨å†…å­˜ä¸­ç¼–è¯‘æ‰“åŒ…ï¼Œå¹¶ä¸ä¼šè¾“å‡ºåˆ° dist ç›®å½•ä¸‹ã€‚

å¼€å‘æ—¶æˆ‘ä»¬åªå…³å¿ƒä»£ç èƒ½è¿è¡Œï¼Œæœ‰æ•ˆæœå³å¯ï¼Œè‡³äºä»£ç è¢«ç¼–è¯‘æˆä»€ä¹ˆæ ·å­ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦çŸ¥é“ã€‚

# ç”Ÿäº§æ¨¡å¼ä»‹ç»

ç”Ÿäº§æ¨¡å¼æ˜¯å¼€å‘å®Œæˆä»£ç åï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°ä»£ç å°†æ¥éƒ¨ç½²ä¸Šçº¿ã€‚

è¿™ä¸ªæ¨¡å¼ä¸‹æˆ‘ä»¬ä¸»è¦å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œè®©å…¶è¿è¡Œæ€§èƒ½æ›´å¥½ã€‚

ä¼˜åŒ–ä¸»è¦ä»ä¸¤ä¸ªè§’åº¦å‡ºå‘:

1. ä¼˜åŒ–ä»£ç è¿è¡Œæ€§èƒ½
2. ä¼˜åŒ–ä»£ç æ‰“åŒ…é€Ÿåº¦

## ç”Ÿäº§æ¨¡å¼å‡†å¤‡

æˆ‘ä»¬åˆ†åˆ«å‡†å¤‡ä¸¤ä¸ªé…ç½®æ–‡ä»¶æ¥æ”¾ä¸åŒçš„é…ç½®

### 1. æ–‡ä»¶ç›®å½•

```:no-line-numbers
â”œâ”€â”€ webpack-test (é¡¹ç›®æ ¹ç›®å½•)
    â”œâ”€â”€ config (Webpacké…ç½®æ–‡ä»¶ç›®å½•)
    â”‚    â”œâ”€â”€ webpack.dev.js(å¼€å‘æ¨¡å¼é…ç½®æ–‡ä»¶)
    â”‚    â””â”€â”€ webpack.prod.js(ç”Ÿäº§æ¨¡å¼é…ç½®æ–‡ä»¶)
    â”œâ”€â”€ node_modules (ä¸‹è½½åŒ…å­˜æ”¾ç›®å½•)
    â”œâ”€â”€ src (é¡¹ç›®æºç ç›®å½•ï¼Œé™¤äº†htmlå…¶ä»–éƒ½åœ¨srcé‡Œé¢)
    â”‚    â””â”€â”€ ç•¥
    â”œâ”€â”€ public (é¡¹ç›®htmlæ–‡ä»¶)
    â”‚    â””â”€â”€ index.html
    â”œâ”€â”€ .eslintrc.js(Eslinté…ç½®æ–‡ä»¶)
    â”œâ”€â”€ babel.config.js(Babelé…ç½®æ–‡ä»¶)
    â””â”€â”€ package.json (åŒ…çš„ä¾èµ–ç®¡ç†é…ç½®æ–‡ä»¶)
```

### 2. ä¿®æ”¹ webpack.dev.js

#### å› ä¸ºæ–‡ä»¶ç›®å½•å˜äº†ï¼Œæ‰€ä»¥æ‰€æœ‰ç»å¯¹è·¯å¾„éœ€è¦å›é€€ä¸€å±‚ç›®å½•æ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶  ../

```js{8,10,66,71}
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æŒ‡å®šè¾“å‡ºç›®å½•------------------------------------------------------
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    // clean: true, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æ¸…ç©ºè¾“å‡ºç»“æœ
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),------------------------------------------------------../
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),-----------------------------------------../
    }),
  ],
  // å…¶ä»–çœç•¥
  devServer: {
    host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
    port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
    open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },
  mode: "development",
};
```

è¿è¡Œå¼€å‘æ¨¡å¼çš„æŒ‡ä»¤ï¼š

```:no-line-numbers
npx webpack serve --config ./config/webpack.dev.js
```

### 3. ä¿®æ”¹ webpack.prod.js

#### æ‰€æœ‰ç»å¯¹è·¯å¾„éœ€è¦å›é€€ä¸€å±‚ç›®å½•æ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶  ../

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º-------------------------------------------../
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: ["style-loader", "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),------------------------------------------------------../
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),........................................../
    }),
  ],
  ç”Ÿäº§æ¨¡å¼ä¸‹ä¸éœ€è¦devServerï¼Œåªè¦æ±‚æ‰“åŒ…è¾“å‡ºå°±è¡Œ
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",//æ¨¡å¼è¦è½¬æ¢æˆç”Ÿäº§æ¨¡å¼--------------------------------------------------------------
};
```

è¿è¡Œç”Ÿäº§æ¨¡å¼çš„æŒ‡ä»¤ï¼š

```:no-line-numbers
npx webpack --config ./config/webpack.prod.js
```

### 4. é…ç½®è¿è¡ŒæŒ‡ä»¤

ä¸ºäº†æ–¹ä¾¿è¿è¡Œä¸åŒæ¨¡å¼çš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬å°†æŒ‡ä»¤å®šä¹‰åœ¨ package.json ä¸­ scripts é‡Œé¢

```json
// package.json
{
  // å…¶ä»–çœç•¥
  "scripts": {
    "start": "npm run dev",
    "dev": "npx webpack serve --config ./config/webpack.dev.js",
    "build": "npx webpack --config ./config/webpack.prod.js"
  }
}
```

ä»¥åå¯åŠ¨æŒ‡ä»¤ï¼š

- å¼€å‘æ¨¡å¼ï¼š`npm start` æˆ– `npm run dev`
- ç”Ÿäº§æ¨¡å¼ï¼š`npm run build`

# Css å¤„ç†

## æå– Css æˆå•ç‹¬æ–‡ä»¶

Css æ–‡ä»¶ç›®å‰è¢«æ‰“åŒ…åˆ° js æ–‡ä»¶ä¸­ï¼Œå½“ js æ–‡ä»¶åŠ è½½æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª style æ ‡ç­¾æ¥ç”Ÿæˆæ ·å¼

è¿™æ ·å¯¹äºç½‘ç«™æ¥è¯´ï¼Œä¼šå‡ºç°é—ªå±ç°è±¡ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½

æˆ‘ä»¬åº”è¯¥æ˜¯å•ç‹¬çš„ Css æ–‡ä»¶ï¼Œé€šè¿‡ link æ ‡ç­¾åŠ è½½æ€§èƒ½æ‰å¥½

### 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i mini-css-extract-plugin -D
```

### 2. é…ç½®

- webpack.prod.js

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin"); ã€//å¼•å…¥MiniCssExtractPlugin---------------

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
     test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
     use: [MiniCssExtractPlugin.loader, "css-loader"],//å°†'style-loader'å…¨éƒ¨æ›¿æ¢ä¸º MiniCssExtractPlugin.loader
      },
      {
        test: /\.less$/,
        use: [MiniCssExtractPlugin.loader, "css-loader", "less-loader"],
      },
      {
        test: /\.s[ac]ss$/,
        use: [MiniCssExtractPlugin.loader, "css-loader", "sass-loader"],
      },
      {
        test: /\.styl$/,
        use: [MiniCssExtractPlugin.loader, "css-loader", "stylus-loader"],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({   //æ’ä»¶é‡æ–°è°ƒç”¨------------------------------------------------------------
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
  ],
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
};
```

### 3. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npm run build
```

## Css å…¼å®¹æ€§å¤„ç†

### 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i postcss-loader postcss postcss-preset-env -D
```

### 2. é…ç½®

- webpack.prod.js

```js{22-31,39-48,57-66,75-84}
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: [
          MiniCssExtractPlugin.loader,
          "css-loader",
          {
            loader: "postcss-loader",
            options: {
              postcssOptions: {
                plugins: [
                  "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
                ],
              },
            },
          },
        ],
      },
      {
        test: /\.less$/,
        use: [
          MiniCssExtractPlugin.loader,
          "css-loader",
          {
            loader: "postcss-loader",
            options: {
              postcssOptions: {
                plugins: [
                  "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
                ],
              },
            },
          },
          "less-loader",
        ],
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          MiniCssExtractPlugin.loader,
          "css-loader",
          {
            loader: "postcss-loader",
            options: {
              postcssOptions: {
                plugins: [
                  "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
                ],
              },
            },
          },
          "sass-loader",
        ],
      },
      {
        test: /\.styl$/,
        use: [
          MiniCssExtractPlugin.loader,
          "css-loader",
          {
            loader: "postcss-loader",
            options: {
              postcssOptions: {
                plugins: [
                  "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
                ],
              },
            },
          },
          "stylus-loader",
        ],
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
  ],
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
};
```

### 3. æ§åˆ¶å…¼å®¹æ€§

æˆ‘ä»¬å¯ä»¥åœ¨ `package.json` æ–‡ä»¶ä¸­æ·»åŠ  `browserslist` æ¥æ§åˆ¶æ ·å¼çš„å…¼å®¹æ€§åšåˆ°ä»€ä¹ˆç¨‹åº¦ã€‚

```json
{
  // å…¶ä»–çœç•¥
  "browserslist": ["ie >= 8"]
}
```

æƒ³è¦çŸ¥é“æ›´å¤šçš„ `browserslist` é…ç½®ï¼ŒæŸ¥çœ‹[browserslist æ–‡æ¡£](https://github.com/browserslist/browserslist)

ä»¥ä¸Šä¸ºäº†æµ‹è¯•å…¼å®¹æ€§æ‰€ä»¥è®¾ç½®å…¼å®¹æµè§ˆå™¨ ie8 ä»¥ä¸Šã€‚

å®é™…å¼€å‘ä¸­æˆ‘ä»¬ä¸€èˆ¬ä¸è€ƒè™‘æ—§ç‰ˆæœ¬æµè§ˆå™¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾ç½®ï¼š

```json
{
  // å…¶ä»–çœç•¥
  "browserslist": ["last 2 version", "> 1%", "not dead"]
}
```

### 4. åˆå¹¶é…ç½®

- webpack.prod.js

```js{6-23,38,42,46,50}
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
  ],
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
};
```

### 5. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npm run build
```

## Css å‹ç¼©

### 1. ä¸‹è½½åŒ…

```:no-line-numbers
npm i css-minimizer-webpack-plugin -D
```

### 2. é…ç½®

- webpack.prod.js

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");//å¼•å…¥è¯¥æ’ä»¶------------------------------

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      {
        test: /\.(png|jpe?g|gif|webp)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
        generator: {
          // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
          // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
          // [hash:8]: hashå€¼å–8ä½
          // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
          // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
          filename: "static/imgs/[hash:8][ext][query]",
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "static/media/[hash:8][ext][query]",
        },
      },
      {
        test: /\.js$/,
        exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
        loader: "babel-loader",
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
    // csså‹ç¼©
    new CssMinimizerPlugin(),//newè°ƒç”¨è¯¥æ’ä»¶-------------------------------------------------------
  ],
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
};
```

### 3. è¿è¡ŒæŒ‡ä»¤

```:no-line-numbers
npm run build
```

# html å‹ç¼©

é»˜è®¤ç”Ÿäº§æ¨¡å¼å·²ç»å¼€å¯äº†ï¼šhtml å‹ç¼©å’Œ js å‹ç¼©

ä¸éœ€è¦é¢å¤–è¿›è¡Œé…ç½®

# æ€»ç»“

æœ¬ç« èŠ‚æˆ‘ä»¬å­¦ä¼šäº† Webpack åŸºæœ¬ä½¿ç”¨ï¼ŒæŒæ¡äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

1. ä¸¤ç§å¼€å‘æ¨¡å¼

- å¼€å‘æ¨¡å¼ï¼šä»£ç èƒ½ç¼–è¯‘è‡ªåŠ¨åŒ–è¿è¡Œ
- ç”Ÿäº§æ¨¡å¼ï¼šä»£ç ç¼–è¯‘ä¼˜åŒ–è¾“å‡ºï¼ˆå…¼å®¹æ€§å¤„ç†ï¼Œå‹ç¼©ä»£ç ï¼‰

2. Webpack åŸºæœ¬åŠŸèƒ½

- å¼€å‘æ¨¡å¼ï¼šå¯ä»¥ç¼–è¯‘ ES Module è¯­æ³•
- ç”Ÿäº§æ¨¡å¼ï¼šå¯ä»¥ç¼–è¯‘ ES Module è¯­æ³•ï¼Œå‹ç¼© js ä»£ç 

3. Webpack é…ç½®æ–‡ä»¶

- 5 ä¸ªæ ¸å¿ƒæ¦‚å¿µ
  - entry
  - output
  - loader
  - plugins
  - mode
- devServer é…ç½®:å¼€å‘æœåŠ¡å™¨è‡ªåŠ¨åŒ–è¿è¡Œ

4. Webpack è„šæœ¬æŒ‡ä»¤ç”¨æ³•

- `webpack` ç›´æ¥æ‰“åŒ…è¾“å‡º
- `webpack serve` å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œå†…å­˜ç¼–è¯‘æ‰“åŒ…æ²¡æœ‰è¾“å‡º

# ä»‹ç»ï¼š Webpack é«˜çº§é…ç½®ã€‚

æœ¬ç« èŠ‚ä¸»è¦ä»‹ç» Webpack é«˜çº§é…ç½®ã€‚

æ‰€è°“é«˜çº§é…ç½®å…¶å®å°±æ˜¯è¿›è¡Œ Webpack ä¼˜åŒ–ï¼Œè®©æˆ‘ä»¬ä»£ç åœ¨ç¼–è¯‘/è¿è¡Œæ—¶æ€§èƒ½æ›´å¥½~

æˆ‘ä»¬ä¼šä»ä»¥ä¸‹è§’åº¦æ¥è¿›è¡Œä¼˜åŒ–ï¼š

1. æå‡å¼€å‘ä½“éªŒ
2. æå‡æ‰“åŒ…æ„å»ºé€Ÿåº¦
3. å‡å°‘ä»£ç ä½“ç§¯
4. ä¼˜åŒ–ä»£ç è¿è¡Œæ€§èƒ½

# æå‡å¼€å‘ä½“éªŒ

## SourceMap

### ä¸ºä»€ä¹ˆ

å¼€å‘æ—¶æˆ‘ä»¬è¿è¡Œçš„ä»£ç æ˜¯ç»è¿‡ webpack ç¼–è¯‘åçš„ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š

```js
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/css-loader/dist/cjs.js!./node_modules/less-loader/dist/cjs.js!./src/less/index.less":
/*!**********************************************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./node_modules/less-loader/dist/cjs.js!./src/less/index.less ***!
  \**********************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/noSourceMaps.js */ \"./node_modules/css-loader/dist/runtime/noSourceMaps.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ \"./node_modules/css-loader/dist/runtime/api.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".box2 {\\n  width: 100px;\\n  height: 100px;\\n  background-color: deeppink;\\n}\\n\", \"\"]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n//# sourceURL=webpack://webpack5/./src/less/index.less?./node_modules/css-loader/dist/cjs.js!./node_modules/less-loader/dist/cjs.js");

/***/ }),
// å…¶ä»–çœç•¥
```

æ‰€æœ‰ css å’Œ js åˆå¹¶æˆäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å¤šäº†å…¶ä»–ä»£ç ã€‚æ­¤æ—¶å¦‚æœä»£ç è¿è¡Œå‡ºé”™é‚£ä¹ˆæç¤ºä»£ç é”™è¯¯ä½ç½®æˆ‘ä»¬æ˜¯çœ‹ä¸æ‡‚çš„ã€‚ä¸€æ—¦å°†æ¥å¼€å‘ä»£ç æ–‡ä»¶å¾ˆå¤šï¼Œé‚£ä¹ˆå¾ˆéš¾å»å‘ç°é”™è¯¯å‡ºç°åœ¨å“ªé‡Œã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´åŠ å‡†ç¡®çš„é”™è¯¯æç¤ºï¼Œæ¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å¼€å‘ä»£ç ã€‚

### æ˜¯ä»€ä¹ˆ

SourceMapï¼ˆæºä»£ç æ˜ å°„ï¼‰æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆæºä»£ç ä¸æ„å»ºåä»£ç ä¸€ä¸€æ˜ å°„çš„æ–‡ä»¶çš„æ–¹æ¡ˆã€‚

å®ƒä¼šç”Ÿæˆä¸€ä¸ª xxx.map æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«æºä»£ç å’Œæ„å»ºåä»£ç æ¯ä¸€è¡Œã€æ¯ä¸€åˆ—çš„æ˜ å°„å…³ç³»ã€‚å½“æ„å»ºåä»£ç å‡ºé”™äº†ï¼Œä¼šé€šè¿‡ xxx.map æ–‡ä»¶ï¼Œä»æ„å»ºåä»£ç å‡ºé”™ä½ç½®æ‰¾åˆ°æ˜ å°„åæºä»£ç å‡ºé”™ä½ç½®ï¼Œä»è€Œè®©æµè§ˆå™¨æç¤ºæºä»£ç æ–‡ä»¶å‡ºé”™ä½ç½®ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¿«çš„æ‰¾åˆ°é”™è¯¯æ ¹æºã€‚

### æ€ä¹ˆç”¨

é€šè¿‡æŸ¥çœ‹[Webpack DevTool æ–‡æ¡£](https://webpack.docschina.org/configuration/devtool/)å¯çŸ¥ï¼ŒSourceMap çš„å€¼æœ‰å¾ˆå¤šç§æƒ…å†µ.

ä½†å®é™…å¼€å‘æ—¶æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸¤ç§æƒ…å†µå³å¯ï¼š

- å¼€å‘æ¨¡å¼ï¼š`cheap-module-source-map`

  - ä¼˜ç‚¹ï¼šæ‰“åŒ…ç¼–è¯‘é€Ÿåº¦å¿«ï¼ŒåªåŒ…å«è¡Œæ˜ å°„
  - ç¼ºç‚¹ï¼šæ²¡æœ‰åˆ—æ˜ å°„

```js
module.exports = {
  // å…¶ä»–çœç•¥
  mode: "development",
  devtool: "cheap-module-source-map",---------------------------------
};
```

- ç”Ÿäº§æ¨¡å¼ï¼š`source-map`
  - ä¼˜ç‚¹ï¼šåŒ…å«è¡Œ/åˆ—æ˜ å°„
  - ç¼ºç‚¹ï¼šæ‰“åŒ…ç¼–è¯‘é€Ÿåº¦æ›´æ…¢

```js
module.exports = {
  // å…¶ä»–çœç•¥
  mode: "production",
  devtool: "source-map",----------------------------------------------------
};
```

# æå‡æ‰“åŒ…æ„å»ºé€Ÿåº¦

## HotModuleReplacementï¼ˆHMR/çƒ­æ¨¡å—æ›¿æ¢ï¼‰

### ä¸ºä»€ä¹ˆ

å¼€å‘æ—¶æˆ‘ä»¬ä¿®æ”¹äº†å…¶ä¸­ä¸€ä¸ªæ¨¡å—ä»£ç ï¼ŒWebpack é»˜è®¤ä¼šå°†æ‰€æœ‰æ¨¡å—å…¨éƒ¨é‡æ–°æ‰“åŒ…ç¼–è¯‘ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšåˆ°ä¿®æ”¹æŸä¸ªæ¨¡å—ä»£ç ï¼Œå°±åªæœ‰è¿™ä¸ªæ¨¡å—ä»£ç éœ€è¦é‡æ–°æ‰“åŒ…ç¼–è¯‘ï¼Œå…¶ä»–æ¨¡å—ä¸å˜ï¼Œè¿™æ ·æ‰“åŒ…é€Ÿåº¦å°±èƒ½å¾ˆå¿«ã€‚

### æ˜¯ä»€ä¹ˆ

HotModuleReplacementï¼ˆHMR/çƒ­æ¨¡å—æ›¿æ¢ï¼‰ï¼šåœ¨ç¨‹åºè¿è¡Œä¸­ï¼Œæ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚

### æ€ä¹ˆç”¨

1. åŸºæœ¬é…ç½®

```js
module.exports = {
  // å…¶ä»–çœç•¥
  devServer: {
    host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
    port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
    open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    hot: true, // å¼€å¯HMRåŠŸèƒ½ï¼ˆåªèƒ½ç”¨äºå¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒä¸éœ€è¦äº†ï¼‰----------------------------------------------
  },
};
```

æ­¤æ—¶ css æ ·å¼ç»è¿‡ style-loader å¤„ç†ï¼Œå·²ç»å…·å¤‡ HMR åŠŸèƒ½äº†ã€‚
ä½†æ˜¯ js è¿˜ä¸è¡Œã€‚

2. JS é…ç½®

```js
// main.js
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

const result1 = count(2, 1);
console.log(result1);
const result2 = sum(1, 2, 3, 4);
console.log(result2);

// åˆ¤æ–­æ˜¯å¦æ”¯æŒHMRåŠŸèƒ½-------------------------------------------------
if (module.hot) {
  module.hot.accept("./js/count.js", function (count) {
    const result1 = count(2, 1);
    console.log(result1);
  });

  module.hot.accept("./js/sum.js", function (sum) {
    const result2 = sum(1, 2, 3, 4);
    console.log(result2);
  });
}
```

ä¸Šé¢è¿™æ ·å†™ä¼šå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å®é™…å¼€å‘æˆ‘ä»¬ä¼šä½¿ç”¨å…¶ä»– loader æ¥è§£å†³ã€‚

æ¯”å¦‚ï¼š[vue-loader](https://github.com/vuejs/vue-loader), [react-hot-loader](https://github.com/gaearon/react-hot-loader)ã€‚

## OneOf

### ä¸ºä»€ä¹ˆ

æ‰“åŒ…æ—¶æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šç»è¿‡æ‰€æœ‰ loader å¤„ç†ï¼Œè™½ç„¶å› ä¸º `test` æ­£åˆ™åŸå› å®é™…æ²¡æœ‰å¤„ç†ä¸Šï¼Œä½†æ˜¯éƒ½è¦è¿‡ä¸€éã€‚æ¯”è¾ƒæ…¢ã€‚

### æ˜¯ä»€ä¹ˆ

é¡¾åæ€ä¹‰å°±æ˜¯åªèƒ½åŒ¹é…ä¸Šä¸€ä¸ª loader, å‰©ä¸‹çš„å°±ä¸åŒ¹é…äº†ã€‚

### æ€ä¹ˆç”¨  OneOfï¼š[    ]

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æŒ‡å®šè¾“å‡ºç›®å½•
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    // clean: true, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æ¸…ç©ºè¾“å‡ºç»“æœ
  },
  module: {
    rules: [
      {
        oneOf: [-------------------------------------------------------------------------
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: ["style-loader", "css-loader"],
          },
          {
            test: /\.less$/,
            use: ["style-loader", "css-loader", "less-loader"],
          },
          {
            test: /\.s[ac]ss$/,
            use: ["style-loader", "css-loader", "sass-loader"],
          },
          {
            test: /\.styl$/,
            use: ["style-loader", "css-loader", "stylus-loader"],
          },
          {
            test: /\.(png|jpe?g|gif|webp)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            generator: {
              // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
              // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
              // [hash:8]: hashå€¼å–8ä½
              // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
              // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
              filename: "static/imgs/[hash:8][ext][query]",
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            generator: {
              filename: "static/media/[hash:8][ext][query]",
            },
          },
          {
            test: /\.js$/,
            exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            loader: "babel-loader",
          },
        ],
      },
    ],---------------------------------------------------------------------------------------------------
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
  ],
  // å¼€å‘æœåŠ¡å™¨
  devServer: {
    host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
    port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
    open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    hot: true, // å¼€å¯HMRåŠŸèƒ½
  },
  mode: "development",
  devtool: "cheap-module-source-map",
};
```

##### ç”Ÿäº§æ¨¡å¼ä¹Ÿæ˜¯å¦‚æ­¤é…ç½®ã€‚è·Ÿå¼€å‘æ¨¡å¼ä¸€æ ·.

## Include/Exclude

### ä¸ºä»€ä¹ˆ

å¼€å‘æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åº“æˆ–æ’ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä¸‹è½½åˆ° node_modules ä¸­äº†ã€‚è€Œè¿™äº›æ–‡ä»¶æ˜¯ä¸éœ€è¦ç¼–è¯‘å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬åœ¨å¯¹ js æ–‡ä»¶å¤„ç†æ—¶ï¼Œè¦æ’é™¤ node_modules ä¸‹é¢çš„æ–‡ä»¶ã€‚

### æ˜¯ä»€ä¹ˆ

- include

åŒ…å«ï¼Œåªå¤„ç† xxx æ–‡ä»¶

- exclude

æ’é™¤ï¼Œé™¤äº† xxx æ–‡ä»¶ä»¥å¤–å…¶ä»–æ–‡ä»¶éƒ½å¤„ç†

### æ€ä¹ˆç”¨

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æŒ‡å®šè¾“å‡ºç›®å½•
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    // clean: true, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æ¸…ç©ºè¾“å‡ºç»“æœ
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: ["style-loader", "css-loader"],
          },
          {
            test: /\.less$/,
            use: ["style-loader", "css-loader", "less-loader"],
          },
          {
            test: /\.s[ac]ss$/,
            use: ["style-loader", "css-loader", "sass-loader"],
          },
          {
            test: /\.styl$/,
            use: ["style-loader", "css-loader", "stylus-loader"],
          },
          {
            test: /\.(png|jpe?g|gif|webp)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            generator: {
              // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
              // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
              // [hash:8]: hashå€¼å–8ä½
              // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
              // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
              filename: "static/imgs/[hash:8][ext][query]",
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            generator: {
              filename: "static/media/[hash:8][ext][query]",
            },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘--------------------------------
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«-------------------------------
            loader: "babel-loader",
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),------------------------------------------------------
      exclude: "node_modules", // é»˜è®¤å€¼----------------------------------------------------------------
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
  ],
  // å¼€å‘æœåŠ¡å™¨
  devServer: {
    host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
    port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
    open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    hot: true, // å¼€å¯HMRåŠŸèƒ½
  },
  mode: "development",
  devtool: "cheap-module-source-map",
};
```

ç”Ÿäº§æ¨¡å¼ä¹Ÿæ˜¯å¦‚æ­¤é…ç½®ã€‚

## Cache

### ä¸ºä»€ä¹ˆ

æ¯æ¬¡æ‰“åŒ…æ—¶ js æ–‡ä»¶éƒ½è¦ç»è¿‡ Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚

æˆ‘ä»¬å¯ä»¥ç¼“å­˜ä¹‹å‰çš„ Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ç»“æœï¼Œè¿™æ ·ç¬¬äºŒæ¬¡æ‰“åŒ…æ—¶é€Ÿåº¦å°±ä¼šæ›´å¿«äº†ã€‚

### æ˜¯ä»€ä¹ˆ

å¯¹ Eslint æ£€æŸ¥ å’Œ Babel ç¼–è¯‘ç»“æœè¿›è¡Œç¼“å­˜ã€‚

### æ€ä¹ˆç”¨

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æŒ‡å®šè¾“å‡ºç›®å½•
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    // clean: true, // å¼€å‘æ¨¡å¼æ²¡æœ‰è¾“å‡ºï¼Œä¸éœ€è¦æ¸…ç©ºè¾“å‡ºç»“æœ
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: ["style-loader", "css-loader"],
          },
          {
            test: /\.less$/,
            use: ["style-loader", "css-loader", "less-loader"],
          },
          {
            test: /\.s[ac]ss$/,
            use: ["style-loader", "css-loader", "sass-loader"],
          },
          {
            test: /\.styl$/,
            use: ["style-loader", "css-loader", "stylus-loader"],
          },
          {
            test: /\.(png|jpe?g|gif|webp)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            generator: {
              // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
              // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
              // [hash:8]: hashå€¼å–8ä½
              // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
              // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
              filename: "static/imgs/[hash:8][ext][query]",
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            generator: {
              filename: "static/media/[hash:8][ext][query]",
            },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            loader: "babel-loader",
            options: {
              cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜-----------------------------------------------
              cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©---------------------------------------------
            },
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜---------------------------------------------------------------------------
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve( __dirname,"../node_modules/.cache/.eslintcache"),--------------------
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
  ],
  // å¼€å‘æœåŠ¡å™¨
  devServer: {
    host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
    port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
    open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    hot: true, // å¼€å¯HMRåŠŸèƒ½
  },
  mode: "development",
  devtool: "cheap-module-source-map",
};
```

## Thead

### ä¸ºä»€ä¹ˆ

å½“é¡¹ç›®è¶Šæ¥è¶Šåºå¤§æ—¶ï¼Œæ‰“åŒ…é€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼Œç”šè‡³äºéœ€è¦ä¸€ä¸ªä¸‹åˆæ‰èƒ½æ‰“åŒ…å‡ºæ¥ä»£ç ã€‚è¿™ä¸ªé€Ÿåº¦æ˜¯æ¯”è¾ƒæ…¢çš„ã€‚

æˆ‘ä»¬æƒ³è¦ç»§ç»­æå‡æ‰“åŒ…é€Ÿåº¦ï¼Œå…¶å®å°±æ˜¯è¦æå‡ js çš„æ‰“åŒ…é€Ÿåº¦ï¼Œå› ä¸ºå…¶ä»–æ–‡ä»¶éƒ½æ¯”è¾ƒå°‘ã€‚

è€Œå¯¹ js æ–‡ä»¶å¤„ç†ä¸»è¦å°±æ˜¯ eslint ã€babelã€Terser ä¸‰ä¸ªå·¥å…·ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æå‡å®ƒä»¬çš„è¿è¡Œé€Ÿåº¦ã€‚

æˆ‘ä»¬å¯ä»¥å¼€å¯å¤šè¿›ç¨‹åŒæ—¶å¤„ç† js æ–‡ä»¶ï¼Œè¿™æ ·é€Ÿåº¦å°±æ¯”ä¹‹å‰çš„å•è¿›ç¨‹æ‰“åŒ…æ›´å¿«äº†ã€‚

### æ˜¯ä»€ä¹ˆ

å¤šè¿›ç¨‹æ‰“åŒ…ï¼šå¼€å¯ç”µè„‘çš„å¤šä¸ªè¿›ç¨‹åŒæ—¶å¹²ä¸€ä»¶äº‹ï¼Œé€Ÿåº¦æ›´å¿«ã€‚

**éœ€è¦æ³¨æ„ï¼šè¯·ä»…åœ¨ç‰¹åˆ«è€—æ—¶çš„æ“ä½œä¸­ä½¿ç”¨ï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹å¯åŠ¨å°±æœ‰å¤§çº¦ä¸º 600ms å·¦å³å¼€é”€ã€‚**

### æ€ä¹ˆç”¨

æˆ‘ä»¬å¯åŠ¨è¿›ç¨‹çš„æ•°é‡å°±æ˜¯æˆ‘ä»¬ CPU çš„æ ¸æ•°ã€‚

1. å¦‚ä½•è·å– CPU çš„æ ¸æ•°ï¼Œå› ä¸ºæ¯ä¸ªç”µè„‘éƒ½ä¸ä¸€æ ·ã€‚

```js
// nodejsæ ¸å¿ƒæ¨¡å—ï¼Œç›´æ¥ä½¿ç”¨
const os = require("os");
// cpuæ ¸æ•°
const threads = os.cpus().length;
```

2. ä¸‹è½½åŒ…

```
npm i thread-loader -D
```

3. ä½¿ç”¨

```js
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|webp)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            generator: {
              // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
              // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
              // [hash:8]: hashå€¼å–8ä½
              // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
              // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
              filename: "static/imgs/[hash:8][ext][query]",
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            generator: {
              filename: "static/media/[hash:8][ext][query]",
            },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
  ],
  optimization: {
    minimize: true,
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads // å¼€å¯å¤šè¿›ç¨‹
      })
    ],
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

æˆ‘ä»¬ç›®å‰æ‰“åŒ…çš„å†…å®¹éƒ½å¾ˆå°‘ï¼Œæ‰€ä»¥å› ä¸ºå¯åŠ¨è¿›ç¨‹å¼€é”€åŸå› ï¼Œä½¿ç”¨å¤šè¿›ç¨‹æ‰“åŒ…å®é™…ä¸Šä¼šæ˜¾è‘—çš„è®©æˆ‘ä»¬æ‰“åŒ…æ—¶é—´å˜å¾—å¾ˆé•¿ã€‚

# å‡å°‘ä»£ç ä½“ç§¯

## Tree Shaking

### ä¸ºä»€ä¹ˆ

å¼€å‘æ—¶æˆ‘ä»¬å®šä¹‰äº†ä¸€äº›å·¥å…·å‡½æ•°åº“ï¼Œæˆ–è€…å¼•ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å‡½æ•°åº“æˆ–ç»„ä»¶åº“ã€‚

å¦‚æœæ²¡æœ‰ç‰¹æ®Šå¤„ç†çš„è¯æˆ‘ä»¬æ‰“åŒ…æ—¶ä¼šå¼•å…¥æ•´ä¸ªåº“ï¼Œä½†æ˜¯å®é™…ä¸Šå¯èƒ½æˆ‘ä»¬å¯èƒ½åªç”¨ä¸Šæå°éƒ¨åˆ†çš„åŠŸèƒ½ã€‚

è¿™æ ·å°†æ•´ä¸ªåº“éƒ½æ‰“åŒ…è¿›æ¥ï¼Œä½“ç§¯å°±å¤ªå¤§äº†ã€‚

### æ˜¯ä»€ä¹ˆ

`Tree Shaking` æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œé€šå¸¸ç”¨äºæè¿°ç§»é™¤ JavaScript ä¸­çš„æ²¡æœ‰ä½¿ç”¨ä¸Šçš„ä»£ç ã€‚

**æ³¨æ„ï¼šå®ƒä¾èµ– `ES Module`ã€‚**

### æ€ä¹ˆç”¨

Webpack å·²ç»é»˜è®¤å¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ— éœ€å…¶ä»–é…ç½®ã€‚

## Babel

### ä¸ºä»€ä¹ˆ

Babel ä¸ºç¼–è¯‘çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ’å…¥äº†è¾…åŠ©ä»£ç ï¼Œä½¿ä»£ç ä½“ç§¯è¿‡å¤§ï¼

Babel å¯¹ä¸€äº›å…¬å…±æ–¹æ³•ä½¿ç”¨äº†éå¸¸å°çš„è¾…åŠ©ä»£ç ï¼Œæ¯”å¦‚ `_extend`ã€‚é»˜è®¤æƒ…å†µä¸‹ä¼šè¢«æ·»åŠ åˆ°æ¯ä¸€ä¸ªéœ€è¦å®ƒçš„æ–‡ä»¶ä¸­ã€‚

ä½ å¯ä»¥å°†è¿™äº›è¾…åŠ©ä»£ç ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¥é¿å…é‡å¤å¼•å…¥ã€‚

### æ˜¯ä»€ä¹ˆ

`@babel/plugin-transform-runtime`: ç¦ç”¨äº† Babel è‡ªåŠ¨å¯¹æ¯ä¸ªæ–‡ä»¶çš„ runtime æ³¨å…¥ï¼Œè€Œæ˜¯å¼•å…¥ `@babel/plugin-transform-runtime` å¹¶ä¸”ä½¿æ‰€æœ‰è¾…åŠ©ä»£ç ä»è¿™é‡Œå¼•ç”¨ã€‚

### æ€ä¹ˆç”¨

1. ä¸‹è½½åŒ…

```
npm i @babel/plugin-transform-runtime -D
```

2. é…ç½®

```js{100}
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|webp)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            generator: {
              // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
              // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
              // [hash:8]: hashå€¼å–8ä½
              // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
              // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
              filename: "static/imgs/[hash:8][ext][query]",
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            generator: {
              filename: "static/media/[hash:8][ext][query]",
            },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
    ]
  ],
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

## Image Minimizer

### ä¸ºä»€ä¹ˆ

å¼€å‘å¦‚æœé¡¹ç›®ä¸­å¼•ç”¨äº†è¾ƒå¤šå›¾ç‰‡ï¼Œé‚£ä¹ˆå›¾ç‰‡ä½“ç§¯ä¼šæ¯”è¾ƒå¤§ï¼Œå°†æ¥è¯·æ±‚é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚

æˆ‘ä»¬å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘å›¾ç‰‡ä½“ç§¯ã€‚

**æ³¨æ„ï¼šå¦‚æœé¡¹ç›®ä¸­å›¾ç‰‡éƒ½æ˜¯åœ¨çº¿é“¾æ¥ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦äº†ã€‚æœ¬åœ°é¡¹ç›®é™æ€å›¾ç‰‡æ‰éœ€è¦è¿›è¡Œå‹ç¼©ã€‚**

### æ˜¯ä»€ä¹ˆ

`image-minimizer-webpack-plugin`: ç”¨æ¥å‹ç¼©å›¾ç‰‡çš„æ’ä»¶

### æ€ä¹ˆç”¨

1. ä¸‹è½½åŒ…

```
npm i image-minimizer-webpack-plugin imagemin -D
```

è¿˜æœ‰å‰©ä¸‹åŒ…éœ€è¦ä¸‹è½½ï¼Œæœ‰ä¸¤ç§æ¨¡å¼ï¼š

- æ— æŸå‹ç¼©

```
npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo -D
```

- æœ‰æŸå‹ç¼©

```
npm install imagemin-gifsicle imagemin-mozjpeg imagemin-pngquant imagemin-svgo -D
```

> [æœ‰æŸ/æ— æŸå‹ç¼©çš„åŒºåˆ«](https://baike.baidu.com/item/%E6%97%A0%E6%8D%9F%E3%80%81%E6%9C%89%E6%8D%9F%E5%8E%8B%E7%BC%A9)

2. é…ç½®

æˆ‘ä»¬ä»¥æ— æŸå‹ç¼©é…ç½®ä¸ºä¾‹ï¼š

```js{8,144-171}
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            generator: {
              // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
              // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
              // [hash:8]: hashå€¼å–8ä½
              // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
              // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
              filename: "static/imgs/[hash:8][ext][query]",
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            generator: {
              filename: "static/media/[hash:8][ext][query]",
            },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

3. æ‰“åŒ…æ—¶ä¼šå‡ºç°æŠ¥é”™ï¼š

```
Error: Error with 'src\images\1.jpeg': '"C:\Users\86176\Desktop\webpack\webpack_code\node_modules\jpegtran-bin\vendor\jpegtran.exe"'
Error with 'src\images\3.gif': spawn C:\Users\86176\Desktop\webpack\webpack_code\node_modules\optipng-bin\vendor\optipng.exe ENOENT
```

æˆ‘ä»¬éœ€è¦å®‰è£…ä¸¤ä¸ªæ–‡ä»¶åˆ° node_modules ä¸­æ‰èƒ½è§£å†³, æ–‡ä»¶å¯ä»¥ä»è¯¾ä»¶ä¸­æ‰¾åˆ°ï¼š

- jpegtran.exe

éœ€è¦å¤åˆ¶åˆ° `node_modules\jpegtran-bin\vendor` ä¸‹é¢

> [jpegtran å®˜ç½‘åœ°å€](http://jpegclub.org/jpegtran/)

- optipng.exe

éœ€è¦å¤åˆ¶åˆ° `node_modules\optipng-bin\vendor` ä¸‹é¢

> [OptiPNG å®˜ç½‘åœ°å€](http://optipng.sourceforge.net/)

# ä¼˜åŒ–ä»£ç è¿è¡Œæ€§èƒ½

## Code Split

### ä¸ºä»€ä¹ˆ

æ‰“åŒ…ä»£ç æ—¶ä¼šå°†æ‰€æœ‰ js æ–‡ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½“ç§¯å¤ªå¤§äº†ã€‚æˆ‘ä»¬å¦‚æœåªè¦æ¸²æŸ“é¦–é¡µï¼Œå°±åº”è¯¥åªåŠ è½½é¦–é¡µçš„ js æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶ä¸åº”è¯¥åŠ è½½ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œä»£ç åˆ†å‰²ï¼Œç”Ÿæˆå¤šä¸ª js æ–‡ä»¶ï¼Œæ¸²æŸ“å“ªä¸ªé¡µé¢å°±åªåŠ è½½æŸä¸ª js æ–‡ä»¶ï¼Œè¿™æ ·åŠ è½½çš„èµ„æºå°±å°‘ï¼Œé€Ÿåº¦å°±æ›´å¿«ã€‚

### æ˜¯ä»€ä¹ˆ

ä»£ç åˆ†å‰²ï¼ˆCode Splitï¼‰ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š

1.  åˆ†å‰²æ–‡ä»¶ï¼šå°†æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œåˆ†å‰²ï¼Œç”Ÿæˆå¤šä¸ª js æ–‡ä»¶ã€‚
2.  æŒ‰éœ€åŠ è½½ï¼šéœ€è¦å“ªä¸ªæ–‡ä»¶å°±åŠ è½½å“ªä¸ªæ–‡ä»¶ã€‚

### æ€ä¹ˆç”¨

ä»£ç åˆ†å‰²å®ç°æ–¹å¼æœ‰ä¸åŒçš„æ–¹å¼ï¼Œä¸ºäº†æ›´åŠ æ–¹ä¾¿ä½“ç°å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ï¼Œæˆ‘ä»¬ä¼šåˆ†åˆ«åˆ›å»ºæ–°çš„æ–‡ä»¶æ¥æ¼”ç¤º

##### 1. å¤šå…¥å£

1. æ–‡ä»¶ç›®å½•

```
â”œâ”€â”€ public
â”œâ”€â”€ src
|   â”œâ”€â”€ app.js
|   â””â”€â”€ main.js
â”œâ”€â”€ package.json
â””â”€â”€ webpack.config.js
```

2. ä¸‹è½½åŒ…

```
npm i webpack webpack-cli html-webpack-plugin -D
```

3. æ–°å»ºæ–‡ä»¶

å†…å®¹æ— å…³ç´§è¦ï¼Œä¸»è¦è§‚å¯Ÿæ‰“åŒ…è¾“å‡ºçš„ç»“æœ

- app.js

```js
console.log("hello app");
```

- main.js

```js
console.log("hello main");
```

4. é…ç½®

```js
// webpack.config.js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  // å•å…¥å£
  // entry: './src/main.js',
  // å¤šå…¥å£
  entry: {
    main: "./src/main.js",
    app: "./src/app.js",
  },
  output: {
    path: path.resolve(__dirname, "./dist"),
    // [name]æ˜¯webpackå‘½åè§„åˆ™ï¼Œä½¿ç”¨chunkçš„nameä½œä¸ºè¾“å‡ºçš„æ–‡ä»¶åã€‚
    // ä»€ä¹ˆæ˜¯chunkï¼Ÿæ‰“åŒ…çš„èµ„æºå°±æ˜¯chunkï¼Œè¾“å‡ºå‡ºå»å«bundleã€‚
    // chunkçš„nameæ˜¯å•¥å‘¢ï¼Ÿ æ¯”å¦‚ï¼š entryä¸­xxx: "./src/xxx.js", nameå°±æ˜¯xxxã€‚æ³¨æ„æ˜¯å‰é¢çš„xxxï¼Œå’Œæ–‡ä»¶åæ— å…³ã€‚
    // ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å‘½åå‘¢ï¼Ÿå¦‚æœè¿˜æ˜¯ä¹‹å‰å†™æ³•main.jsï¼Œé‚£ä¹ˆæ‰“åŒ…ç”Ÿæˆä¸¤ä¸ªjsæ–‡ä»¶éƒ½ä¼šå«åšmain.jsä¼šå‘ç”Ÿè¦†ç›–ã€‚(å®é™…ä¸Šä¼šç›´æ¥æŠ¥é”™çš„)
    filename: "js/[name].js",
    clear: true,
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./public/index.html",
    }),
  ],
  mode: "production",
};
```

5. è¿è¡ŒæŒ‡ä»¤

```
npx webpack
```

æ­¤æ—¶åœ¨ dist ç›®å½•æˆ‘ä»¬èƒ½çœ‹åˆ°è¾“å‡ºäº†ä¸¤ä¸ª js æ–‡ä»¶ã€‚

æ€»ç»“ï¼šé…ç½®äº†å‡ ä¸ªå…¥å£ï¼Œè‡³å°‘è¾“å‡ºå‡ ä¸ª js æ–‡ä»¶ã€‚

##### 2. æå–é‡å¤ä»£ç 

å¦‚æœå¤šå…¥å£æ–‡ä»¶ä¸­éƒ½å¼•ç”¨äº†åŒä¸€ä»½ä»£ç ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¿™ä»½ä»£ç è¢«æ‰“åŒ…åˆ°ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œå¯¼è‡´ä»£ç é‡å¤ï¼Œä½“ç§¯æ›´å¤§ã€‚

æˆ‘ä»¬éœ€è¦æå–å¤šå…¥å£çš„é‡å¤ä»£ç ï¼Œåªæ‰“åŒ…ç”Ÿæˆä¸€ä¸ª js æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶å¼•ç”¨å®ƒå°±å¥½ã€‚

1. ä¿®æ”¹æ–‡ä»¶

- app.js

```js
import { sum } from "./math";

console.log("hello app");
console.log(sum(1, 2, 3, 4));
```

- main.js

```js
import { sum } from "./math";

console.log("hello main");
console.log(sum(1, 2, 3, 4, 5));
```

- math.js

```js
export const sum = (...args) => {
  return args.reduce((p, c) => p + c, 0);
};
```

2. ä¿®æ”¹é…ç½®æ–‡ä»¶

```js{28-67}
// webpack.config.js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  // å•å…¥å£
  // entry: './src/main.js',
  // å¤šå…¥å£
  entry: {
    main: "./src/main.js",
    app: "./src/app.js",
  },
  output: {
    path: path.resolve(__dirname, "./dist"),
    // [name]æ˜¯webpackå‘½åè§„åˆ™ï¼Œä½¿ç”¨chunkçš„nameä½œä¸ºè¾“å‡ºçš„æ–‡ä»¶åã€‚
    // ä»€ä¹ˆæ˜¯chunkï¼Ÿæ‰“åŒ…çš„èµ„æºå°±æ˜¯chunkï¼Œè¾“å‡ºå‡ºå»å«bundleã€‚
    // chunkçš„nameæ˜¯å•¥å‘¢ï¼Ÿ æ¯”å¦‚ï¼š entryä¸­xxx: "./src/xxx.js", nameå°±æ˜¯xxxã€‚æ³¨æ„æ˜¯å‰é¢çš„xxxï¼Œå’Œæ–‡ä»¶åæ— å…³ã€‚
    // ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å‘½åå‘¢ï¼Ÿå¦‚æœè¿˜æ˜¯ä¹‹å‰å†™æ³•main.jsï¼Œé‚£ä¹ˆæ‰“åŒ…ç”Ÿæˆä¸¤ä¸ªjsæ–‡ä»¶éƒ½ä¼šå«åšmain.jsä¼šå‘ç”Ÿè¦†ç›–ã€‚(å®é™…ä¸Šä¼šç›´æ¥æŠ¥é”™çš„)
    filename: "js/[name].js",
    clean: true,
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./public/index.html",
    }),
  ],
  mode: "production",
  optimization: {
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // ä»¥ä¸‹æ˜¯é»˜è®¤å€¼
      // minSize: 20000, // åˆ†å‰²ä»£ç æœ€å°çš„å¤§å°
      // minRemainingSize: 0, // ç±»ä¼¼äºminSizeï¼Œæœ€åç¡®ä¿æå–çš„æ–‡ä»¶å¤§å°ä¸èƒ½ä¸º0
      // minChunks: 1, // è‡³å°‘è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œæ»¡è¶³æ¡ä»¶æ‰ä¼šä»£ç åˆ†å‰²
      // maxAsyncRequests: 30, // æŒ‰éœ€åŠ è½½æ—¶å¹¶è¡ŒåŠ è½½çš„æ–‡ä»¶çš„æœ€å¤§æ•°é‡
      // maxInitialRequests: 30, // å…¥å£jsæ–‡ä»¶æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°é‡
      // enforceSizeThreshold: 50000, // è¶…è¿‡50kbä¸€å®šä¼šå•ç‹¬æ‰“åŒ…ï¼ˆæ­¤æ—¶ä¼šå¿½ç•¥minRemainingSizeã€maxAsyncRequestsã€maxInitialRequestsï¼‰
      // cacheGroups: { // ç»„ï¼Œå“ªäº›æ¨¡å—è¦æ‰“åŒ…åˆ°ä¸€ä¸ªç»„
      //   defaultVendors: { // ç»„å
      //     test: /[\\/]node_modules[\\/]/, // éœ€è¦æ‰“åŒ…åˆ°ä¸€èµ·çš„æ¨¡å—
      //     priority: -10, // æƒé‡ï¼ˆè¶Šå¤§è¶Šé«˜ï¼‰
      //     reuseExistingChunk: true, // å¦‚æœå½“å‰ chunk åŒ…å«å·²ä»ä¸» bundle ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å®ƒå°†è¢«é‡ç”¨ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—
      //   },
      //   default: { // å…¶ä»–æ²¡æœ‰å†™çš„é…ç½®ä¼šä½¿ç”¨ä¸Šé¢çš„é»˜è®¤å€¼
      //     minChunks: 2, // è¿™é‡Œçš„minChunksæƒé‡æ›´å¤§
      //     priority: -20,
      //     reuseExistingChunk: true,
      //   },
      // },
      // ä¿®æ”¹é…ç½®
      cacheGroups: {
        // ç»„ï¼Œå“ªäº›æ¨¡å—è¦æ‰“åŒ…åˆ°ä¸€ä¸ªç»„
        // defaultVendors: { // ç»„å
        //   test: /[\\/]node_modules[\\/]/, // éœ€è¦æ‰“åŒ…åˆ°ä¸€èµ·çš„æ¨¡å—
        //   priority: -10, // æƒé‡ï¼ˆè¶Šå¤§è¶Šé«˜ï¼‰
        //   reuseExistingChunk: true, // å¦‚æœå½“å‰ chunk åŒ…å«å·²ä»ä¸» bundle ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å®ƒå°†è¢«é‡ç”¨ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—
        // },
        default: {
          // å…¶ä»–æ²¡æœ‰å†™çš„é…ç½®ä¼šä½¿ç”¨ä¸Šé¢çš„é»˜è®¤å€¼
          minSize: 0, // æˆ‘ä»¬å®šä¹‰çš„æ–‡ä»¶ä½“ç§¯å¤ªå°äº†ï¼Œæ‰€ä»¥è¦æ”¹æ‰“åŒ…çš„æœ€å°æ–‡ä»¶ä½“ç§¯
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true,
        },
      },
    },
  },
};
```

3. è¿è¡ŒæŒ‡ä»¤

```
npx webpack
```

æ­¤æ—¶æˆ‘ä»¬ä¼šå‘ç°ç”Ÿæˆ 3 ä¸ª js æ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå°±æ˜¯æå–çš„å…¬å…±æ¨¡å—ã€‚

##### 3. æŒ‰éœ€åŠ è½½ï¼ŒåŠ¨æ€å¯¼å…¥

æƒ³è¦å®ç°æŒ‰éœ€åŠ è½½ï¼ŒåŠ¨æ€å¯¼å…¥æ¨¡å—ã€‚è¿˜éœ€è¦é¢å¤–é…ç½®ï¼š

1. ä¿®æ”¹æ–‡ä»¶

- main.js

```js
console.log("hello main");

document.getElementById("btn").onclick = function () {
  // åŠ¨æ€å¯¼å…¥ --> å®ç°æŒ‰éœ€åŠ è½½
  // å³ä½¿åªè¢«å¼•ç”¨äº†ä¸€æ¬¡ï¼Œä¹Ÿä¼šä»£ç åˆ†å‰²
  import("./math.js").then(({ sum }) => {
    alert(sum(1, 2, 3, 4, 5));
  });
};
```

- app.js

```js
console.log("hello app");
```

- public/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code Split</title>
  </head>
  <body>
    <h1>hello webpack</h1>
    <button id="btn">è®¡ç®—</button>
  </body>
</html>
```

2. è¿è¡ŒæŒ‡ä»¤

```
npx webpack
```

æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¸€æ—¦é€šè¿‡ import åŠ¨æ€å¯¼å…¥è¯­æ³•å¯¼å…¥æ¨¡å—ï¼Œæ¨¡å—å°±è¢«ä»£ç åˆ†å‰²ï¼ŒåŒæ—¶ä¹Ÿèƒ½æŒ‰éœ€åŠ è½½äº†ã€‚

##### 4. å•å…¥å£

å¼€å‘æ—¶æˆ‘ä»¬å¯èƒ½æ˜¯å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰ï¼Œåªæœ‰ä¸€ä¸ªå…¥å£ï¼ˆå•å…¥å£ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦è¿™æ ·é…ç½®ï¼š

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  // å•å…¥å£
  entry: "./src/main.js",
  // å¤šå…¥å£
  // entry: {
  //   main: "./src/main.js",
  //   app: "./src/app.js",
  // },
  output: {
    path: path.resolve(__dirname, "./dist"),
    // [name]æ˜¯webpackå‘½åè§„åˆ™ï¼Œä½¿ç”¨chunkçš„nameä½œä¸ºè¾“å‡ºçš„æ–‡ä»¶åã€‚
    // ä»€ä¹ˆæ˜¯chunkï¼Ÿæ‰“åŒ…çš„èµ„æºå°±æ˜¯chunkï¼Œè¾“å‡ºå‡ºå»å«bundleã€‚
    // chunkçš„nameæ˜¯å•¥å‘¢ï¼Ÿ æ¯”å¦‚ï¼š entryä¸­xxx: "./src/xxx.js", nameå°±æ˜¯xxxã€‚æ³¨æ„æ˜¯å‰é¢çš„xxxï¼Œå’Œæ–‡ä»¶åæ— å…³ã€‚
    // ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å‘½åå‘¢ï¼Ÿå¦‚æœè¿˜æ˜¯ä¹‹å‰å†™æ³•main.jsï¼Œé‚£ä¹ˆæ‰“åŒ…ç”Ÿæˆä¸¤ä¸ªjsæ–‡ä»¶éƒ½ä¼šå«åšmain.jsä¼šå‘ç”Ÿè¦†ç›–ã€‚(å®é™…ä¸Šä¼šç›´æ¥æŠ¥é”™çš„)
    filename: "js/[name].js",
    clean: true,
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./public/index.html",
    }),
  ],
  mode: "production",
  optimization: {
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // ä»¥ä¸‹æ˜¯é»˜è®¤å€¼
      // minSize: 20000, // åˆ†å‰²ä»£ç æœ€å°çš„å¤§å°
      // minRemainingSize: 0, // ç±»ä¼¼äºminSizeï¼Œæœ€åç¡®ä¿æå–çš„æ–‡ä»¶å¤§å°ä¸èƒ½ä¸º0
      // minChunks: 1, // è‡³å°‘è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œæ»¡è¶³æ¡ä»¶æ‰ä¼šä»£ç åˆ†å‰²
      // maxAsyncRequests: 30, // æŒ‰éœ€åŠ è½½æ—¶å¹¶è¡ŒåŠ è½½çš„æ–‡ä»¶çš„æœ€å¤§æ•°é‡
      // maxInitialRequests: 30, // å…¥å£jsæ–‡ä»¶æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°é‡
      // enforceSizeThreshold: 50000, // è¶…è¿‡50kbä¸€å®šä¼šå•ç‹¬æ‰“åŒ…ï¼ˆæ­¤æ—¶ä¼šå¿½ç•¥minRemainingSizeã€maxAsyncRequestsã€maxInitialRequestsï¼‰
      // cacheGroups: { // ç»„ï¼Œå“ªäº›æ¨¡å—è¦æ‰“åŒ…åˆ°ä¸€ä¸ªç»„
      //   defaultVendors: { // ç»„å
      //     test: /[\\/]node_modules[\\/]/, // éœ€è¦æ‰“åŒ…åˆ°ä¸€èµ·çš„æ¨¡å—
      //     priority: -10, // æƒé‡ï¼ˆè¶Šå¤§è¶Šé«˜ï¼‰
      //     reuseExistingChunk: true, // å¦‚æœå½“å‰ chunk åŒ…å«å·²ä»ä¸» bundle ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å®ƒå°†è¢«é‡ç”¨ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—
      //   },
      //   default: { // å…¶ä»–æ²¡æœ‰å†™çš„é…ç½®ä¼šä½¿ç”¨ä¸Šé¢çš„é»˜è®¤å€¼
      //     minChunks: 2, // è¿™é‡Œçš„minChunksæƒé‡æ›´å¤§
      //     priority: -20,
      //     reuseExistingChunk: true,
      //   },
      // },
  },
};
```

###### 5. æ›´æ–°é…ç½®

æœ€ç»ˆæˆ‘ä»¬ä¼šä½¿ç”¨å•å…¥å£+ä»£ç åˆ†å‰²+åŠ¨æ€å¯¼å…¥æ–¹å¼æ¥è¿›è¡Œé…ç½®ã€‚æ›´æ–°ä¹‹å‰çš„é…ç½®æ–‡ä»¶ã€‚

```js{174-178}
// webpack.prod.js
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/main.js", // å°† js æ–‡ä»¶è¾“å‡ºåˆ° static/js ç›®å½•ä¸­
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            generator: {
              // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
              // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
              // [hash:8]: hashå€¼å–8ä½
              // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
              // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
              filename: "static/imgs/[hash:8][ext][query]",
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            generator: {
              filename: "static/media/[hash:8][ext][query]",
            },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/main.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // å…¶ä»–å†…å®¹ç”¨é»˜è®¤é…ç½®å³å¯
    },
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

##### 6. ç»™åŠ¨æ€å¯¼å…¥æ–‡ä»¶å–åç§°

1. ä¿®æ”¹æ–‡ä»¶

- main.js

```js
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

const result2 = sum(1, 2, 3, 4);
console.log(result2);

// ä»¥ä¸‹ä»£ç ç”Ÿäº§æ¨¡å¼ä¸‹ä¼šåˆ é™¤
if (module.hot) {
  module.hot.accept("./js/sum.js", function (sum) {
    const result2 = sum(1, 2, 3, 4);
    console.log(result2);
  });
}

document.getElementById("btn").onClick = function () {
  // eslintä¼šå¯¹åŠ¨æ€å¯¼å…¥è¯­æ³•æŠ¥é”™ï¼Œéœ€è¦ä¿®æ”¹eslinté…ç½®æ–‡ä»¶
  // webpackChunkName: "math"ï¼šè¿™æ˜¯webpackåŠ¨æ€å¯¼å…¥æ¨¡å—å‘½åçš„æ–¹å¼
  // "math"å°†æ¥å°±ä¼šä½œä¸º[name]çš„å€¼æ˜¾ç¤ºã€‚
  import(/* webpackChunkName: "math" */ "./js/math.js").then(({ count }) => {
    console.log(count(2, 1));
  });
};
```

2. eslint é…ç½®

- ä¸‹è½½åŒ…

```
npm i eslint-plugin-import -D
```

- é…ç½®

```js{9}
// .eslintrc.js
module.exports = {
  // ç»§æ‰¿ Eslint è§„åˆ™
  extends: ["eslint:recommended"],
  env: {
    node: true, // å¯ç”¨nodeä¸­å…¨å±€å˜é‡
    browser: true, // å¯ç”¨æµè§ˆå™¨ä¸­å…¨å±€å˜é‡
  },
  plugins: ["import"], // è§£å†³åŠ¨æ€å¯¼å…¥importè¯­æ³•æŠ¥é”™é—®é¢˜ --> å®é™…ä½¿ç”¨eslint-plugin-importçš„è§„åˆ™è§£å†³çš„
  parserOptions: {
    ecmaVersion: 6,
    sourceType: "module",
  },
  rules: {
    "no-var": 2, // ä¸èƒ½ä½¿ç”¨ var å®šä¹‰å˜é‡
  },
};
```

1. ç»Ÿä¸€å‘½åé…ç½®

```js{36-38,71-78,83-85,132-134}
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/[name].js", // å…¥å£æ–‡ä»¶æ‰“åŒ…è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    chunkFilename: "static/js/[name].chunk.js", // åŠ¨æ€å¯¼å…¥è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    assetModuleFilename: "static/media/[name].[hash][ext]", // å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºå‘½åæ–¹å¼ï¼ˆæ³¨æ„ç”¨hashï¼‰
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            // generator: {
            //   // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
            //   // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
            //   // [hash:8]: hashå€¼å–8ä½
            //   // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
            //   // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
            //   filename: "static/imgs/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            // generator: {
            //   filename: "static/media/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/[name].css",
      chunkFilename: "static/css/[name].chunk.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // å…¶ä»–å†…å®¹ç”¨é»˜è®¤é…ç½®å³å¯
    },
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

3. è¿è¡ŒæŒ‡ä»¤

```
npx webpack
```

è§‚å¯Ÿæ‰“åŒ…è¾“å‡º js æ–‡ä»¶åç§°ã€‚

## Preload / Prefetch

### ä¸ºä»€ä¹ˆ

æˆ‘ä»¬å‰é¢å·²ç»åšäº†ä»£ç åˆ†å‰²ï¼ŒåŒæ—¶ä¼šä½¿ç”¨ import åŠ¨æ€å¯¼å…¥è¯­æ³•æ¥è¿›è¡Œä»£ç æŒ‰éœ€åŠ è½½ï¼ˆæˆ‘ä»¬ä¹Ÿå«æ‡’åŠ è½½ï¼Œæ¯”å¦‚è·¯ç”±æ‡’åŠ è½½å°±æ˜¯è¿™æ ·å®ç°çš„ï¼‰ã€‚

ä½†æ˜¯åŠ è½½é€Ÿåº¦è¿˜ä¸å¤Ÿå¥½ï¼Œæ¯”å¦‚ï¼šæ˜¯ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶æ‰åŠ è½½è¿™ä¸ªèµ„æºçš„ï¼Œå¦‚æœèµ„æºä½“ç§¯å¾ˆå¤§ï¼Œé‚£ä¹ˆç”¨æˆ·ä¼šæ„Ÿè§‰åˆ°æ˜æ˜¾å¡é¡¿æ•ˆæœã€‚

æˆ‘ä»¬æƒ³åœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´ï¼ŒåŠ è½½åç»­éœ€è¦ä½¿ç”¨çš„èµ„æºã€‚æˆ‘ä»¬å°±éœ€è¦ç”¨ä¸Š `Preload` æˆ– `Prefetch` æŠ€æœ¯ã€‚

### æ˜¯ä»€ä¹ˆ

- `Preload`ï¼šå‘Šè¯‰æµè§ˆå™¨ç«‹å³åŠ è½½èµ„æºã€‚

- `Prefetch`ï¼šå‘Šè¯‰æµè§ˆå™¨åœ¨ç©ºé—²æ—¶æ‰å¼€å§‹åŠ è½½èµ„æºã€‚

å®ƒä»¬å…±åŒç‚¹ï¼š

- éƒ½åªä¼šåŠ è½½èµ„æºï¼Œå¹¶ä¸æ‰§è¡Œã€‚
- éƒ½æœ‰ç¼“å­˜ã€‚

å®ƒä»¬åŒºåˆ«ï¼š

- `Preload`åŠ è½½ä¼˜å…ˆçº§é«˜ï¼Œ`Prefetch`åŠ è½½ä¼˜å…ˆçº§ä½ã€‚
- `Preload`åªèƒ½åŠ è½½å½“å‰é¡µé¢éœ€è¦ä½¿ç”¨çš„èµ„æºï¼Œ`Prefetch`å¯ä»¥åŠ è½½å½“å‰é¡µé¢èµ„æºï¼Œä¹Ÿå¯ä»¥åŠ è½½ä¸‹ä¸€ä¸ªé¡µé¢éœ€è¦ä½¿ç”¨çš„èµ„æºã€‚

æ€»ç»“ï¼š

- å½“å‰é¡µé¢ä¼˜å…ˆçº§é«˜çš„èµ„æºç”¨ `Preload` åŠ è½½ã€‚
- ä¸‹ä¸€ä¸ªé¡µé¢éœ€è¦ä½¿ç”¨çš„èµ„æºç”¨ `Prefetch` åŠ è½½ã€‚

å®ƒä»¬çš„é—®é¢˜ï¼šå…¼å®¹æ€§è¾ƒå·®ã€‚

- æˆ‘ä»¬å¯ä»¥å» [Can I Use](https://caniuse.com/) ç½‘ç«™æŸ¥è¯¢ API çš„å…¼å®¹æ€§é—®é¢˜ã€‚
- `Preload` ç›¸å¯¹äº `Prefetch` å…¼å®¹æ€§å¥½ä¸€ç‚¹ã€‚

### æ€ä¹ˆç”¨

1. ä¸‹è½½åŒ…

```
npm i @vue/preload-webpack-plugin -D
```

2. é…ç½® webpack.prod.js

```js{9,139-143}
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const PreloadWebpackPlugin = require("@vue/preload-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    filename: "static/js/[name].js", // å…¥å£æ–‡ä»¶æ‰“åŒ…è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    chunkFilename: "static/js/[name].chunk.js", // åŠ¨æ€å¯¼å…¥è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    assetModuleFilename: "static/media/[name].[hash][ext]", // å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºå‘½åæ–¹å¼ï¼ˆæ³¨æ„ç”¨hashï¼‰
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            // generator: {
            //   // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
            //   // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
            //   // [hash:8]: hashå€¼å–8ä½
            //   // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
            //   // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
            //   filename: "static/imgs/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            // generator: {
            //   filename: "static/media/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/[name].css",
      chunkFilename: "static/css/[name].chunk.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
    new PreloadWebpackPlugin({
      rel: "preload", // preloadå…¼å®¹æ€§æ›´å¥½
      as: "script",
      // rel: 'prefetch' // prefetchå…¼å®¹æ€§æ›´å·®
    }),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // å…¶ä»–å†…å®¹ç”¨é»˜è®¤é…ç½®å³å¯
    },
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

## Network Cache

### ä¸ºä»€ä¹ˆ

å°†æ¥å¼€å‘æ—¶æˆ‘ä»¬å¯¹é™æ€èµ„æºä¼šä½¿ç”¨ç¼“å­˜æ¥ä¼˜åŒ–ï¼Œè¿™æ ·æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚èµ„æºå°±èƒ½è¯»å–ç¼“å­˜äº†ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚

ä½†æ˜¯è¿™æ ·çš„è¯å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜, å› ä¸ºå‰åè¾“å‡ºçš„æ–‡ä»¶åæ˜¯ä¸€æ ·çš„ï¼Œéƒ½å« main.jsï¼Œä¸€æ—¦å°†æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ–‡ä»¶åæ²¡æœ‰å˜åŒ–å¯¼è‡´æµè§ˆå™¨ä¼šç›´æ¥è¯»å–ç¼“å­˜ï¼Œä¸ä¼šåŠ è½½æ–°èµ„æºï¼Œé¡¹ç›®ä¹Ÿå°±æ²¡æ³•æ›´æ–°äº†ã€‚

æ‰€ä»¥æˆ‘ä»¬ä»æ–‡ä»¶åå…¥æ‰‹ï¼Œç¡®ä¿æ›´æ–°å‰åæ–‡ä»¶åä¸ä¸€æ ·ï¼Œè¿™æ ·å°±å¯ä»¥åšç¼“å­˜äº†ã€‚

### æ˜¯ä»€ä¹ˆ

å®ƒä»¬éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ hash å€¼ã€‚

- fullhashï¼ˆwebpack4 æ˜¯ hashï¼‰

æ¯æ¬¡ä¿®æ”¹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶åçš„ hash è‡³éƒ½å°†æ”¹å˜ã€‚æ‰€ä»¥ä¸€æ—¦ä¿®æ”¹äº†ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ç¼“å­˜éƒ½å°†å¤±æ•ˆã€‚

- chunkhash

æ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶(Entry)è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„ chunkï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚æˆ‘ä»¬ js å’Œ css æ˜¯åŒä¸€ä¸ªå¼•å…¥ï¼Œä¼šå…±äº«ä¸€ä¸ª hash å€¼ã€‚

- contenthash

æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆ hash å€¼ï¼Œåªæœ‰æ–‡ä»¶å†…å®¹å˜åŒ–äº†ï¼Œhash å€¼æ‰ä¼šå˜åŒ–ã€‚æ‰€æœ‰æ–‡ä»¶ hash å€¼æ˜¯ç‹¬äº«ä¸”ä¸åŒçš„ã€‚

### æ€ä¹ˆç”¨

```js{37-39,135-136}
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const PreloadWebpackPlugin = require("@vue/preload-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    // [contenthash:8]ä½¿ç”¨contenthashï¼Œå–8ä½é•¿åº¦
    filename: "static/js/[name].[contenthash:8].js", // å…¥å£æ–‡ä»¶æ‰“åŒ…è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    chunkFilename: "static/js/[name].[contenthash:8].chunk.js", // åŠ¨æ€å¯¼å…¥è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    assetModuleFilename: "static/media/[name].[hash][ext]", // å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºå‘½åæ–¹å¼ï¼ˆæ³¨æ„ç”¨hashï¼‰
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            // generator: {
            //   // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
            //   // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
            //   // [hash:8]: hashå€¼å–8ä½
            //   // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
            //   // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
            //   filename: "static/imgs/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            // generator: {
            //   filename: "static/media/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/[name].[contenthash:8].css",
      chunkFilename: "static/css/[name].[contenthash:8].chunk.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
    new PreloadWebpackPlugin({
      rel: "preload", // preloadå…¼å®¹æ€§æ›´å¥½
      as: "script",
      // rel: 'prefetch' // prefetchå…¼å®¹æ€§æ›´å·®
    }),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // å…¶ä»–å†…å®¹ç”¨é»˜è®¤é…ç½®å³å¯
    },
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

- é—®é¢˜ï¼š

å½“æˆ‘ä»¬ä¿®æ”¹ math.js æ–‡ä»¶å†é‡æ–°æ‰“åŒ…çš„æ—¶å€™ï¼Œå› ä¸º contenthash åŸå› ï¼Œmath.js æ–‡ä»¶ hash å€¼å‘ç”Ÿäº†å˜åŒ–ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰ã€‚

ä½†æ˜¯ main.js æ–‡ä»¶çš„ hash å€¼ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™ä¼šå¯¼è‡´ main.js çš„ç¼“å­˜å¤±æ•ˆã€‚æ˜æ˜æˆ‘ä»¬åªä¿®æ”¹ math.js, ä¸ºä»€ä¹ˆ main.js ä¹Ÿä¼šå˜èº«å˜åŒ–å‘¢ï¼Ÿ

- åŸå› ï¼š

  - æ›´æ–°å‰ï¼šmath.xxx.js, main.js å¼•ç”¨çš„ math.xxx.js
  - æ›´æ–°åï¼šmath.yyy.js, main.js å¼•ç”¨çš„ math.yyy.js, æ–‡ä»¶åå‘ç”Ÿäº†å˜åŒ–ï¼Œé—´æ¥å¯¼è‡´ main.js ä¹Ÿå‘ç”Ÿäº†å˜åŒ–

- è§£å†³ï¼š

å°† hash å€¼å•ç‹¬ä¿ç®¡åœ¨ä¸€ä¸ª runtime æ–‡ä»¶ä¸­ã€‚

æˆ‘ä»¬æœ€ç»ˆè¾“å‡ºä¸‰ä¸ªæ–‡ä»¶ï¼šmainã€mathã€runtimeã€‚å½“ math æ–‡ä»¶å‘é€å˜åŒ–ï¼Œå˜åŒ–çš„æ˜¯ math å’Œ runtime æ–‡ä»¶ï¼Œmain ä¸å˜ã€‚

runtime æ–‡ä»¶åªä¿å­˜æ–‡ä»¶çš„ hash å€¼å’Œå®ƒä»¬ä¸æ–‡ä»¶å…³ç³»ï¼Œæ•´ä¸ªæ–‡ä»¶ä½“ç§¯å°±æ¯”è¾ƒå°ï¼Œæ‰€ä»¥å˜åŒ–é‡æ–°è¯·æ±‚çš„ä»£ä»·ä¹Ÿå°ã€‚

```js{188-191}
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const PreloadWebpackPlugin = require("@vue/preload-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    // [contenthash:8]ä½¿ç”¨contenthashï¼Œå–8ä½é•¿åº¦
    filename: "static/js/[name].[contenthash:8].js", // å…¥å£æ–‡ä»¶æ‰“åŒ…è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    chunkFilename: "static/js/[name].[contenthash:8].chunk.js", // åŠ¨æ€å¯¼å…¥è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    assetModuleFilename: "static/media/[name].[hash][ext]", // å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºå‘½åæ–¹å¼ï¼ˆæ³¨æ„ç”¨hashï¼‰
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            // generator: {
            //   // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
            //   // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
            //   // [hash:8]: hashå€¼å–8ä½
            //   // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
            //   // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
            //   filename: "static/imgs/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            // generator: {
            //   filename: "static/media/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/[name].[contenthash:8].css",
      chunkFilename: "static/css/[name].[contenthash:8].chunk.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
    new PreloadWebpackPlugin({
      rel: "preload", // preloadå…¼å®¹æ€§æ›´å¥½
      as: "script",
      // rel: 'prefetch' // prefetchå…¼å®¹æ€§æ›´å·®
    }),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // å…¶ä»–å†…å®¹ç”¨é»˜è®¤é…ç½®å³å¯
    },
    // æå–runtimeæ–‡ä»¶
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`, // runtimeæ–‡ä»¶å‘½åè§„åˆ™
    },
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

## Core-js

### ä¸ºä»€ä¹ˆ

è¿‡å»æˆ‘ä»¬ä½¿ç”¨ babel å¯¹ js ä»£ç è¿›è¡Œäº†å…¼å®¹æ€§å¤„ç†ï¼Œå…¶ä¸­ä½¿ç”¨@babel/preset-env æ™ºèƒ½é¢„è®¾æ¥å¤„ç†å…¼å®¹æ€§é—®é¢˜ã€‚

å®ƒèƒ½å°† ES6 çš„ä¸€äº›è¯­æ³•è¿›è¡Œç¼–è¯‘è½¬æ¢ï¼Œæ¯”å¦‚ç®­å¤´å‡½æ•°ã€ç‚¹ç‚¹ç‚¹è¿ç®—ç¬¦ç­‰ã€‚ä½†æ˜¯å¦‚æœæ˜¯ async å‡½æ•°ã€promise å¯¹è±¡ã€æ•°ç»„çš„ä¸€äº›æ–¹æ³•ï¼ˆincludesï¼‰ç­‰ï¼Œå®ƒæ²¡åŠæ³•å¤„ç†ã€‚

æ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬ js ä»£ç ä»ç„¶å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œä¸€æ—¦é‡åˆ°ä½ç‰ˆæœ¬æµè§ˆå™¨ä¼šç›´æ¥æŠ¥é”™ã€‚æ‰€ä»¥æˆ‘ä»¬æƒ³è¦å°† js å…¼å®¹æ€§é—®é¢˜å½»åº•è§£å†³

### æ˜¯ä»€ä¹ˆ

`core-js` æ˜¯ä¸“é—¨ç”¨æ¥åš ES6 ä»¥åŠä»¥ä¸Š API çš„ `polyfill`ã€‚

`polyfill`ç¿»è¯‘è¿‡æ¥å«åšå«ç‰‡/è¡¥ä¸ã€‚å°±æ˜¯ç”¨ç¤¾åŒºä¸Šæä¾›çš„ä¸€æ®µä»£ç ï¼Œè®©æˆ‘ä»¬åœ¨ä¸å…¼å®¹æŸäº›æ–°ç‰¹æ€§çš„æµè§ˆå™¨ä¸Šï¼Œä½¿ç”¨è¯¥æ–°ç‰¹æ€§ã€‚

### æ€ä¹ˆç”¨

1. ä¿®æ”¹ main.js

```js{15-19}
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

const result1 = count(2, 1);
console.log(result1);
const result2 = sum(1, 2, 3, 4);
console.log(result2);
// æ·»åŠ promiseä»£ç 
const promise = Promise.resolve();
promise.then(() => {
  console.log("hello promise");
});
```

æ­¤æ—¶ Eslint ä¼šå¯¹ Promise æŠ¥é”™ã€‚

2. ä¿®æ”¹é…ç½®æ–‡ä»¶

- ä¸‹è½½åŒ…

```
npm i @babel/eslint-parser -D
```

- .eslintrc.js

```js{4}
module.exports = {
  // ç»§æ‰¿ Eslint è§„åˆ™
  extends: ["eslint:recommended"],
  parser: "@babel/eslint-parser", // æ”¯æŒæœ€æ–°çš„æœ€ç»ˆ ECMAScript æ ‡å‡†
  env: {
    node: true, // å¯ç”¨nodeä¸­å…¨å±€å˜é‡
    browser: true, // å¯ç”¨æµè§ˆå™¨ä¸­å…¨å±€å˜é‡
  },
  plugins: ["import"], // è§£å†³åŠ¨æ€å¯¼å…¥importè¯­æ³•æŠ¥é”™é—®é¢˜ --> å®é™…ä½¿ç”¨eslint-plugin-importçš„è§„åˆ™è§£å†³çš„
  parserOptions: {
    ecmaVersion: 6, // es6
    sourceType: "module", // es module
  },
  rules: {
    "no-var": 2, // ä¸èƒ½ä½¿ç”¨ var å®šä¹‰å˜é‡
  },
};
```

3. è¿è¡ŒæŒ‡ä»¤

```
npm run build
```

æ­¤æ—¶è§‚å¯Ÿæ‰“åŒ…è¾“å‡ºçš„ js æ–‡ä»¶ï¼Œæˆ‘ä»¬å‘ç° Promise è¯­æ³•å¹¶æ²¡æœ‰ç¼–è¯‘è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ `core-js` æ¥è¿›è¡Œ `polyfill`ã€‚

4. ä½¿ç”¨`core-js`

- ä¸‹è½½åŒ…

```
npm i core-js
```

- æ‰‹åŠ¨å…¨éƒ¨å¼•å…¥

```js{1}
import "core-js";
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

const result1 = count(2, 1);
console.log(result1);
const result2 = sum(1, 2, 3, 4);
console.log(result2);
// æ·»åŠ promiseä»£ç 
const promise = Promise.resolve();
promise.then(() => {
  console.log("hello promise");
});
```

è¿™æ ·å¼•å…¥ä¼šå°†æ‰€æœ‰å…¼å®¹æ€§ä»£ç å…¨éƒ¨å¼•å…¥ï¼Œä½“ç§¯å¤ªå¤§äº†ã€‚æˆ‘ä»¬åªæƒ³å¼•å…¥ promise çš„ `polyfill`ã€‚

- æ‰‹åŠ¨æŒ‰éœ€å¼•å…¥

```js{1}
import "core-js/es/promise";
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

const result1 = count(2, 1);
console.log(result1);
const result2 = sum(1, 2, 3, 4);
console.log(result2);
// æ·»åŠ promiseä»£ç 
const promise = Promise.resolve();
promise.then(() => {
  console.log("hello promise");
});
```

åªå¼•å…¥æ‰“åŒ… promise çš„ `polyfill`ï¼Œæ‰“åŒ…ä½“ç§¯æ›´å°ã€‚ä½†æ˜¯å°†æ¥å¦‚æœè¿˜æƒ³ä½¿ç”¨å…¶ä»–è¯­æ³•ï¼Œæˆ‘éœ€è¦æ‰‹åŠ¨å¼•å…¥åº“å¾ˆéº»çƒ¦ã€‚

- è‡ªåŠ¨æŒ‰éœ€å¼•å…¥

  - main.js

  ```js
  import count from "./js/count";
  import sum from "./js/sum";
  // å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
  import "./css/iconfont.css";
  import "./css/index.css";
  import "./less/index.less";
  import "./sass/index.sass";
  import "./sass/index.scss";
  import "./styl/index.styl";
  
  const result1 = count(2, 1);
  console.log(result1);
  const result2 = sum(1, 2, 3, 4);
  console.log(result2);
  // æ·»åŠ promiseä»£ç 
  const promise = Promise.resolve();
  promise.then(() => {
    console.log("hello promise");
  });
  ```

  - babel.config.js

  ```js
  module.exports = {
    // æ™ºèƒ½é¢„è®¾ï¼šèƒ½å¤Ÿç¼–è¯‘ES6è¯­æ³•
    presets: [
      [
        "@babel/preset-env",
        // æŒ‰éœ€åŠ è½½core-jsçš„polyfill
        { useBuiltIns: "usage", corejs: { version: "3", proposals: true } },
      ],
    ],
  };
  ```

æ­¤æ—¶å°±ä¼šè‡ªåŠ¨æ ¹æ®æˆ‘ä»¬ä»£ç ä¸­ä½¿ç”¨çš„è¯­æ³•ï¼Œæ¥æŒ‰éœ€åŠ è½½ç›¸åº”çš„ `polyfill` äº†ã€‚

## PWA

### ä¸ºä»€ä¹ˆ

å¼€å‘ Web App é¡¹ç›®ï¼Œé¡¹ç›®ä¸€æ—¦å¤„äºç½‘ç»œç¦»çº¿æƒ…å†µï¼Œå°±æ²¡æ³•è®¿é—®äº†ã€‚

æˆ‘ä»¬å¸Œæœ›ç»™é¡¹ç›®æä¾›ç¦»çº¿ä½“éªŒã€‚

### æ˜¯ä»€ä¹ˆ

æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åº(progressive web application - PWA)ï¼šæ˜¯ä¸€ç§å¯ä»¥æä¾›ç±»ä¼¼äº native app(åŸç”Ÿåº”ç”¨ç¨‹åº) ä½“éªŒçš„ Web App çš„æŠ€æœ¯ã€‚

å…¶ä¸­æœ€é‡è¦çš„æ˜¯ï¼Œåœ¨ **ç¦»çº¿(offline)** æ—¶åº”ç”¨ç¨‹åºèƒ½å¤Ÿç»§ç»­è¿è¡ŒåŠŸèƒ½ã€‚

å†…éƒ¨é€šè¿‡ Service Workers æŠ€æœ¯å®ç°çš„ã€‚

### æ€ä¹ˆç”¨

1. ä¸‹è½½åŒ…

```
npm i workbox-webpack-plugin -D
```

2. ä¿®æ”¹é…ç½®æ–‡ä»¶

```js{10,146-151}
const os = require("os");
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const PreloadWebpackPlugin = require("@vue/preload-webpack-plugin");
const WorkboxPlugin = require("workbox-webpack-plugin");

// cpuæ ¸æ•°
const threads = os.cpus().length;

// è·å–å¤„ç†æ ·å¼çš„Loaders
const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"), // ç”Ÿäº§æ¨¡å¼éœ€è¦è¾“å‡º
    // [contenthash:8]ä½¿ç”¨contenthashï¼Œå–8ä½é•¿åº¦
    filename: "static/js/[name].[contenthash:8].js", // å…¥å£æ–‡ä»¶æ‰“åŒ…è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    chunkFilename: "static/js/[name].[contenthash:8].chunk.js", // åŠ¨æ€å¯¼å…¥è¾“å‡ºèµ„æºå‘½åæ–¹å¼
    assetModuleFilename: "static/media/[name].[hash][ext]", // å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºå‘½åæ–¹å¼ï¼ˆæ³¨æ„ç”¨hashï¼‰
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
            // generator: {
            //   // å°†å›¾ç‰‡æ–‡ä»¶è¾“å‡ºåˆ° static/imgs ç›®å½•ä¸­
            //   // å°†å›¾ç‰‡æ–‡ä»¶å‘½å [hash:8][ext][query]
            //   // [hash:8]: hashå€¼å–8ä½
            //   // [ext]: ä½¿ç”¨ä¹‹å‰çš„æ–‡ä»¶æ‰©å±•å
            //   // [query]: æ·»åŠ ä¹‹å‰çš„queryå‚æ•°
            //   filename: "static/imgs/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
            // generator: {
            //   filename: "static/media/[hash:8][ext][query]",
            // },
          },
          {
            test: /\.js$/,
            // exclude: /node_modules/, // æ’é™¤node_modulesä»£ç ä¸ç¼–è¯‘
            include: path.resolve(__dirname, "../src"), // ä¹Ÿå¯ä»¥ç”¨åŒ…å«
            use: [
              {
                loader: "thread-loader", // å¼€å¯å¤šè¿›ç¨‹
                options: {
                  workers: threads, // æ•°é‡
                },
              },
              {
                loader: "babel-loader",
                options: {
                  cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
                  cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
                  plugins: ["@babel/plugin-transform-runtime"], // å‡å°‘ä»£ç ä½“ç§¯
                },
              },
            ],
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      // æŒ‡å®šæ£€æŸ¥æ–‡ä»¶çš„æ ¹ç›®å½•
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules", // é»˜è®¤å€¼
      cache: true, // å¼€å¯ç¼“å­˜
      // ç¼“å­˜ç›®å½•
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
      threads, // å¼€å¯å¤šè¿›ç¨‹
    }),
    new HtmlWebpackPlugin({
      // ä»¥ public/index.html ä¸ºæ¨¡æ¿åˆ›å»ºæ–‡ä»¶
      // æ–°çš„htmlæ–‡ä»¶æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1. å†…å®¹å’Œæºæ–‡ä»¶ä¸€è‡´ 2. è‡ªåŠ¨å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„jsç­‰èµ„æº
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    // æå–cssæˆå•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({
      // å®šä¹‰è¾“å‡ºæ–‡ä»¶åå’Œç›®å½•
      filename: "static/css/[name].[contenthash:8].css",
      chunkFilename: "static/css/[name].[contenthash:8].chunk.css",
    }),
    // csså‹ç¼©
    // new CssMinimizerPlugin(),
    new PreloadWebpackPlugin({
      rel: "preload", // preloadå…¼å®¹æ€§æ›´å¥½
      as: "script",
      // rel: 'prefetch' // prefetchå…¼å®¹æ€§æ›´å·®
    }),
    new WorkboxPlugin.GenerateSW({
      // è¿™äº›é€‰é¡¹å¸®åŠ©å¿«é€Ÿå¯ç”¨ ServiceWorkers
      // ä¸å…è®¸é—ç•™ä»»ä½•â€œæ—§çš„â€ ServiceWorkers
      clientsClaim: true,
      skipWaiting: true,
    }),
  ],
  optimization: {
    minimizer: [
      // csså‹ç¼©ä¹Ÿå¯ä»¥å†™åˆ°optimization.minimizeré‡Œé¢ï¼Œæ•ˆæœä¸€æ ·çš„
      new CssMinimizerPlugin(),
      // å½“ç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¼€å¯TerserPluginï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…¶ä»–é…ç½®ï¼Œå°±è¦é‡æ–°å†™äº†
      new TerserPlugin({
        parallel: threads, // å¼€å¯å¤šè¿›ç¨‹
      }),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all", // å¯¹æ‰€æœ‰æ¨¡å—éƒ½è¿›è¡Œåˆ†å‰²
      // å…¶ä»–å†…å®¹ç”¨é»˜è®¤é…ç½®å³å¯
    },
  },
  // devServer: {
  //   host: "localhost", // å¯åŠ¨æœåŠ¡å™¨åŸŸå
  //   port: "3000", // å¯åŠ¨æœåŠ¡å™¨ç«¯å£å·
  //   open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  // },
  mode: "production",
  devtool: "source-map",
};
```

3. ä¿®æ”¹ main.js

```js{24-35}
import count from "./js/count";
import sum from "./js/sum";
// å¼•å…¥èµ„æºï¼ŒWebpackæ‰ä¼šå¯¹å…¶æ‰“åŒ…
import "./css/iconfont.css";
import "./css/index.css";
import "./less/index.less";
import "./sass/index.sass";
import "./sass/index.scss";
import "./styl/index.styl";

const result1 = count(2, 1);
console.log(result1);
const result2 = sum(1, 2, 3, 4);
console.log(result2);
// æ·»åŠ promiseä»£ç 
const promise = Promise.resolve();
promise.then(() => {
  console.log("hello promise");
});

const arr = [1, 2, 3, 4, 5];
console.log(arr.includes(5));

if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker
      .register("/service-worker.js")
      .then((registration) => {
        console.log("SW registered: ", registration);
      })
      .catch((registrationError) => {
        console.log("SW registration failed: ", registrationError);
      });
  });
}
```

4. è¿è¡ŒæŒ‡ä»¤

```
npm run build
```

æ­¤æ—¶å¦‚æœç›´æ¥é€šè¿‡ VSCode è®¿é—®æ‰“åŒ…åé¡µé¢ï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°ä¼šå‘ç° `SW registration failed`ã€‚

å› ä¸ºæˆ‘ä»¬æ‰“å¼€çš„è®¿é—®è·¯å¾„æ˜¯ï¼š`http://127.0.0.1:5500/dist/index.html`ã€‚æ­¤æ—¶é¡µé¢ä¼šå»è¯·æ±‚ `service-worker.js` æ–‡ä»¶ï¼Œè¯·æ±‚è·¯å¾„æ˜¯ï¼š`http://127.0.0.1:5500/service-worker.js`ï¼Œè¿™æ ·æ‰¾ä¸åˆ°ä¼š 404ã€‚

å®é™… `service-worker.js` æ–‡ä»¶è·¯å¾„æ˜¯ï¼š`http://127.0.0.1:5500/dist/service-worker.js`ã€‚

5. è§£å†³è·¯å¾„é—®é¢˜

- ä¸‹è½½åŒ…

```
npm i serve -g
```

serve ä¹Ÿæ˜¯ç”¨æ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨æ¥éƒ¨ç½²ä»£ç æŸ¥çœ‹æ•ˆæœçš„ã€‚

- è¿è¡ŒæŒ‡ä»¤

```
serve dist
```

æ­¤æ—¶é€šè¿‡ serve å¯åŠ¨çš„æœåŠ¡å™¨æˆ‘ä»¬ service-worker å°±èƒ½æ³¨å†ŒæˆåŠŸäº†ã€‚

# æ€»ç»“

æˆ‘ä»¬ä» 4 ä¸ªè§’åº¦å¯¹ webpack å’Œä»£ç è¿›è¡Œäº†ä¼˜åŒ–ï¼š

1. æå‡å¼€å‘ä½“éªŒ

- ä½¿ç”¨ `Source Map` è®©å¼€å‘æˆ–ä¸Šçº¿æ—¶ä»£ç æŠ¥é”™èƒ½æœ‰æ›´åŠ å‡†ç¡®çš„é”™è¯¯æç¤ºã€‚

2. æå‡ webpack æå‡æ‰“åŒ…æ„å»ºé€Ÿåº¦

- ä½¿ç”¨ `HotModuleReplacement` è®©å¼€å‘æ—¶åªé‡æ–°ç¼–è¯‘æ‰“åŒ…æ›´æ–°å˜åŒ–äº†çš„ä»£ç ï¼Œä¸å˜çš„ä»£ç ä½¿ç”¨ç¼“å­˜ï¼Œä»è€Œä½¿æ›´æ–°é€Ÿåº¦æ›´å¿«ã€‚
- ä½¿ç”¨ `OneOf` è®©èµ„æºæ–‡ä»¶ä¸€æ—¦è¢«æŸä¸ª loader å¤„ç†äº†ï¼Œå°±ä¸ä¼šç»§ç»­éå†äº†ï¼Œæ‰“åŒ…é€Ÿåº¦æ›´å¿«ã€‚
- ä½¿ç”¨ `Include/Exclude` æ’é™¤æˆ–åªæ£€æµ‹æŸäº›æ–‡ä»¶ï¼Œå¤„ç†çš„æ–‡ä»¶æ›´å°‘ï¼Œé€Ÿåº¦æ›´å¿«ã€‚
- ä½¿ç”¨ `Cache` å¯¹ eslint å’Œ babel å¤„ç†çš„ç»“æœè¿›è¡Œç¼“å­˜ï¼Œè®©ç¬¬äºŒæ¬¡æ‰“åŒ…é€Ÿåº¦æ›´å¿«ã€‚
- ä½¿ç”¨ `Thead` å¤šè¿›ç¨‹å¤„ç† eslint å’Œ babel ä»»åŠ¡ï¼Œé€Ÿåº¦æ›´å¿«ã€‚ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿›ç¨‹å¯åŠ¨é€šä¿¡éƒ½æœ‰å¼€é”€çš„ï¼Œè¦åœ¨æ¯”è¾ƒå¤šä»£ç å¤„ç†æ—¶ä½¿ç”¨æ‰æœ‰æ•ˆæœï¼‰

3. å‡å°‘ä»£ç ä½“ç§¯

- ä½¿ç”¨ `Tree Shaking` å‰”é™¤äº†æ²¡æœ‰ä½¿ç”¨çš„å¤šä½™ä»£ç ï¼Œè®©ä»£ç ä½“ç§¯æ›´å°ã€‚
- ä½¿ç”¨ `@babel/plugin-transform-runtime` æ’ä»¶å¯¹ babel è¿›è¡Œå¤„ç†ï¼Œè®©è¾…åŠ©ä»£ç ä»ä¸­å¼•å…¥ï¼Œè€Œä¸æ˜¯æ¯ä¸ªæ–‡ä»¶éƒ½ç”Ÿæˆè¾…åŠ©ä»£ç ï¼Œä»è€Œä½“ç§¯æ›´å°ã€‚
- ä½¿ç”¨ `Image Minimizer` å¯¹é¡¹ç›®ä¸­å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œä½“ç§¯æ›´å°ï¼Œè¯·æ±‚é€Ÿåº¦æ›´å¿«ã€‚ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé¡¹ç›®ä¸­å›¾ç‰‡éƒ½æ˜¯åœ¨çº¿é“¾æ¥ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦äº†ã€‚æœ¬åœ°é¡¹ç›®é™æ€å›¾ç‰‡æ‰éœ€è¦è¿›è¡Œå‹ç¼©ã€‚ï¼‰

4. ä¼˜åŒ–ä»£ç è¿è¡Œæ€§èƒ½

- ä½¿ç”¨ `Code Split` å¯¹ä»£ç è¿›è¡Œåˆ†å‰²æˆå¤šä¸ª js æ–‡ä»¶ï¼Œä»è€Œä½¿å•ä¸ªæ–‡ä»¶ä½“ç§¯æ›´å°ï¼Œå¹¶è¡ŒåŠ è½½ js é€Ÿåº¦æ›´å¿«ã€‚å¹¶é€šè¿‡ import åŠ¨æ€å¯¼å…¥è¯­æ³•è¿›è¡ŒæŒ‰éœ€åŠ è½½ï¼Œä»è€Œè¾¾åˆ°éœ€è¦ä½¿ç”¨æ—¶æ‰åŠ è½½è¯¥èµ„æºï¼Œä¸ç”¨æ—¶ä¸åŠ è½½èµ„æºã€‚
- ä½¿ç”¨ `Preload / Prefetch` å¯¹ä»£ç è¿›è¡Œæå‰åŠ è½½ï¼Œç­‰æœªæ¥éœ€è¦ä½¿ç”¨æ—¶å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼Œä»è€Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚
- ä½¿ç”¨ `Network Cache` èƒ½å¯¹è¾“å‡ºèµ„æºæ–‡ä»¶è¿›è¡Œæ›´å¥½çš„å‘½åï¼Œå°†æ¥å¥½åšç¼“å­˜ï¼Œä»è€Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚
- ä½¿ç”¨ `Core-js` å¯¹ js è¿›è¡Œå…¼å®¹æ€§å¤„ç†ï¼Œè®©æˆ‘ä»¬ä»£ç èƒ½è¿è¡Œåœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨ã€‚
- ä½¿ç”¨ `PWA` èƒ½è®©ä»£ç ç¦»çº¿ä¹Ÿèƒ½è®¿é—®ï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚

# ä»‹ç»

æˆ‘ä»¬å°†ä½¿ç”¨å‰é¢æ‰€å­¦çš„çŸ¥è¯†æ¥ä»é›¶å¼€å§‹æ­å»º `React-Cli` å’Œ `Vue-cli`ã€‚

# React è„šæ‰‹æ¶

## å¼€å‘æ¨¡å¼é…ç½®

```js
// webpack.dev.js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const ReactRefreshWebpackPlugin = require("@pmmmwh/react-refresh-webpack-plugin");
const CopyPlugin = require("copy-webpack-plugin");

const getStyleLoaders = (preProcessor) => {
  return [
    "style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined,
    filename: "static/js/[name].js",
    chunkFilename: "static/js/[name].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
          },
          {
            test: /\.(jsx|js)$/,
            include: path.resolve(__dirname, "../src"),
            loader: "babel-loader",
            options: {
              cacheDirectory: true,
              cacheCompression: false,
              plugins: [
                // "@babel/plugin-transform-runtime", // presetsä¸­åŒ…å«äº†
                "react-refresh/babel", // å¼€å¯jsçš„HMRåŠŸèƒ½
              ],
            },
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    new ReactRefreshWebpackPlugin(), // è§£å†³jsçš„HMRåŠŸèƒ½è¿è¡Œæ—¶å…¨å±€å˜é‡çš„é—®é¢˜
    // å°†publicä¸‹é¢çš„èµ„æºå¤åˆ¶åˆ°distç›®å½•å»ï¼ˆé™¤äº†index.htmlï¼‰
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true, // ä¸ç”Ÿæˆé”™è¯¯
          globOptions: {
            // å¿½ç•¥æ–‡ä»¶
            ignore: ["**/index.html"],
          },
          info: {
            // è·³è¿‡terserå‹ç¼©js
            minimized: true,
          },
        },
      ],
    }),
  ],
  optimization: {
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"], // è‡ªåŠ¨è¡¥å…¨æ–‡ä»¶æ‰©å±•åï¼Œè®©jsxå¯ä»¥ä½¿ç”¨
  },
  devServer: {
    open: true,
    host: "localhost",
    port: 3000,
    hot: true,
    compress: true,
    historyApiFallback: true, // è§£å†³react-routeråˆ·æ–°404é—®é¢˜
  },
  mode: "development",
  devtool: "cheap-module-source-map",
};
```

## ç”Ÿäº§æ¨¡å¼é…ç½®

```js
// webpack.prod.js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const CopyPlugin = require("copy-webpack-plugin");

const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"),
    filename: "static/js/[name].[contenthash:10].js",
    chunkFilename: "static/js/[name].[contenthash:10].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
          },
          {
            test: /\.(jsx|js)$/,
            include: path.resolve(__dirname, "../src"),
            loader: "babel-loader",
            options: {
              cacheDirectory: true,
              cacheCompression: false,
              plugins: [
                // "@babel/plugin-transform-runtime" // presetsä¸­åŒ…å«äº†
              ],
            },
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    new MiniCssExtractPlugin({
      filename: "static/css/[name].[contenthash:10].css",
      chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
    }),
    // å°†publicä¸‹é¢çš„èµ„æºå¤åˆ¶åˆ°distç›®å½•å»ï¼ˆé™¤äº†index.htmlï¼‰
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true, // ä¸ç”Ÿæˆé”™è¯¯
          globOptions: {
            // å¿½ç•¥æ–‡ä»¶
            ignore: ["**/index.html"],
          },
          info: {
            // è·³è¿‡terserå‹ç¼©js
            minimized: true,
          },
        },
      ],
    }),
  ],
  optimization: {
    // å‹ç¼©çš„æ“ä½œ
    minimizer: [
      new CssMinimizerPlugin(),
      new TerserWebpackPlugin(),
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"],
  },
  mode: "production",
  devtool: "source-map",
};
```

## å…¶ä»–é…ç½®

- package.json

```json
{
  "name": "react-cli",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "start": "npm run dev",
    "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js",
    "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.prod.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@babel/core": "^7.17.10",
    "@pmmmwh/react-refresh-webpack-plugin": "^0.5.5",
    "babel-loader": "^8.2.5",
    "babel-preset-react-app": "^10.0.1",
    "copy-webpack-plugin": "^10.2.4",
    "cross-env": "^7.0.3",
    "css-loader": "^6.7.1",
    "css-minimizer-webpack-plugin": "^3.4.1",
    "eslint-config-react-app": "^7.0.1",
    "eslint-webpack-plugin": "^3.1.1",
    "html-webpack-plugin": "^5.5.0",
    "image-minimizer-webpack-plugin": "^3.2.3",
    "imagemin": "^8.0.1",
    "imagemin-gifsicle": "^7.0.0",
    "imagemin-jpegtran": "^7.0.0",
    "imagemin-optipng": "^8.0.0",
    "imagemin-svgo": "^10.0.1",
    "less-loader": "^10.2.0",
    "mini-css-extract-plugin": "^2.6.0",
    "postcss-loader": "^6.2.1",
    "postcss-preset-env": "^7.5.0",
    "react-refresh": "^0.13.0",
    "sass-loader": "^12.6.0",
    "style-loader": "^3.3.1",
    "stylus-loader": "^6.2.0",
    "webpack": "^5.72.0",
    "webpack-cli": "^4.9.2",
    "webpack-dev-server": "^4.9.0"
  },
  "dependencies": {
    "antd": "^4.20.2",
    "react": "^18.1.0",
    "react-dom": "^18.1.0",
    "react-router-dom": "^6.3.0"
  },
  "browserslist": ["last 2 version", "> 1%", "not dead"]
}
```

- .eslintrc.js

```js
module.exports = {
  extends: ["react-app"], // ç»§æ‰¿ react å®˜æ–¹è§„åˆ™
  parserOptions: {
    babelOptions: {
      presets: [
        // è§£å†³é¡µé¢æŠ¥é”™é—®é¢˜
        ["babel-preset-react-app", false],
        "babel-preset-react-app/prod",
      ],
    },
  },
};
```

- babel.config.js

```js
module.exports = {
  // ä½¿ç”¨reactå®˜æ–¹è§„åˆ™
  presets: ["react-app"],
};
```

## åˆå¹¶å¼€å‘å’Œç”Ÿäº§é…ç½®

- webpack.config.js

```js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const ReactRefreshWebpackPlugin = require("@pmmmwh/react-refresh-webpack-plugin");

// éœ€è¦é€šè¿‡ cross-env å®šä¹‰ç¯å¢ƒå˜é‡
const isProduction = process.env.NODE_ENV === "production";

const getStyleLoaders = (preProcessor) => {
  return [
    isProduction ? MiniCssExtractPlugin.loader : "style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: isProduction ? path.resolve(__dirname, "../dist") : undefined,
    filename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    chunkFilename: isProduction
      ? "static/js/[name].[contenthash:10].chunk.js"
      : "static/js/[name].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
            test: /\.css$/,
            // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
              },
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
          },
          {
            test: /\.(jsx|js)$/,
            include: path.resolve(__dirname, "../src"),
            loader: "babel-loader",
            options: {
              cacheDirectory: true, // å¼€å¯babelç¼–è¯‘ç¼“å­˜
              cacheCompression: false, // ç¼“å­˜æ–‡ä»¶ä¸è¦å‹ç¼©
              plugins: [
                // "@babel/plugin-transform-runtime",  // presetsä¸­åŒ…å«äº†
                !isProduction && "react-refresh/babel",
              ].filter(Boolean),
            },
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      extensions: [".js", ".jsx"],
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    isProduction &&
      new MiniCssExtractPlugin({
        filename: "static/css/[name].[contenthash:10].css",
        chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
      }),
    !isProduction && new ReactRefreshWebpackPlugin(),
  ].filter(Boolean),
  optimization: {
    minimize: isProduction,
    // å‹ç¼©çš„æ“ä½œ
    minimizer: [
      // å‹ç¼©css
      new CssMinimizerPlugin(),
      // å‹ç¼©js
      new TerserWebpackPlugin(),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all",
      // å…¶ä»–éƒ½ç”¨é»˜è®¤å€¼
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"],
  },
  devServer: {
    open: true,
    host: "localhost",
    port: 3000,
    hot: true,
    compress: true,
    historyApiFallback: true,
  },
  mode: isProduction ? "production" : "development",
  devtool: isProduction ? "source-map" : "cheap-module-source-map",
};
```

- ä¿®æ”¹è¿è¡ŒæŒ‡ä»¤ package.json

```json{8-9}
{
  "name": "react-cli",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "start": "npm run dev",
    "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.config.js",
    "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.config.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@babel/core": "^7.17.10",
    "@pmmmwh/react-refresh-webpack-plugin": "^0.5.5",
    "babel-loader": "^8.2.5",
    "babel-preset-react-app": "^10.0.1",
    "cross-env": "^7.0.3",
    "css-loader": "^6.7.1",
    "css-minimizer-webpack-plugin": "^3.4.1",
    "eslint-config-react-app": "^7.0.1",
    "eslint-webpack-plugin": "^3.1.1",
    "html-webpack-plugin": "^5.5.0",
    "image-minimizer-webpack-plugin": "^3.2.3",
    "imagemin": "^8.0.1",
    "imagemin-gifsicle": "^7.0.0",
    "imagemin-jpegtran": "^7.0.0",
    "imagemin-optipng": "^8.0.0",
    "imagemin-svgo": "^10.0.1",
    "less-loader": "^10.2.0",
    "mini-css-extract-plugin": "^2.6.0",
    "react-refresh": "^0.13.0",
    "sass-loader": "^12.6.0",
    "style-loader": "^3.3.1",
    "stylus-loader": "^6.2.0",
    "webpack": "^5.72.0",
    "webpack-cli": "^4.9.2",
    "webpack-dev-server": "^4.9.0"
  },
  "dependencies": {
    "react": "^18.1.0",
    "react-dom": "^18.1.0",
    "react-router-dom": "^6.3.0"
  },
  "browserslist": ["last 2 version", "> 1%", "not dead"]
}
```

## ä¼˜åŒ–é…ç½®

```js{27-42,189-219,238}
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const ReactRefreshWebpackPlugin = require("@pmmmwh/react-refresh-webpack-plugin");
const CopyPlugin = require("copy-webpack-plugin");

const isProduction = process.env.NODE_ENV === "production";

const getStyleLoaders = (preProcessor) => {
  return [
    isProduction ? MiniCssExtractPlugin.loader : "style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env",
          ],
        },
      },
    },
    preProcessor && {
      loader: preProcessor,
      options:
        preProcessor === "less-loader"
          ? {
              // antdçš„è‡ªå®šä¹‰ä¸»é¢˜
              lessOptions: {
                modifyVars: {
                  // å…¶ä»–ä¸»é¢˜è‰²ï¼šhttps://ant.design/docs/react/customize-theme-cn
                  "@primary-color": "#1DA57A", // å…¨å±€ä¸»è‰²
                },
                javascriptEnabled: true,
              },
            }
          : {},
    },
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: isProduction ? path.resolve(__dirname, "../dist") : undefined,
    filename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    chunkFilename: isProduction
      ? "static/js/[name].[contenthash:10].chunk.js"
      : "static/js/[name].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      {
        oneOf: [
          {
            test: /\.css$/,
            use: getStyleLoaders(),
          },
          {
            test: /\.less$/,
            use: getStyleLoaders("less-loader"),
          },
          {
            test: /\.s[ac]ss$/,
            use: getStyleLoaders("sass-loader"),
          },
          {
            test: /\.styl$/,
            use: getStyleLoaders("stylus-loader"),
          },
          {
            test: /\.(png|jpe?g|gif|svg)$/,
            type: "asset",
            parser: {
              dataUrlCondition: {
                maxSize: 10 * 1024,
              },
            },
          },
          {
            test: /\.(ttf|woff2?)$/,
            type: "asset/resource",
          },
          {
            test: /\.(jsx|js)$/,
            include: path.resolve(__dirname, "../src"),
            loader: "babel-loader",
            options: {
              cacheDirectory: true,
              cacheCompression: false,
              plugins: [
                // "@babel/plugin-transform-runtime",  // presetsä¸­åŒ…å«äº†
                !isProduction && "react-refresh/babel",
              ].filter(Boolean),
            },
          },
        ],
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      extensions: [".js", ".jsx"],
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    isProduction &&
      new MiniCssExtractPlugin({
        filename: "static/css/[name].[contenthash:10].css",
        chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
      }),
    !isProduction && new ReactRefreshWebpackPlugin(),
    // å°†publicä¸‹é¢çš„èµ„æºå¤åˆ¶åˆ°distç›®å½•å»ï¼ˆé™¤äº†index.htmlï¼‰
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true, // ä¸ç”Ÿæˆé”™è¯¯
          globOptions: {
            // å¿½ç•¥æ–‡ä»¶
            ignore: ["**/index.html"],
          },
          info: {
            // è·³è¿‡terserå‹ç¼©js
            minimized: true,
          },
        },
      ],
    }),
  ].filter(Boolean),
  optimization: {
    minimize: isProduction,
    // å‹ç¼©çš„æ“ä½œ
    minimizer: [
      // å‹ç¼©css
      new CssMinimizerPlugin(),
      // å‹ç¼©js
      new TerserWebpackPlugin(),
      // å‹ç¼©å›¾ç‰‡
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    // ä»£ç åˆ†å‰²é…ç½®
    splitChunks: {
      chunks: "all",
      cacheGroups: {
        // layoutsé€šå¸¸æ˜¯adminé¡¹ç›®çš„ä¸»ä½“å¸ƒå±€ç»„ä»¶ï¼Œæ‰€æœ‰è·¯ç”±ç»„ä»¶éƒ½è¦ä½¿ç”¨çš„
        // å¯ä»¥å•ç‹¬æ‰“åŒ…ï¼Œä»è€Œå¤ç”¨
        // å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ï¼Œè¯·åˆ é™¤
        layouts: {
          name: "layouts",
          test: path.resolve(__dirname, "../src/layouts"),
          priority: 40,
        },
        // å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨antdï¼Œæ­¤æ—¶å°†æ‰€æœ‰node_modulesæ‰“åŒ…åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆæ‰“åŒ…è¾“å‡ºæ–‡ä»¶ä¼šæ¯”è¾ƒå¤§ã€‚
        // æ‰€ä»¥æˆ‘ä»¬å°†node_modulesä¸­æ¯”è¾ƒå¤§çš„æ¨¡å—å•ç‹¬æ‰“åŒ…ï¼Œä»è€Œå¹¶è¡ŒåŠ è½½é€Ÿåº¦æ›´å¥½
        // å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ï¼Œè¯·åˆ é™¤
        antd: {
          name: "chunk-antd",
          test: /[\\/]node_modules[\\/]antd(.*)/,
          priority: 30,
        },
        // å°†reactç›¸å…³çš„åº“å•ç‹¬æ‰“åŒ…ï¼Œå‡å°‘node_modulesçš„chunkä½“ç§¯ã€‚
        react: {
          name: "react",
          test: /[\\/]node_modules[\\/]react(.*)?[\\/]/,
          chunks: "initial",
          priority: 20,
        },
        libs: {
          name: "chunk-libs",
          test: /[\\/]node_modules[\\/]/,
          priority: 10, // æƒé‡æœ€ä½ï¼Œä¼˜å…ˆè€ƒè™‘å‰é¢å†…å®¹
          chunks: "initial",
        },
      },
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"],
  },
  devServer: {
    open: true,
    host: "localhost",
    port: 3000,
    hot: true,
    compress: true,
    historyApiFallback: true,
  },
  mode: isProduction ? "production" : "development",
  devtool: isProduction ? "source-map" : "cheap-module-source-map",
  performance: false, // å…³é—­æ€§èƒ½åˆ†æï¼Œæç¤ºé€Ÿåº¦
};
```

# Vue è„šæ‰‹æ¶

## å¼€å‘æ¨¡å¼é…ç½®

```js
// webpack.dev.js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const { VueLoaderPlugin } = require("vue-loader");
const { DefinePlugin } = require("webpack");
const CopyPlugin = require("copy-webpack-plugin");

const getStyleLoaders = (preProcessor) => {
  return [
    "vue-style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined,
    filename: "static/js/[name].js",
    chunkFilename: "static/js/[name].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      {
        test: /\.(png|jpe?g|gif|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
      },
      {
        test: /\.(jsx|js)$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
          plugins: [
            // "@babel/plugin-transform-runtime" // presetsä¸­åŒ…å«äº†
          ],
        },
      },
      // vue-loaderä¸æ”¯æŒoneOf
      {
        test: /\.vue$/,
        loader: "vue-loader", // å†…éƒ¨ä¼šç»™vueæ–‡ä»¶æ³¨å…¥HMRåŠŸèƒ½ä»£ç 
        options: {
          // å¼€å¯ç¼“å­˜
          cacheDirectory: path.resolve(
            __dirname,
            "node_modules/.cache/vue-loader"
          ),
        },
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true,
          globOptions: {
            ignore: ["**/index.html"],
          },
          info: {
            minimized: true,
          },
        },
      ],
    }),
    new VueLoaderPlugin(),
    // è§£å†³é¡µé¢è­¦å‘Š
    new DefinePlugin({
      __VUE_OPTIONS_API__: "true",
      __VUE_PROD_DEVTOOLS__: "false",
    }),
  ],
  optimization: {
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".vue", ".js", ".json"], // è‡ªåŠ¨è¡¥å…¨æ–‡ä»¶æ‰©å±•åï¼Œè®©vueå¯ä»¥ä½¿ç”¨
  },
  devServer: {
    open: true,
    host: "localhost",
    port: 3000,
    hot: true,
    compress: true,
    historyApiFallback: true, // è§£å†³vue-routeråˆ·æ–°404é—®é¢˜
  },
  mode: "development",
  devtool: "cheap-module-source-map",
};
```

## ç”Ÿäº§æ¨¡å¼é…ç½®

```js
// webpack.prod.js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const { VueLoaderPlugin } = require("vue-loader");
const { DefinePlugin } = require("webpack");

const getStyleLoaders = (preProcessor) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: [
            "postcss-preset-env", // èƒ½è§£å†³å¤§å¤šæ•°æ ·å¼å…¼å®¹æ€§é—®é¢˜
          ],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined,
    filename: "static/js/[name].[contenthash:10].js",
    chunkFilename: "static/js/[name].[contenthash:10].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      {
        test: /\.(png|jpe?g|gif|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
      },
      {
        test: /\.(jsx|js)$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
          plugins: [
            // "@babel/plugin-transform-runtime" // presetsä¸­åŒ…å«äº†
          ],
        },
      },
      // vue-loaderä¸æ”¯æŒoneOf
      {
        test: /\.vue$/,
        loader: "vue-loader", // å†…éƒ¨ä¼šç»™vueæ–‡ä»¶æ³¨å…¥HMRåŠŸèƒ½ä»£ç 
        options: {
          // å¼€å¯ç¼“å­˜
          cacheDirectory: path.resolve(
            __dirname,
            "node_modules/.cache/vue-loader"
          ),
        },
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true,
          globOptions: {
            ignore: ["**/index.html"],
          },
          info: {
            minimized: true,
          },
        },
      ],
    }),
    new MiniCssExtractPlugin({
      filename: "static/css/[name].[contenthash:10].css",
      chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
    }),
    new VueLoaderPlugin(),
    new DefinePlugin({
      __VUE_OPTIONS_API__: "true",
      __VUE_PROD_DEVTOOLS__: "false",
    }),
  ],
  optimization: {
    // å‹ç¼©çš„æ“ä½œ
    minimizer: [
      new CssMinimizerPlugin(),
      new TerserWebpackPlugin(),
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".vue", ".js", ".json"],
  },
  mode: "production",
  devtool: "source-map",
};
```

## å…¶ä»–é…ç½®

- package.json

```json
{
  "name": "vue-cli",
  "version": "1.0.0",
  "description": "",
  "main": "main.js",
  "scripts": {
    "start": "npm run dev",
    "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js",
    "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.prod.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@babel/core": "^7.17.10",
    "@babel/eslint-parser": "^7.17.0",
    "@vue/cli-plugin-babel": "^5.0.4",
    "babel-loader": "^8.2.5",
    "copy-webpack-plugin": "^10.2.4",
    "cross-env": "^7.0.3",
    "css-loader": "^6.7.1",
    "css-minimizer-webpack-plugin": "^3.4.1",
    "eslint-plugin-vue": "^8.7.1",
    "eslint-webpack-plugin": "^3.1.1",
    "html-webpack-plugin": "^5.5.0",
    "image-minimizer-webpack-plugin": "^3.2.3",
    "imagemin": "^8.0.1",
    "imagemin-gifsicle": "^7.0.0",
    "imagemin-jpegtran": "^7.0.0",
    "imagemin-optipng": "^8.0.0",
    "imagemin-svgo": "^10.0.1",
    "less-loader": "^10.2.0",
    "mini-css-extract-plugin": "^2.6.0",
    "postcss-preset-env": "^7.5.0",
    "sass-loader": "^12.6.0",
    "stylus-loader": "^6.2.0",
    "vue-loader": "^17.0.0",
    "vue-style-loader": "^4.1.3",
    "vue-template-compiler": "^2.6.14",
    "webpack": "^5.72.0",
    "webpack-cli": "^4.9.2",
    "webpack-dev-server": "^4.9.0"
  },
  "dependencies": {
    "vue": "^3.2.33",
    "vue-router": "^4.0.15"
  },
  "browserslist": ["last 2 version", "> 1%", "not dead"]
}
```

- .eslintrc.js

```js
module.exports = {
  root: true,
  env: {
    node: true,
  },
  extends: ["plugin:vue/vue3-essential", "eslint:recommended"],
  parserOptions: {
    parser: "@babel/eslint-parser",
  },
};
```

- babel.config.js

```js
module.exports = {
  presets: ["@vue/cli-plugin-babel/preset"],
};
```

## åˆå¹¶å¼€å‘å’Œç”Ÿäº§é…ç½®

```js
// webpack.config.js
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const { VueLoaderPlugin } = require("vue-loader");
const { DefinePlugin } = require("webpack");
const CopyPlugin = require("copy-webpack-plugin");

// éœ€è¦é€šè¿‡ cross-env å®šä¹‰ç¯å¢ƒå˜é‡
const isProduction = process.env.NODE_ENV === "production";

const getStyleLoaders = (preProcessor) => {
  return [
    isProduction ? MiniCssExtractPlugin.loader : "vue-style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: ["postcss-preset-env"],
        },
      },
    },
    preProcessor,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: isProduction ? path.resolve(__dirname, "../dist") : undefined,
    filename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    chunkFilename: isProduction
      ? "static/js/[name].[contenthash:10].chunk.js"
      : "static/js/[name].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      {
        // ç”¨æ¥åŒ¹é… .css ç»“å°¾çš„æ–‡ä»¶
        test: /\.css$/,
        // use æ•°ç»„é‡Œé¢ Loader æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      {
        test: /\.(png|jpe?g|gif|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // å°äº10kbçš„å›¾ç‰‡ä¼šè¢«base64å¤„ç†
          },
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
      },
      {
        test: /\.(jsx|js)$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
          plugins: [
            // "@babel/plugin-transform-runtime" // presetsä¸­åŒ…å«äº†
          ],
        },
      },
      // vue-loaderä¸æ”¯æŒoneOf
      {
        test: /\.vue$/,
        loader: "vue-loader", // å†…éƒ¨ä¼šç»™vueæ–‡ä»¶æ³¨å…¥HMRåŠŸèƒ½ä»£ç 
        options: {
          // å¼€å¯ç¼“å­˜
          cacheDirectory: path.resolve(
            __dirname,
            "node_modules/.cache/vue-loader"
          ),
        },
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true,
          globOptions: {
            ignore: ["**/index.html"],
          },
          info: {
            minimized: true,
          },
        },
      ],
    }),
    isProduction &&
      new MiniCssExtractPlugin({
        filename: "static/css/[name].[contenthash:10].css",
        chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
      }),
    new VueLoaderPlugin(),
    new DefinePlugin({
      __VUE_OPTIONS_API__: "true",
      __VUE_PROD_DEVTOOLS__: "false",
    }),
  ].filter(Boolean),
  optimization: {
    minimize: isProduction,
    // å‹ç¼©çš„æ“ä½œ
    minimizer: [
      new CssMinimizerPlugin(),
      new TerserWebpackPlugin(),
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".vue", ".js", ".json"],
  },
  devServer: {
    open: true,
    host: "localhost",
    port: 3000,
    hot: true,
    compress: true,
    historyApiFallback: true, // è§£å†³vue-routeråˆ·æ–°404é—®é¢˜
  },
  mode: isProduction ? "production" : "development",
  devtool: isProduction ? "source-map" : "cheap-module-source-map",
};
```

## ä¼˜åŒ–é…ç½®

```js{11-13,29-38,151-161,199-229,237-240,252}
const path = require("path");
const ESLintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");
const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const CopyPlugin = require("copy-webpack-plugin");
const { VueLoaderPlugin } = require("vue-loader");
const { DefinePlugin } = require("webpack");
const AutoImport = require("unplugin-auto-import/webpack");
const Components = require("unplugin-vue-components/webpack");
const { ElementPlusResolver } = require("unplugin-vue-components/resolvers");
// éœ€è¦é€šè¿‡ cross-env å®šä¹‰ç¯å¢ƒå˜é‡
const isProduction = process.env.NODE_ENV === "production";

const getStyleLoaders = (preProcessor) => {
  return [
    isProduction ? MiniCssExtractPlugin.loader : "vue-style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: ["postcss-preset-env"],
        },
      },
    },
    preProcessor && {
      loader: preProcessor,
      options:
        preProcessor === "sass-loader"
          ? {
              // è‡ªå®šä¹‰ä¸»é¢˜ï¼šè‡ªåŠ¨å¼•å…¥æˆ‘ä»¬å®šä¹‰çš„scssæ–‡ä»¶
              additionalData: `@use "@/styles/element/index.scss" as *;`,
            }
          : {},
    },
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: isProduction ? path.resolve(__dirname, "../dist") : undefined,
    filename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    chunkFilename: isProduction
      ? "static/js/[name].[contenthash:10].chunk.js"
      : "static/js/[name].chunk.js",
    assetModuleFilename: "static/js/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      {
        test: /\.(png|jpe?g|gif|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024,
          },
        },
      },
      {
        test: /\.(ttf|woff2?)$/,
        type: "asset/resource",
      },
      {
        test: /\.(jsx|js)$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
          plugins: [
            // "@babel/plugin-transform-runtime" // presetsä¸­åŒ…å«äº†
          ],
        },
      },
      // vue-loaderä¸æ”¯æŒoneOf
      {
        test: /\.vue$/,
        loader: "vue-loader", // å†…éƒ¨ä¼šç»™vueæ–‡ä»¶æ³¨å…¥HMRåŠŸèƒ½ä»£ç 
        options: {
          // å¼€å¯ç¼“å­˜
          cacheDirectory: path.resolve(
            __dirname,
            "node_modules/.cache/vue-loader"
          ),
        },
      },
    ],
  },
  plugins: [
    new ESLintWebpackPlugin({
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true,
          globOptions: {
            ignore: ["**/index.html"],
          },
          info: {
            minimized: true,
          },
        },
      ],
    }),
    isProduction &&
      new MiniCssExtractPlugin({
        filename: "static/css/[name].[contenthash:10].css",
        chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
      }),
    new VueLoaderPlugin(),
    new DefinePlugin({
      __VUE_OPTIONS_API__: "true",
      __VUE_PROD_DEVTOOLS__: "false",
    }),
    // æŒ‰éœ€åŠ è½½element-plusç»„ä»¶æ ·å¼
    AutoImport({
      resolvers: [ElementPlusResolver()],
    }),
    Components({
      resolvers: [
        ElementPlusResolver({
          importStyle: "sass", // è‡ªå®šä¹‰ä¸»é¢˜
        }),
      ],
    }),
  ].filter(Boolean),
  optimization: {
    minimize: isProduction,
    // å‹ç¼©çš„æ“ä½œ
    minimizer: [
      new CssMinimizerPlugin(),
      new TerserWebpackPlugin(),
      new ImageMinimizerPlugin({
        minimizer: {
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
    splitChunks: {
      chunks: "all",
      cacheGroups: {
        // layoutsé€šå¸¸æ˜¯adminé¡¹ç›®çš„ä¸»ä½“å¸ƒå±€ç»„ä»¶ï¼Œæ‰€æœ‰è·¯ç”±ç»„ä»¶éƒ½è¦ä½¿ç”¨çš„
        // å¯ä»¥å•ç‹¬æ‰“åŒ…ï¼Œä»è€Œå¤ç”¨
        // å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ï¼Œè¯·åˆ é™¤
        layouts: {
          name: "layouts",
          test: path.resolve(__dirname, "../src/layouts"),
          priority: 40,
        },
        // å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨element-plusï¼Œæ­¤æ—¶å°†æ‰€æœ‰node_modulesæ‰“åŒ…åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆæ‰“åŒ…è¾“å‡ºæ–‡ä»¶ä¼šæ¯”è¾ƒå¤§ã€‚
        // æ‰€ä»¥æˆ‘ä»¬å°†node_modulesä¸­æ¯”è¾ƒå¤§çš„æ¨¡å—å•ç‹¬æ‰“åŒ…ï¼Œä»è€Œå¹¶è¡ŒåŠ è½½é€Ÿåº¦æ›´å¥½
        // å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ï¼Œè¯·åˆ é™¤
        elementUI: {
          name: "chunk-elementPlus",
          test: /[\\/]node_modules[\\/]_?element-plus(.*)/,
          priority: 30,
        },
        // å°†vueç›¸å…³çš„åº“å•ç‹¬æ‰“åŒ…ï¼Œå‡å°‘node_modulesçš„chunkä½“ç§¯ã€‚
        vue: {
          name: "vue",
          test: /[\\/]node_modules[\\/]vue(.*)[\\/]/,
          chunks: "initial",
          priority: 20,
        },
        libs: {
          name: "chunk-libs",
          test: /[\\/]node_modules[\\/]/,
          priority: 10, // æƒé‡æœ€ä½ï¼Œä¼˜å…ˆè€ƒè™‘å‰é¢å†…å®¹
          chunks: "initial",
        },
      },
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".vue", ".js", ".json"],
    alias: {
      // è·¯å¾„åˆ«å
      "@": path.resolve(__dirname, "../src"),
    },
  },
  devServer: {
    open: true,
    host: "localhost",
    port: 3000,
    hot: true,
    compress: true,
    historyApiFallback: true, // è§£å†³vue-routeråˆ·æ–°404é—®é¢˜
  },
  mode: isProduction ? "production" : "development",
  devtool: isProduction ? "source-map" : "cheap-module-source-map",
  performance: false,
};
```

# æ€»ç»“

æœ¬ç« èŠ‚æˆ‘ä»¬å­¦ä¹ åˆ°äº†ï¼š

1. å¦‚ä½•æ­å»º `React-Cli` å’Œ `Vue-Cli`ã€‚
2. å¦‚ä½•å¯¹è„šæ‰‹æ¶è¿›è¡Œä¼˜åŒ–ã€‚
3. æœªæ¥éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œè¿˜å¯ä»¥åœ¨ä¼˜åŒ–çš„æ–¹æ¡ˆã€‚

# ä»‹ç»

æœ¬ç« èŠ‚æˆ‘ä»¬ä¸»è¦å­¦ä¹ ï¼š

- loader åŸç†
- è‡ªå®šä¹‰å¸¸ç”¨ loader
- plugin åŸç†
- è‡ªå®šä¹‰å¸¸ç”¨ plugin

# Loader åŸç†

## loader æ¦‚å¿µ

å¸®åŠ© webpack å°†ä¸åŒç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack å¯è¯†åˆ«çš„æ¨¡å—ã€‚

## loader æ‰§è¡Œé¡ºåº

1. åˆ†ç±»

- preï¼š å‰ç½® loader
- normalï¼š æ™®é€š loader
- inlineï¼š å†…è” loader
- postï¼š åç½® loader

2. æ‰§è¡Œé¡ºåº

- 4 ç±» loader çš„æ‰§è¡Œä¼˜çº§ä¸ºï¼š`pre > normal > inline > post` ã€‚
- ç›¸åŒä¼˜å…ˆçº§çš„ loader æ‰§è¡Œé¡ºåºä¸ºï¼š`ä»å³åˆ°å·¦ï¼Œä»ä¸‹åˆ°ä¸Š`ã€‚

ä¾‹å¦‚ï¼š

```js
// æ­¤æ—¶loaderæ‰§è¡Œé¡ºåºï¼šloader3 - loader2 - loader1
module: {
  rules: [
    {
      test: /\.js$/,
      loader: "loader1",
    },
    {
      test: /\.js$/,
      loader: "loader2",
    },
    {
      test: /\.js$/,
      loader: "loader3",
    },
  ],
},
```

```js
// æ­¤æ—¶loaderæ‰§è¡Œé¡ºåºï¼šloader1 - loader2 - loader3
module: {
  rules: [
    {
      enforce: "pre",
      test: /\.js$/,
      loader: "loader1",
    },
    {
      // æ²¡æœ‰enforceå°±æ˜¯normal
      test: /\.js$/,
      loader: "loader2",
    },
    {
      enforce: "post",
      test: /\.js$/,
      loader: "loader3",
    },
  ],
},
```

3. ä½¿ç”¨ loader çš„æ–¹å¼

- é…ç½®æ–¹å¼ï¼šåœ¨ `webpack.config.js` æ–‡ä»¶ä¸­æŒ‡å®š loaderã€‚ï¼ˆpreã€normalã€post loaderï¼‰
- å†…è”æ–¹å¼ï¼šåœ¨æ¯ä¸ª `import` è¯­å¥ä¸­æ˜¾å¼æŒ‡å®š loaderã€‚ï¼ˆinline loaderï¼‰

4. inline loader

ç”¨æ³•ï¼š`import Styles from 'style-loader!css-loader?modules!./styles.css';`

å«ä¹‰ï¼š

- ä½¿ç”¨ `css-loader` å’Œ `style-loader` å¤„ç† `styles.css` æ–‡ä»¶
- é€šè¿‡ `!` å°†èµ„æºä¸­çš„ loader åˆ†å¼€

`inline loader` å¯ä»¥é€šè¿‡æ·»åŠ ä¸åŒå‰ç¼€ï¼Œè·³è¿‡å…¶ä»–ç±»å‹ loaderã€‚

- `!` è·³è¿‡ normal loaderã€‚

`import Styles from '!style-loader!css-loader?modules!./styles.css';`

- `-!` è·³è¿‡ pre å’Œ normal loaderã€‚

`import Styles from '-!style-loader!css-loader?modules!./styles.css';`

- `!!` è·³è¿‡ preã€ normal å’Œ post loaderã€‚

`import Styles from '!!style-loader!css-loader?modules!./styles.css';`

## å¼€å‘ä¸€ä¸ª loader

### 1. æœ€ç®€å•çš„ loader

```js
// loaders/loader1.js
module.exports = function loader1(content) {
  console.log("hello loader");
  return content;
};
```

å®ƒæ¥å—è¦å¤„ç†çš„æºç ä½œä¸ºå‚æ•°ï¼Œè¾“å‡ºè½¬æ¢åçš„ js ä»£ç ã€‚

### 2. loader æ¥å—çš„å‚æ•°

- `content` æºæ–‡ä»¶çš„å†…å®¹
- `map` SourceMap æ•°æ®
- `meta` æ•°æ®ï¼Œå¯ä»¥æ˜¯ä»»ä½•å†…å®¹

## loader åˆ†ç±»

### 1. åŒæ­¥ loader

```js
module.exports = function (content, map, meta) {
  return content;
};
```

`this.callback` æ–¹æ³•åˆ™æ›´çµæ´»ï¼Œå› ä¸ºå®ƒå…è®¸ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯ `content`ã€‚

```js
module.exports = function (content, map, meta) {
  // ä¼ é€’mapï¼Œè®©source-mapä¸ä¸­æ–­
  // ä¼ é€’metaï¼Œè®©ä¸‹ä¸€ä¸ªloaderæ¥æ”¶åˆ°å…¶ä»–å‚æ•°
  this.callback(null, content, map, meta);
  return; // å½“è°ƒç”¨ callback() å‡½æ•°æ—¶ï¼Œæ€»æ˜¯è¿”å› undefined
};
```

### 2. å¼‚æ­¥ loader

```js
module.exports = function (content, map, meta) {
  const callback = this.async();
  // è¿›è¡Œå¼‚æ­¥æ“ä½œ
  setTimeout(() => {
    callback(null, result, map, meta);
  }, 1000);
};
```

> ç”±äºåŒæ­¥è®¡ç®—è¿‡äºè€—æ—¶ï¼Œåœ¨ Node.js è¿™æ ·çš„å•çº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡Œæ­¤æ“ä½œå¹¶ä¸æ˜¯å¥½çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬å»ºè®®å°½å¯èƒ½åœ°ä½¿ä½ çš„ loader å¼‚æ­¥åŒ–ã€‚ä½†å¦‚æœè®¡ç®—é‡å¾ˆå°ï¼ŒåŒæ­¥ loader ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

### 3. Raw Loader

é»˜è®¤æƒ…å†µä¸‹ï¼Œèµ„æºæ–‡ä»¶ä¼šè¢«è½¬åŒ–ä¸º UTF-8 å­—ç¬¦ä¸²ï¼Œç„¶åä¼ ç»™ loaderã€‚é€šè¿‡è®¾ç½® raw ä¸º trueï¼Œloader å¯ä»¥æ¥æ”¶åŸå§‹çš„ Bufferã€‚

```js
module.exports = function (content) {
  // contentæ˜¯ä¸€ä¸ªBufferæ•°æ®
  return content;
};
module.exports.raw = true; // å¼€å¯ Raw Loader
```

### 4. Pitching Loader

```js
module.exports = function (content) {
  return content;
};
module.exports.pitch = function (remainingRequest, precedingRequest, data) {
  console.log("do somethings");
};
```

webpack ä¼šå…ˆä»å·¦åˆ°å³æ‰§è¡Œ loader é“¾ä¸­çš„æ¯ä¸ª loader ä¸Šçš„ pitch æ–¹æ³•ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œç„¶åå†ä»å³åˆ°å·¦æ‰§è¡Œ loader é“¾ä¸­çš„æ¯ä¸ª loader ä¸Šçš„æ™®é€š loader æ–¹æ³•ã€‚

![loaderæ‰§è¡Œæµç¨‹](/imgs/source/loader1.png)

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœä»»ä½• pitch æœ‰è¿”å›å€¼ï¼Œåˆ™ loader é“¾è¢«é˜»æ–­ã€‚webpack ä¼šè·³è¿‡åé¢æ‰€æœ‰çš„çš„ pitch å’Œ loaderï¼Œç›´æ¥è¿›å…¥ä¸Šä¸€ä¸ª loader ã€‚

![loaderæ‰§è¡Œæµç¨‹](/imgs/source/loader2.png)

## loader API

| æ–¹æ³•å                  | å«ä¹‰                                       | ç”¨æ³•                                           |
| ----------------------- | ------------------------------------------ | ---------------------------------------------- |
| this.async              | å¼‚æ­¥å›è°ƒ loaderã€‚è¿”å› this.callback        | const callback = this.async()                  |
| this.callback           | å¯ä»¥åŒæ­¥æˆ–è€…å¼‚æ­¥è°ƒç”¨çš„å¹¶è¿”å›å¤šä¸ªç»“æœçš„å‡½æ•° | this.callback(err, content, sourceMap?, meta?) |
| this.getOptions(schema) | è·å– loader çš„ options                     | this.getOptions(schema)                        |
| this.emitFile           | äº§ç”Ÿä¸€ä¸ªæ–‡ä»¶                               | this.emitFile(name, content, sourceMap)        |
| this.utils.contextify   | è¿”å›ä¸€ä¸ªç›¸å¯¹è·¯å¾„                           | this.utils.contextify(context, request)        |
| this.utils.absolutify   | è¿”å›ä¸€ä¸ªç»å¯¹è·¯å¾„                           | this.utils.absolutify(context, request)        |

> æ›´å¤šæ–‡æ¡£ï¼Œè¯·æŸ¥é˜… [webpack å®˜æ–¹ loader api æ–‡æ¡£](https://webpack.docschina.org/api/loaders/#the-loader-context)

## æ‰‹å†™ clean-log-loader

ä½œç”¨ï¼šç”¨æ¥æ¸…ç† js ä»£ç ä¸­çš„`console.log`

```js
// loaders/clean-log-loader.js
module.exports = function cleanLogLoader(content) {
  // å°†console.logæ›¿æ¢ä¸ºç©º
  return content.replace(/console\.log\(.*\);?/g, "");
};
```

## æ‰‹å†™ banner-loader

ä½œç”¨ï¼šç»™ js ä»£ç æ·»åŠ æ–‡æœ¬æ³¨é‡Š

- loaders/banner-loader/index.js

```js
const schema = require("./schema.json");

module.exports = function (content) {
  // è·å–loaderçš„optionsï¼ŒåŒæ—¶å¯¹optionså†…å®¹è¿›è¡Œæ ¡éªŒ
  // schemaæ˜¯optionsçš„æ ¡éªŒè§„åˆ™ï¼ˆç¬¦åˆ JSON schema è§„åˆ™ï¼‰
  const options = this.getOptions(schema);

  const prefix = `
    /*
    * Author: ${options.author}
    */
  `;

  return `${prefix} \n ${content}`;
};
```

- loaders/banner-loader/schema.json

```json
{
  "type": "object",
  "properties": {
    "author": {
      "type": "string"
    }
  },
  "additionalProperties": false
}
```

## æ‰‹å†™ babel-loader

ä½œç”¨ï¼šç¼–è¯‘ js ä»£ç ï¼Œå°† ES6+è¯­æ³•ç¼–è¯‘æˆ ES5-è¯­æ³•ã€‚

- ä¸‹è½½ä¾èµ–

```
npm i @babel/core @babel/preset-env -D
```

- loaders/babel-loader/index.js

```js
const schema = require("./schema.json");
const babel = require("@babel/core");

module.exports = function (content) {
  const options = this.getOptions(schema);
  // ä½¿ç”¨å¼‚æ­¥loader
  const callback = this.async();
  // ä½¿ç”¨babelå¯¹jsä»£ç è¿›è¡Œç¼–è¯‘
  babel.transform(content, options, function (err, result) {
    callback(err, result.code);
  });
};
```

- loaders/banner-loader/schema.json

```json
{
  "type": "object",
  "properties": {
    "presets": {
      "type": "array"
    }
  },
  "additionalProperties": true
}
```

## æ‰‹å†™ file-loader

ä½œç”¨ï¼šå°†æ–‡ä»¶åŸå°ä¸åŠ¨è¾“å‡ºå‡ºå»

- ä¸‹è½½åŒ…

```
npm i loader-utils -D
```

- loaders/file-loader.js

```js
const loaderUtils = require("loader-utils");

function fileLoader(content) {
  // æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿäº§ä¸€ä¸ªæ–°çš„æ–‡ä»¶åç§°
  const filename = loaderUtils.interpolateName(this, "[hash].[ext]", {
    content,
  });
  // è¾“å‡ºæ–‡ä»¶
  this.emitFile(filename, content);
  // æš´éœ²å‡ºå»ï¼Œç»™jså¼•ç”¨ã€‚
  // è®°å¾—åŠ ä¸Š''
  return `export default '${filename}'`;
}

// loader è§£å†³çš„æ˜¯äºŒè¿›åˆ¶çš„å†…å®¹
// å›¾ç‰‡æ˜¯ Buffer æ•°æ®
fileLoader.raw = true;

module.exports = fileLoader;
```

- loader é…ç½®

```js
{
  test: /\.(png|jpe?g|gif)$/,
  loader: "./loaders/file-loader.js",
  type: "javascript/auto", // è§£å†³å›¾ç‰‡é‡å¤æ‰“åŒ…é—®é¢˜
},
```

## æ‰‹å†™ style-loader

ä½œç”¨ï¼šåŠ¨æ€åˆ›å»º style æ ‡ç­¾ï¼Œæ’å…¥ js ä¸­çš„æ ·å¼ä»£ç ï¼Œä½¿æ ·å¼ç”Ÿæ•ˆã€‚

- loaders/style-loader.js

```js
const styleLoader = () => {};

styleLoader.pitch = function (remainingRequest) {
  /*
    remainingRequest: C:\Users\86176\Desktop\source\node_modules\css-loader\dist\cjs.js!C:\Users\86176\Desktop\source\src\css\index.css
      è¿™é‡Œæ˜¯inline loaderç”¨æ³•ï¼Œä»£è¡¨åé¢è¿˜æœ‰ä¸€ä¸ªcss-loaderç­‰å¾…å¤„ç†

    æœ€ç»ˆæˆ‘ä»¬éœ€è¦å°†remainingRequestä¸­çš„è·¯å¾„è½¬åŒ–æˆç›¸å¯¹è·¯å¾„ï¼Œwebpackæ‰èƒ½å¤„ç†
      å¸Œæœ›å¾—åˆ°ï¼š../../node_modules/css-loader/dist/cjs.js!./index.css

    æ‰€ä»¥ï¼šéœ€è¦å°†ç»å¯¹è·¯å¾„è½¬åŒ–æˆç›¸å¯¹è·¯å¾„
    è¦æ±‚ï¼š
      1. å¿…é¡»æ˜¯ç›¸å¯¹è·¯å¾„
      2. ç›¸å¯¹è·¯å¾„å¿…é¡»ä»¥ ./ æˆ– ../ å¼€å¤´
      3. ç›¸å¯¹è·¯å¾„çš„è·¯å¾„åˆ†éš”ç¬¦å¿…é¡»æ˜¯ / ï¼Œä¸èƒ½æ˜¯ \
  */
  const relativeRequest = remainingRequest
    .split("!")
    .map((part) => {
      // å°†è·¯å¾„è½¬åŒ–ä¸ºç›¸å¯¹è·¯å¾„
      const relativePath = this.utils.contextify(this.context, part);
      return relativePath;
    })
    .join("!");

  /*
    !!${relativeRequest} 
      relativeRequestï¼š../../node_modules/css-loader/dist/cjs.js!./index.css
      relativeRequestæ˜¯inline loaderç”¨æ³•ï¼Œä»£è¡¨è¦å¤„ç†çš„index.cssèµ„æº, ä½¿ç”¨css-loaderå¤„ç†
      !!ä»£è¡¨ç¦ç”¨æ‰€æœ‰é…ç½®çš„loaderï¼Œåªä½¿ç”¨inline loaderã€‚ï¼ˆä¹Ÿå°±æ˜¯å¤–é¢æˆ‘ä»¬style-loaderå’Œcss-loaderï¼‰,å®ƒä»¬è¢«ç¦ç”¨äº†ï¼Œåªæ˜¯ç”¨æˆ‘ä»¬æŒ‡å®šçš„inline loaderï¼Œä¹Ÿå°±æ˜¯css-loader

    import style from "!!${relativeRequest}"
      å¼•å…¥css-loaderå¤„ç†åçš„cssæ–‡ä»¶
      ä¸ºä»€ä¹ˆéœ€è¦css-loaderå¤„ç†cssæ–‡ä»¶ï¼Œä¸æ˜¯æˆ‘ä»¬ç›´æ¥è¯»å–cssæ–‡ä»¶ä½¿ç”¨å‘¢ï¼Ÿ
      å› ä¸ºå¯èƒ½å­˜åœ¨@importå¯¼å…¥cssè¯­æ³•ï¼Œè¿™äº›è¯­æ³•å°±è¦é€šè¿‡css-loaderè§£ææ‰èƒ½å˜æˆä¸€ä¸ªcssæ–‡ä»¶ï¼Œå¦åˆ™æˆ‘ä»¬å¼•å…¥çš„cssèµ„æºä¼šç¼ºå°‘
    const styleEl = document.createElement('style')
      åŠ¨æ€åˆ›å»ºstyleæ ‡ç­¾
    styleEl.innerHTML = style
      å°†styleæ ‡ç­¾å†…å®¹è®¾ç½®ä¸ºå¤„ç†åçš„cssä»£ç 
    document.head.appendChild(styleEl)
      æ·»åŠ åˆ°headä¸­ç”Ÿæ•ˆ
  */
  const script = `
    import style from "!!${relativeRequest}"
    const styleEl = document.createElement('style')
    styleEl.innerHTML = style
    document.head.appendChild(styleEl)
  `;

  // style-loaderæ˜¯ç¬¬ä¸€ä¸ªloader, ç”±äºreturnå¯¼è‡´ç†”æ–­ï¼Œæ‰€ä»¥å…¶ä»–loaderä¸æ‰§è¡Œäº†ï¼ˆä¸ç®¡æ˜¯normalè¿˜æ˜¯pitchï¼‰
  return script;
};

module.exports = styleLoader;
```

# Plugin åŸç†

## Plugin çš„ä½œç”¨

é€šè¿‡æ’ä»¶æˆ‘ä»¬å¯ä»¥æ‰©å±• webpackï¼ŒåŠ å…¥è‡ªå®šä¹‰çš„æ„å»ºè¡Œä¸ºï¼Œä½¿ webpack å¯ä»¥æ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡ï¼Œæ‹¥æœ‰æ›´å¼ºçš„æ„å»ºèƒ½åŠ›ã€‚

## Plugin å·¥ä½œåŸç†

> webpack å°±åƒä¸€æ¡ç”Ÿäº§çº¿ï¼Œè¦ç»è¿‡ä¸€ç³»åˆ—å¤„ç†æµç¨‹åæ‰èƒ½å°†æºæ–‡ä»¶è½¬æ¢æˆè¾“å‡ºç»“æœã€‚ è¿™æ¡ç”Ÿäº§çº¿ä¸Šçš„æ¯ä¸ªå¤„ç†æµç¨‹çš„èŒè´£éƒ½æ˜¯å•ä¸€çš„ï¼Œå¤šä¸ªæµç¨‹ä¹‹é—´æœ‰å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåªæœ‰å®Œæˆå½“å‰å¤„ç†åæ‰èƒ½äº¤ç»™ä¸‹ä¸€ä¸ªæµç¨‹å»å¤„ç†ã€‚
> æ’ä»¶å°±åƒæ˜¯ä¸€ä¸ªæ’å…¥åˆ°ç”Ÿäº§çº¿ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨ç‰¹å®šçš„æ—¶æœºå¯¹ç”Ÿäº§çº¿ä¸Šçš„èµ„æºåšå¤„ç†ã€‚webpack é€šè¿‡ Tapable æ¥ç»„ç»‡è¿™æ¡å¤æ‚çš„ç”Ÿäº§çº¿ã€‚ webpack åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­äº‹ä»¶ï¼Œæ’ä»¶åªéœ€è¦ç›‘å¬å®ƒæ‰€å…³å¿ƒçš„äº‹ä»¶ï¼Œå°±èƒ½åŠ å…¥åˆ°è¿™æ¡ç”Ÿäº§çº¿ä¸­ï¼Œå»æ”¹å˜ç”Ÿäº§çº¿çš„è¿ä½œã€‚
> webpack çš„äº‹ä»¶æµæœºåˆ¶ä¿è¯äº†æ’ä»¶çš„æœ‰åºæ€§ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿæ‰©å±•æ€§å¾ˆå¥½ã€‚
> â€”â€”ã€Œæ·±å…¥æµ…å‡º Webpackã€

ç«™åœ¨ä»£ç é€»è¾‘çš„è§’åº¦å°±æ˜¯ï¼šwebpack åœ¨ç¼–è¯‘ä»£ç è¿‡ç¨‹ä¸­ï¼Œä¼šè§¦å‘ä¸€ç³»åˆ— `Tapable` é’©å­äº‹ä»¶ï¼Œæ’ä»¶æ‰€åšçš„ï¼Œå°±æ˜¯æ‰¾åˆ°ç›¸åº”çš„é’©å­ï¼Œå¾€ä¸Šé¢æŒ‚ä¸Šè‡ªå·±çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æ³¨å†Œäº‹ä»¶ï¼Œè¿™æ ·ï¼Œå½“ webpack æ„å»ºçš„æ—¶å€™ï¼Œæ’ä»¶æ³¨å†Œçš„äº‹ä»¶å°±ä¼šéšç€é’©å­çš„è§¦å‘è€Œæ‰§è¡Œäº†ã€‚

## Webpack å†…éƒ¨çš„é’©å­

### ä»€ä¹ˆæ˜¯é’©å­

é’©å­çš„æœ¬è´¨å°±æ˜¯ï¼šäº‹ä»¶ã€‚ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ç›´æ¥ä»‹å…¥å’Œæ§åˆ¶ç¼–è¯‘è¿‡ç¨‹ï¼Œwebpack æŠŠç¼–è¯‘è¿‡ç¨‹ä¸­è§¦å‘çš„å„ç±»å…³é”®äº‹ä»¶å°è£…æˆäº‹ä»¶æ¥å£æš´éœ²äº†å‡ºæ¥ã€‚è¿™äº›æ¥å£è¢«å¾ˆå½¢è±¡åœ°ç§°åšï¼š`hooks`ï¼ˆé’©å­ï¼‰ã€‚å¼€å‘æ’ä»¶ï¼Œç¦»ä¸å¼€è¿™äº›é’©å­ã€‚

### Tapable

`Tapable` ä¸º webpack æä¾›äº†ç»Ÿä¸€çš„æ’ä»¶æ¥å£ï¼ˆé’©å­ï¼‰ç±»å‹å®šä¹‰ï¼Œå®ƒæ˜¯ webpack çš„æ ¸å¿ƒåŠŸèƒ½åº“ã€‚webpack ä¸­ç›®å‰æœ‰åç§ `hooks`ï¼Œåœ¨ `Tapable` æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä»–ä»¬æ˜¯ï¼š

```js
// https://github.com/webpack/tapable/blob/master/lib/index.js
exports.SyncHook = require("./SyncHook");
exports.SyncBailHook = require("./SyncBailHook");
exports.SyncWaterfallHook = require("./SyncWaterfallHook");
exports.SyncLoopHook = require("./SyncLoopHook");
exports.AsyncParallelHook = require("./AsyncParallelHook");
exports.AsyncParallelBailHook = require("./AsyncParallelBailHook");
exports.AsyncSeriesHook = require("./AsyncSeriesHook");
exports.AsyncSeriesBailHook = require("./AsyncSeriesBailHook");
exports.AsyncSeriesLoopHook = require("./AsyncSeriesLoopHook");
exports.AsyncSeriesWaterfallHook = require("./AsyncSeriesWaterfallHook");
exports.HookMap = require("./HookMap");
exports.MultiHook = require("./MultiHook");
```

`Tapable` è¿˜ç»Ÿä¸€æš´éœ²äº†ä¸‰ä¸ªæ–¹æ³•ç»™æ’ä»¶ï¼Œç”¨äºæ³¨å…¥ä¸åŒç±»å‹çš„è‡ªå®šä¹‰æ„å»ºè¡Œä¸ºï¼š

- `tap`ï¼šå¯ä»¥æ³¨å†ŒåŒæ­¥é’©å­å’Œå¼‚æ­¥é’©å­ã€‚
- `tapAsync`ï¼šå›è°ƒæ–¹å¼æ³¨å†Œå¼‚æ­¥é’©å­ã€‚
- `tapPromise`ï¼šPromise æ–¹å¼æ³¨å†Œå¼‚æ­¥é’©å­ã€‚

## Plugin æ„å»ºå¯¹è±¡

### Compiler

compiler å¯¹è±¡ä¸­ä¿å­˜ç€å®Œæ•´çš„ Webpack ç¯å¢ƒé…ç½®ï¼Œæ¯æ¬¡å¯åŠ¨ webpack æ„å»ºæ—¶å®ƒéƒ½æ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒï¼Œä»…ä»…ä¼šåˆ›å»ºä¸€æ¬¡çš„å¯¹è±¡ã€‚

è¿™ä¸ªå¯¹è±¡ä¼šåœ¨é¦–æ¬¡å¯åŠ¨ Webpack æ—¶åˆ›å»ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ compiler å¯¹è±¡ä¸Šè®¿é—®åˆ° Webapck çš„ä¸»ç¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚ loader ã€ plugin ç­‰ç­‰é…ç½®ä¿¡æ¯ã€‚

å®ƒæœ‰ä»¥ä¸‹ä¸»è¦å±æ€§ï¼š

- `compiler.options` å¯ä»¥è®¿é—®æœ¬æ¬¡å¯åŠ¨ webpack æ—¶å€™æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº loaders ã€ entry ã€ output ã€ plugin ç­‰ç­‰å®Œæ•´é…ç½®ä¿¡æ¯ã€‚
- `compiler.inputFileSystem` å’Œ `compiler.outputFileSystem` å¯ä»¥è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œç›¸å½“äº Nodejs ä¸­ fsã€‚
- `compiler.hooks` å¯ä»¥æ³¨å†Œ tapable çš„ä¸åŒç§ç±» Hookï¼Œä»è€Œå¯ä»¥åœ¨ compiler ç”Ÿå‘½å‘¨æœŸä¸­æ¤å…¥ä¸åŒçš„é€»è¾‘ã€‚

> [compiler hooks æ–‡æ¡£](https://webpack.docschina.org/api/compiler-hooks/)

### Compilation

compilation å¯¹è±¡ä»£è¡¨ä¸€æ¬¡èµ„æºçš„æ„å»ºï¼Œcompilation å®ä¾‹èƒ½å¤Ÿè®¿é—®æ‰€æœ‰çš„æ¨¡å—å’Œå®ƒä»¬çš„ä¾èµ–ã€‚

ä¸€ä¸ª compilation å¯¹è±¡ä¼šå¯¹æ„å»ºä¾èµ–å›¾ä¸­æ‰€æœ‰æ¨¡å—ï¼Œè¿›è¡Œç¼–è¯‘ã€‚ åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ¨¡å—ä¼šè¢«åŠ è½½(load)ã€å°å­˜(seal)ã€ä¼˜åŒ–(optimize)ã€ åˆ†å—(chunk)ã€å“ˆå¸Œ(hash)å’Œé‡æ–°åˆ›å»º(restore)ã€‚

å®ƒæœ‰ä»¥ä¸‹ä¸»è¦å±æ€§ï¼š

- `compilation.modules` å¯ä»¥è®¿é—®æ‰€æœ‰æ¨¡å—ï¼Œæ‰“åŒ…çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚
- `compilation.chunks` chunk å³æ˜¯å¤šä¸ª modules ç»„æˆè€Œæ¥çš„ä¸€ä¸ªä»£ç å—ã€‚å…¥å£æ–‡ä»¶å¼•å…¥çš„èµ„æºç»„æˆä¸€ä¸ª chunkï¼Œé€šè¿‡ä»£ç åˆ†å‰²çš„æ¨¡å—åˆæ˜¯å¦å¤–çš„ chunkã€‚
- `compilation.assets` å¯ä»¥è®¿é—®æœ¬æ¬¡æ‰“åŒ…ç”Ÿæˆæ‰€æœ‰æ–‡ä»¶çš„ç»“æœã€‚
- `compilation.hooks` å¯ä»¥æ³¨å†Œ tapable çš„ä¸åŒç§ç±» Hookï¼Œç”¨äºåœ¨ compilation ç¼–è¯‘æ¨¡å—é˜¶æ®µè¿›è¡Œé€»è¾‘æ·»åŠ ä»¥åŠä¿®æ”¹ã€‚

> [compilation hooks æ–‡æ¡£](https://webpack.docschina.org/api/compilation-hooks/)

### ç”Ÿå‘½å‘¨æœŸç®€å›¾

![Webpack æ’ä»¶ç”Ÿå‘½å‘¨æœŸ](/imgs/source/plugin.jpg)

## å¼€å‘ä¸€ä¸ªæ’ä»¶

### æœ€ç®€å•çš„æ’ä»¶

- plugins/test-plugin.js

```js
class TestPlugin {
  constructor() {
    console.log("TestPlugin constructor()");
  }
  // 1. webpackè¯»å–é…ç½®æ—¶ï¼Œnew TestPlugin() ï¼Œä¼šæ‰§è¡Œæ’ä»¶ constructor æ–¹æ³•
  // 2. webpackåˆ›å»º compiler å¯¹è±¡
  // 3. éå†æ‰€æœ‰æ’ä»¶ï¼Œè°ƒç”¨æ’ä»¶çš„ apply æ–¹æ³•
  apply(compiler) {
    console.log("TestPlugin apply()");
  }
}

module.exports = TestPlugin;
```

### æ³¨å†Œ hook

```js
class TestPlugin {
  constructor() {
    console.log("TestPlugin constructor()");
  }
  // 1. webpackè¯»å–é…ç½®æ—¶ï¼Œnew TestPlugin() ï¼Œä¼šæ‰§è¡Œæ’ä»¶ constructor æ–¹æ³•
  // 2. webpackåˆ›å»º compiler å¯¹è±¡
  // 3. éå†æ‰€æœ‰æ’ä»¶ï¼Œè°ƒç”¨æ’ä»¶çš„ apply æ–¹æ³•
  apply(compiler) {
    console.log("TestPlugin apply()");

    // ä»æ–‡æ¡£å¯çŸ¥, compile hook æ˜¯ SyncHook, ä¹Ÿå°±æ˜¯åŒæ­¥é’©å­, åªèƒ½ç”¨tapæ³¨å†Œ
    compiler.hooks.compile.tap("TestPlugin", (compilationParams) => {
      console.log("compiler.compile()");
    });

    // ä»æ–‡æ¡£å¯çŸ¥, make æ˜¯ AsyncParallelHook, ä¹Ÿå°±æ˜¯å¼‚æ­¥å¹¶è¡Œé’©å­, ç‰¹ç‚¹å°±æ˜¯å¼‚æ­¥ä»»åŠ¡åŒæ—¶æ‰§è¡Œ
    // å¯ä»¥ä½¿ç”¨ tapã€tapAsyncã€tapPromise æ³¨å†Œã€‚
    // å¦‚æœä½¿ç”¨tapæ³¨å†Œçš„è¯ï¼Œè¿›è¡Œå¼‚æ­¥æ“ä½œæ˜¯ä¸ä¼šç­‰å¾…å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæˆçš„ã€‚
    compiler.hooks.make.tap("TestPlugin", (compilation) => {
      setTimeout(() => {
        console.log("compiler.make() 111");
      }, 2000);
    });

    // ä½¿ç”¨tapAsyncã€tapPromiseæ³¨å†Œï¼Œè¿›è¡Œå¼‚æ­¥æ“ä½œä¼šç­‰å¼‚æ­¥æ“ä½œåšå®Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ
    compiler.hooks.make.tapAsync("TestPlugin", (compilation, callback) => {
      setTimeout(() => {
        console.log("compiler.make() 222");
        // å¿…é¡»è°ƒç”¨
        callback();
      }, 1000);
    });

    compiler.hooks.make.tapPromise("TestPlugin", (compilation) => {
      console.log("compiler.make() 333");
      // å¿…é¡»è¿”å›promise
      return new Promise((resolve) => {
        resolve();
      });
    });

    // ä»æ–‡æ¡£å¯çŸ¥, emit æ˜¯ AsyncSeriesHook, ä¹Ÿå°±æ˜¯å¼‚æ­¥ä¸²è¡Œé’©å­ï¼Œç‰¹ç‚¹å°±æ˜¯å¼‚æ­¥ä»»åŠ¡é¡ºåºæ‰§è¡Œ
    compiler.hooks.emit.tapAsync("TestPlugin", (compilation, callback) => {
      setTimeout(() => {
        console.log("compiler.emit() 111");
        callback();
      }, 3000);
    });

    compiler.hooks.emit.tapAsync("TestPlugin", (compilation, callback) => {
      setTimeout(() => {
        console.log("compiler.emit() 222");
        callback();
      }, 2000);
    });

    compiler.hooks.emit.tapAsync("TestPlugin", (compilation, callback) => {
      setTimeout(() => {
        console.log("compiler.emit() 333");
        callback();
      }, 1000);
    });
  }
}

module.exports = TestPlugin;
```

### å¯åŠ¨è°ƒè¯•

é€šè¿‡è°ƒè¯•æŸ¥çœ‹ `compiler` å’Œ `compilation` å¯¹è±¡æ•°æ®æƒ…å†µã€‚

1. package.json é…ç½®æŒ‡ä»¤

```json{5}
{
  "name": "source",
  "version": "1.0.0",
  "scripts": {
    "debug": "node --inspect-brk ./node_modules/webpack-cli/bin/cli.js"
  },
  "keywords": [],
  "author": "xiongjian",
  "license": "ISC",
  "devDependencies": {
    "@babel/core": "^7.17.10",
    "@babel/preset-env": "^7.17.10",
    "css-loader": "^6.7.1",
    "loader-utils": "^3.2.0",
    "webpack": "^5.72.0",
    "webpack-cli": "^4.9.2"
  }
}
```

2. è¿è¡ŒæŒ‡ä»¤

```
npm run debug
```

æ­¤æ—¶æ§åˆ¶å°è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š

```
PS C:\Users\86176\Desktop\source> npm run debug

> source@1.0.0 debug
> node --inspect-brk ./node_modules/webpack-cli/bin/cli.js

Debugger listening on ws://127.0.0.1:9229/629ea097-7b52-4011-93a7-02f83c75c797
For help, see: https://nodejs.org/en/docs/inspecto
```

3. æ‰“å¼€ Chrome æµè§ˆå™¨ï¼ŒF12 æ‰“å¼€æµè§ˆå™¨è°ƒè¯•æ§åˆ¶å°ã€‚

æ­¤æ—¶æ§åˆ¶å°ä¼šæ˜¾ç¤ºä¸€ä¸ªç»¿è‰²çš„å›¾æ ‡

![è°ƒè¯•æ§åˆ¶å°](/imgs/source/debug.png)

4. ç‚¹å‡»ç»¿è‰²çš„å›¾æ ‡è¿›å…¥è°ƒè¯•æ¨¡å¼ã€‚

5. åœ¨éœ€è¦è°ƒè¯•ä»£ç å¤„ç”¨ `debugger` æ‰“æ–­ç‚¹ï¼Œä»£ç å°±ä¼šåœæ­¢è¿è¡Œï¼Œä»è€Œè°ƒè¯•æŸ¥çœ‹æ•°æ®æƒ…å†µã€‚

## BannerWebpackPlugin

1. ä½œç”¨ï¼šç»™æ‰“åŒ…è¾“å‡ºæ–‡ä»¶æ·»åŠ æ³¨é‡Šã€‚

2. å¼€å‘æ€è·¯:

- éœ€è¦æ‰“åŒ…è¾“å‡ºå‰æ·»åŠ æ³¨é‡Šï¼šéœ€è¦ä½¿ç”¨ `compiler.hooks.emit` é’©å­, å®ƒæ˜¯æ‰“åŒ…è¾“å‡ºå‰è§¦å‘ã€‚
- å¦‚ä½•è·å–æ‰“åŒ…è¾“å‡ºçš„èµ„æºï¼Ÿ`compilation.assets` å¯ä»¥è·å–æ‰€æœ‰å³å°†è¾“å‡ºçš„èµ„æºæ–‡ä»¶ã€‚

3. å®ç°ï¼š

```js
// plugins/banner-webpack-plugin.js
class BannerWebpackPlugin {
  constructor(options = {}) {
    this.options = options;
  }

  apply(compiler) {
    // éœ€è¦å¤„ç†æ–‡ä»¶
    const extensions = ["js", "css"];

    // emitæ˜¯å¼‚æ­¥ä¸²è¡Œé’©å­
    compiler.hooks.emit.tapAsync("BannerWebpackPlugin", (compilation, callback) => {
      // compilation.assetsåŒ…å«æ‰€æœ‰å³å°†è¾“å‡ºçš„èµ„æº
      // é€šè¿‡è¿‡æ»¤åªä¿ç•™éœ€è¦å¤„ç†çš„æ–‡ä»¶
      const assetPaths = Object.keys(compilation.assets).filter((path) => {
        const splitted = path.split(".");
        return extensions.includes(splitted[splitted.length - 1]);
      });

      assetPaths.forEach((assetPath) => {
        const asset = compilation.assets[assetPath];

        const source = `/*
* Author: ${this.options.author}
*/\n${asset.source()}`;

        // è¦†ç›–èµ„æº
        compilation.assets[assetPath] = {
          // èµ„æºå†…å®¹
          source() {
            return source;
          },
          // èµ„æºå¤§å°
          size() {
            return source.length;
          },
        };
      });

      callback();
    });
  }
}

module.exports = BannerWebpackPlugin;
```

## CleanWebpackPlugin

1. ä½œç”¨ï¼šåœ¨ webpack æ‰“åŒ…è¾“å‡ºå‰å°†ä¸Šæ¬¡æ‰“åŒ…å†…å®¹æ¸…ç©ºã€‚

2. å¼€å‘æ€è·¯ï¼š

- å¦‚ä½•åœ¨æ‰“åŒ…è¾“å‡ºå‰æ‰§è¡Œï¼Ÿéœ€è¦ä½¿ç”¨ `compiler.hooks.emit` é’©å­, å®ƒæ˜¯æ‰“åŒ…è¾“å‡ºå‰è§¦å‘ã€‚
- å¦‚ä½•æ¸…ç©ºä¸Šæ¬¡æ‰“åŒ…å†…å®¹ï¼Ÿ
  - è·å–æ‰“åŒ…è¾“å‡ºç›®å½•ï¼šé€šè¿‡ compiler å¯¹è±¡ã€‚
  - é€šè¿‡æ–‡ä»¶æ“ä½œæ¸…ç©ºå†…å®¹ï¼šé€šè¿‡ `compiler.outputFileSystem` æ“ä½œæ–‡ä»¶ã€‚

3. å®ç°ï¼š

```js
// plugins/clean-webpack-plugin.js
class CleanWebpackPlugin {
  apply(compiler) {
    // è·å–æ“ä½œæ–‡ä»¶çš„å¯¹è±¡
    const fs = compiler.outputFileSystem;
    // emitæ˜¯å¼‚æ­¥ä¸²è¡Œé’©å­
    compiler.hooks.emit.tapAsync("CleanWebpackPlugin", (compilation, callback) => {
      // è·å–è¾“å‡ºæ–‡ä»¶ç›®å½•
      const outputPath = compiler.options.output.path;
      // åˆ é™¤ç›®å½•æ‰€æœ‰æ–‡ä»¶
      const err = this.removeFiles(fs, outputPath);
      // æ‰§è¡ŒæˆåŠŸerrä¸ºundefinedï¼Œæ‰§è¡Œå¤±è´¥errå°±æ˜¯é”™è¯¯åŸå› 
      callback(err);
    });
  }

  removeFiles(fs, path) {
    try {
      // è¯»å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
      const files = fs.readdirSync(path);

      // éå†æ–‡ä»¶ï¼Œåˆ é™¤
      files.forEach((file) => {
        // è·å–æ–‡ä»¶å®Œæ•´è·¯å¾„
        const filePath = `${path}/${file}`;
        // åˆ†ææ–‡ä»¶
        const fileStat = fs.statSync(filePath);
        // åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹
        if (fileStat.isDirectory()) {
          // æ˜¯æ–‡ä»¶å¤¹éœ€è¦é€’å½’éå†åˆ é™¤ä¸‹é¢æ‰€æœ‰æ–‡ä»¶
          this.removeFiles(fs, filePath);
        } else {
          // ä¸æ˜¯æ–‡ä»¶å¤¹å°±æ˜¯æ–‡ä»¶ï¼Œç›´æ¥åˆ é™¤
          fs.unlinkSync(filePath);
        }
      });

      // æœ€ååˆ é™¤å½“å‰ç›®å½•
      fs.rmdirSync(path);
    } catch (e) {
      // å°†äº§ç”Ÿçš„é”™è¯¯è¿”å›å‡ºå»
      return e;
    }
  }
}

module.exports = CleanWebpackPlugin;
```

## AnalyzeWebpackPlugin

1. ä½œç”¨ï¼šåˆ†æ webpack æ‰“åŒ…èµ„æºå¤§å°ï¼Œå¹¶è¾“å‡ºåˆ†ææ–‡ä»¶ã€‚
2. å¼€å‘æ€è·¯:

- åœ¨å“ªåš? `compiler.hooks.emit`, å®ƒæ˜¯åœ¨æ‰“åŒ…è¾“å‡ºå‰è§¦å‘ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æèµ„æºå¤§å°åŒæ—¶æ·»åŠ ä¸Šåˆ†æåçš„ md æ–‡ä»¶ã€‚

3. å®ç°ï¼š

```js
// plugins/analyze-webpack-plugin.js
class AnalyzeWebpackPlugin {
  apply(compiler) {
    // emitæ˜¯å¼‚æ­¥ä¸²è¡Œé’©å­
    compiler.hooks.emit.tap("AnalyzeWebpackPlugin", (compilation) => {
      // Object.entrieså°†å¯¹è±¡å˜æˆäºŒç»´æ•°ç»„ã€‚äºŒç»´æ•°ç»„ä¸­ç¬¬ä¸€é¡¹å€¼æ˜¯keyï¼Œç¬¬äºŒé¡¹å€¼æ˜¯value
      const assets = Object.entries(compilation.assets);

      let source = "# åˆ†ææ‰“åŒ…èµ„æºå¤§å° \n| åç§° | å¤§å° |\n| --- | --- |";

      assets.forEach(([filename, file]) => {
        source += `\n| ${filename} | ${file.size()} |`;
      });

      // æ·»åŠ èµ„æº
      compilation.assets["analyze.md"] = {
        source() {
          return source;
        },
        size() {
          return source.length;
        },
      };
    });
  }
}

module.exports = AnalyzeWebpackPlugin;
```

## InlineChunkWebpackPlugin

1. ä½œç”¨ï¼šwebpack æ‰“åŒ…ç”Ÿæˆçš„ runtime æ–‡ä»¶å¤ªå°äº†ï¼Œé¢å¤–å‘é€è¯·æ±‚æ€§èƒ½ä¸å¥½ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶å†…è”åˆ° js ä¸­ï¼Œä»è€Œå‡å°‘è¯·æ±‚æ•°é‡ã€‚
2. å¼€å‘æ€è·¯:

- æˆ‘ä»¬éœ€è¦å€ŸåŠ© `html-webpack-plugin` æ¥å®ç°
  - åœ¨ `html-webpack-plugin` è¾“å‡º index.html å‰å°†å†…è” runtime æ³¨å…¥è¿›å»
  - åˆ é™¤å¤šä½™çš„ runtime æ–‡ä»¶
- å¦‚ä½•æ“ä½œ `html-webpack-plugin`ï¼Ÿ[å®˜æ–¹æ–‡æ¡£](https://github.com/jantimon/html-webpack-plugin/#afteremit-hook)

3. å®ç°ï¼š

```js
// plugins/inline-chunk-webpack-plugin.js
const HtmlWebpackPlugin = require("safe-require")("html-webpack-plugin");

class InlineChunkWebpackPlugin {
  constructor(tests) {
    this.tests = tests;
  }

  apply(compiler) {
    compiler.hooks.compilation.tap("InlineChunkWebpackPlugin", (compilation) => {
      const hooks = HtmlWebpackPlugin.getHooks(compilation);

      hooks.alterAssetTagGroups.tap("InlineChunkWebpackPlugin", (assets) => {
        assets.headTags = this.getInlineTag(assets.headTags, compilation.assets);
        assets.bodyTags = this.getInlineTag(assets.bodyTags, compilation.assets);
      });

      hooks.afterEmit.tap("InlineChunkHtmlPlugin", () => {
        Object.keys(compilation.assets).forEach((assetName) => {
          if (this.tests.some((test) => assetName.match(test))) {
            delete compilation.assets[assetName];
          }
        });
      });
    });
  }

  getInlineTag(tags, assets) {
    return tags.map((tag) => {
      if (tag.tagName !== "script") return tag;

      const scriptName = tag.attributes.src;

      if (!this.tests.some((test) => scriptName.match(test))) return tag;

      return { tagName: "script", innerHTML: assets[scriptName].source(), closeTag: true };
    });
  }
}

module.exports = InlineChunkWebpackPlugin;
```

# æ€»ç»“

æœ¬ç« èŠ‚æˆ‘ä»¬å­¦ä¹ äº† webpack ä¸­çš„ loader å’Œ plugin ç”¨æ³•ã€‚åŒ…æ‹¬æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆä½¿ç”¨ï¼Œå¦‚ä½•è‡ªå®šä¹‰ç­‰ã€‚

å®ƒèƒ½å¤Ÿå¸®åŠ©å¤§å®¶æå‡å¯¹ loader å’Œ plugin çš„è®¤è¯†ï¼ŒåŒæ—¶å­¦ä¹ åˆ°äº†åŸç†ï¼Œå°†æ¥å¤§å®¶ä¹Ÿèƒ½å¤Ÿåœ¨ç¤¾åŒºä¸­åšå‡ºè´¡çŒ®ã€‚
